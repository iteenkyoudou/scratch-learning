<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scratch学習サイト - シンプル版</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'ヒラギノ角ゴ ProN W3', 'Meiryo', 'メイリオ', 'MS PGothic', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f5ff;
            min-height: 100vh;
            line-height: 1.6;
        }
        .header {
            background: #7C3F9E;
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(124, 63, 158, 0.3);
            border: 3px solid #fff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .lesson-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .lesson-card {
            background: #ffffff;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 
                0 6px 20px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.6);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            border: 2px solid #e0e0e0;
            position: relative;
            overflow: hidden;
        }
        .lesson-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
            border-color: #7C3F9E;
        }
        .lesson-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #7C3F9E;
        }
        .emoji {
            font-size: 56px;
            margin-bottom: 15px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        .lesson-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
            letter-spacing: 0.5px;
        }
        .lesson-desc {
            color: #5a6c7d;
            font-size: 15px;
            font-weight: 500;
        }
        .step-container {
            display: none;
            background: #ffffff;
            border-radius: 20px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 2px solid #e3f2fd;
            position: relative;
        }
        .step-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #7C3F9E;
            border-radius: 20px 20px 0 0;
        }
        .step-active { display: block; }
        .step-nav {
            text-align: center;
            margin-top: 20px;
        }
        .btn {
            background: #7C3F9E;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            margin: 0 8px;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(124, 63, 158, 0.3);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(124, 63, 158, 0.4);
            background: #FF6600;
        }
        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e8f4f8;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: #7C3F9E;
            border-radius: 8px;
            transition: width 0.5s ease;
            position: relative;
        }
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .block-container {
            background: #f8fffe;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #e1f5fe;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        h1, h2, h3, h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        h1 {
            font-size: 28px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            font-size: 24px;
            color: #34495e;
        }
        h3 {
            font-size: 20px;
            color: #2c3e50;
        }
        
        p {
            color: #34495e;
            line-height: 1.7;
            margin-bottom: 15px;
        }
        .blocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .block-item {
            background: #ffffff;
            padding: 18px;
            border-radius: 12px;
            border: 2px solid #e3f2fd;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .block-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-color: #FF8533;
        }
        .japanese-label {
            color: #455a64;
            font-size: 13px;
            font-weight: 500;
            line-height: 1.5;
            margin-top: 8px;
            padding: 5px 0;
        }
        .japanese-label strong {
            color: #2c3e50;
            font-weight: bold;
        }
        .execution-container {
            margin: 20px 0;
        }
        .execution-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f5ff;
            border: 2px solid #7C3F9E;
            border-radius: 12px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(124, 63, 158, 0.1);
        }
        .step-number {
            background: #7C3F9E;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            font-size: 16px;
            box-shadow: 0 3px 10px rgba(124, 63, 158, 0.3);
            border: 2px solid #fff;
        }
        .info-box {
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        .info-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            border-radius: 0 15px 15px 0;
        }
        .info-box.hint {
            background: #e3f2fd;
            border-color: #81d4fa;
        }
        .info-box.hint::before {
            background: #2196f3;
        }
        .info-box.success {
            background: #e8f5e8;
            border-color: #a5d6a7;
        }
        .info-box.success::before {
            background: #4caf50;
        }
        .info-box.learn {
            background: #fff3e0;
            border-color: #ffcc80;
        }
        .info-box.learn::before {
            background: #FF6600;
        }
        .status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1000;
        }
        .status.loading {
            background: #ffa500;
            color: white;
        }
        .status.success {
            background: #4CAF50;
            color: white;
        }
        .status.error {
            background: #f44336;
            color: white;
        }
        .japanese-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        
        /* フローチャートのスタイリング */
        .flow-container {
            margin: 20px 0;
        }
        
        .flow-chart {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .flow-step {
            background: white;
            border: 2px solid #4A90E2;
            border-radius: 8px;
            padding: 12px;
            margin: 10px auto;
            max-width: 280px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .flow-decision {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 15px;
            margin: 15px auto;
            max-width: 280px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .flow-branches {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            gap: 20px;
        }
        
        /* ペン描画アニメーション用のスタイル */
        .pen-line {
            position: absolute;
            background: #ff6b6b;
            z-index: 1;
            opacity: 0.8;
        }
        
        .stage {
            position: relative;
            width: 400px;
            height: 300px;
            background: #f0f8ff;
            border: 2px solid #4A90E2;
            border-radius: 8px;
            margin: 20px auto;
            overflow: hidden;
        }
        
        .sprite {
            position: absolute;
            font-size: 24px;
            transition: all 0.5s ease;
            z-index: 10;
        }
        
        .pen-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }
        
        .branch-true, .branch-false {
            flex: 1;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .branch-true {
            background: #e8f6e8;
            border: 2px solid #4CAF50;
        }
        
        .branch-false {
            background: #ffebee;
            border: 2px solid #f44336;
        }
        
        .branch-true .flow-step,
        .branch-false .flow-step {
            background: white;
            border: 1px solid #ccc;
            margin: 10px auto;
            max-width: 200px;
            padding: 8px;
            font-size: 12px;
        }
        
        .step-content {
            text-align: left;
            font-size: 13px;
        }
        
        .step-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 11px;
        }
        
        /* クローン学習の例表示用スタイル */
        .example-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .example-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .example-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }
        
        .info-box.challenge {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .info-box.challenge strong {
            color: #856404;
        }
        
        .decision-content {
            text-align: center;
            font-size: 14px;
        }
        
        .decision-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* アニメーション関連のスタイル */
        .animation-container {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .stage {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            width: 100%;
            height: 300px;
            position: relative;
            margin: 15px 0;
            overflow: hidden;
        }
        .sprite {
            position: absolute;
            font-size: 48px;
            left: 50px;
            top: 50px;
            transition: all 1s ease-in-out;
            z-index: 2;
        }
        .speech-bubble {
            position: absolute;
            background: white;
            border: 2px solid #333;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 14px;
            font-weight: bold;
            display: none;
            z-index: 3;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 20px;
            width: 0;
            height: 0;
            border: 10px solid transparent;
            border-top-color: white;
        }
        .speech-bubble::before {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 18px;
            width: 0;
            height: 0;
            border: 12px solid transparent;
            border-top-color: #333;
        }
        .play-btn, .reset-btn {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .reset-btn {
            background: #666;
        }
        .play-btn:hover {
            background: #357abd;
        }
        .reset-btn:hover {
            background: #555;
        }
        .animation-status {
            background: #e8f4fd;
            border-left: 4px solid #4A90E2;
            padding: 12px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 14px;
            font-weight: bold;
        }
        
        /* 左右レイアウト用のスタイル */
        .side-by-side-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            align-items: flex-start;
        }
        
        .left-panel {
            flex: 1;
            min-width: 0;
        }
        
        .right-panel {
            flex: 1;
            min-width: 0;
        }
        
        .execution-content {
            flex: 1;
            min-width: 0;
        }
        
        .execution-description {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
            line-height: 1.4;
        }
        
        /* レスポンシブ対応 */
        @media (max-width: 768px) {
            .side-by-side-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .left-panel,
            .right-panel {
                flex: none;
                width: 100%;
            }
        }
        
        /* 練習問題用のスタイル */
        .answer-section {
            margin: 30px 0;
            text-align: center;
        }
        
        .answer-btn {
            background: #ff9500;
            font-size: 16px;
            padding: 12px 24px;
        }
        
        .answer-btn:hover {
            background: #e6850e;
        }
        
        .answer-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .answer-container {
            margin-top: 20px;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="status" class="status loading">ブロック読み込み中...</div>
    
    <div class="container">
        <div id="home-view">
            <div class="header">
                <h1>🎮 Scratch学習サイト</h1>
                <p>楽しくプログラミングを学ぼう！</p>
            </div>
            
            <div class="lesson-grid">
                <div class="lesson-card" onclick="showProgramFlow()">
                    <div class="emoji">📖</div>
                    <div class="lesson-title">プログラムの流れ</div>
                    <div class="lesson-desc">ブロックが順番に動く様子を学ぼう！</div>
                </div>
                <div class="lesson-card" onclick="showConditionalMenu()">
                    <div class="emoji">🤔</div>
                    <div class="lesson-title">条件分岐</div>
                    <div class="lesson-desc">条件によって動きを変えよう！</div>
                </div>
                <div class="lesson-card" onclick="showLoop()">
                    <div class="emoji">🔄</div>
                    <div class="lesson-title">繰り返し</div>
                    <div class="lesson-desc">同じ動きを何度も実行しよう！</div>
                </div>
                
                <!-- Phase 1-4: 新機能 -->
                <div class="lesson-card" onclick="showCoordinates()">
                    <div class="emoji">🎯</div>
                    <div class="lesson-title">座標とステージ</div>
                    <div class="lesson-desc">X・Y座標でスプライトを動かそう！</div>
                </div>
                <div class="lesson-card" onclick="showVariablesMenu()">
                    <div class="emoji">📊</div>
                    <div class="lesson-title">変数と計算</div>
                    <div class="lesson-desc">数を覚えて計算してみよう！</div>
                </div>
                <div class="lesson-card" onclick="showCostumes()">
                    <div class="emoji">👗</div>
                    <div class="lesson-title">見た目の変更</div>
                    <div class="lesson-desc">キャラクターの姿を変えよう！</div>
                </div>
                <div class="lesson-card" onclick="console.log('Clone card clicked'); showClonesMenu();">
                    <div class="emoji">👥</div>
                    <div class="lesson-title">クローン機能</div>
                    <div class="lesson-desc">スプライトをたくさん作ってみよう！</div>
                </div>
                
                <!-- 新機能追加 -->
                <div class="lesson-card" onclick="showSoundsMenu()">
                    <div class="emoji">🎵</div>
                    <div class="lesson-title">音と音楽</div>
                    <div class="lesson-desc">音を鳴らして楽しいプログラムを作ろう！</div>
                </div>
                <div class="lesson-card" onclick="showMessagesMenu()">
                    <div class="emoji">📢</div>
                    <div class="lesson-title">メッセージ機能</div>
                    <div class="lesson-desc">スプライト同士で会話させよう！</div>
                </div>
                <div class="lesson-card" onclick="showBackgroundsMenu()">
                    <div class="emoji">🎭</div>
                    <div class="lesson-title">背景とステージ</div>
                    <div class="lesson-desc">ステージの背景を変えて世界を作ろう！</div>
                </div>
                <div class="lesson-card" onclick="showListsMenu()">
                    <div class="emoji">📋</div>
                    <div class="lesson-title">リスト</div>
                    <div class="lesson-desc">たくさんのデータを整理して使おう！</div>
                </div>
                <div class="lesson-card" onclick="showPenMenu()">
                    <div class="emoji">✏️</div>
                    <div class="lesson-title">ペン機能</div>
                    <div class="lesson-desc">線や図形を描いて芸術作品を作ろう！</div>
                </div>
            </div>
        </div>

        <div id="program-flow" style="display: none;">
            <div class="progress-bar">
                <div id="progress" class="progress-fill" style="width: 16.7%"></div>
            </div>
            <h2 id="step-title">ステップ 1 / 6</h2>

            <!-- Step 1: 結果を見る -->
            <div id="step1" class="step-container step-active">
                <h3>🎯 きょうつくるうごきのもくひょう</h3>
                <div class="info-box learn">
                    <strong>📚 これから作ってみよう！</strong><br>
                    ねこが順番に動く楽しいプログラムを作ります。<br>
                    • ねこが「こんにちは！」とあいさつ<br>
                    • 少し待ってから右に動く<br>
                    • くるっと回る<br>
                    • 最後に「さようなら！」とおわかれ<br><br>
                    <strong>🎓 勉強のポイント:</strong> ブロックが上から順番に動く「順次処理」を体験しよう！
                </div>

                <h3>🎬 完成した動きを見てみよう！</h3>
                <p>まずは完成版を見て、どんな動きになるかイメージしましょう。</p>
                
                <!-- スプライトアニメーション -->
                <div class="animation-container">
                    <h4>🎭 目標となるスプライトの動き</h4>
                    <div class="stage">
                        <div id="sprite" class="sprite">🐱</div>
                        <div id="speech-bubble" class="speech-bubble"></div>
                        <button class="play-btn" onclick="playAnimation()">▶️ アニメーションを再生</button>
                        <button class="reset-btn" onclick="resetAnimation()">🔄 リセット</button>
                    </div>
                    <div class="animation-status" id="animation-status">緑の旗をクリックしてアニメーションを開始しましょう！</div>
                </div>

                <div class="info-box hint">
                    <strong>🤔 動きの流れは？</strong> スプライトが順番に「あいさつ→待機→移動→回転→あいさつ」を行いました。一つずつ順番に実行されているのがポイントです！
                </div>

                <h3>📦 このうごきをつくるためにひつようなブロック</h3>
                <p>うえのうごきをつくるために、つぎのブロックをようします：</p>
                
                <div class="blocks-grid">
                    <div class="block-item">
                        <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                        <div class="japanese-label">プログラムのはじまり（みどりのはたブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">[こんにちは！] という :: looks</pre>
                        <div class="japanese-label">最初のあいさつ（見た目ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(1) びょうまつ :: control</pre>
                        <div class="japanese-label">うごきのあいだをつくる（せいぎょブロック）<br><strong>📊 必要な個数: 3個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(50) ほうごかす :: motion</pre>
                        <div class="japanese-label">みぎにうごく（うごきブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">みぎに (90) どまわす :: motion</pre>
                        <div class="japanese-label">90どまわる（うごきブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">[さようなら！] という :: looks</pre>
                        <div class="japanese-label">最後のおわかれ（見た目ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                </div>

                <div class="info-box success">
                    <strong>✨ 次のステップで</strong> これらのブロックを正しい順番で組み立てる方法を学びましょう！
                </div>
            </div>

            <!-- Step 2: 組み立て -->
            <div id="step2" class="step-container">
                <h3>🔧 ブロックをくみたててみよう！</h3>
                <p>さあ、じっさいにみたうごきをつくるためにブロックをただしいじゅんばんでくみたててみましょう。</p>
                
                <div class="block-container">
                    <h4>🎯 くみたてかた:</h4>
                    <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
[こんにちは！] という :: looks
(1) びょうまつ :: control
(50) ほうごかす :: motion
(1) びょうまつ :: control
みぎに (90) どまわす :: motion
(1) びょうまつ :: control
[さようなら！] という :: looks
                    </pre>
                </div>

                <div class="info-box success">
                    <strong>✅ やってみよう！</strong> じっさいのScratchでこのとおりにブロックをくみたてて、みどりのはたをおしてみてください！
                </div>

                <div class="info-box hint">
                    <strong>💡 ポイント:</strong> ブロックはうえからしたへ、じゅんばんどおりにならべることがたいせつです。
                </div>
            </div>

            <!-- Step 3: 詳しい解説 -->
            <div id="step3" class="step-container">
                <h3>🧠 なぜこのように動くの？順次処理のひみつ</h3>
                <p>プログラムが順番通りに動く理由を、アニメーションを見ながらくわしく学びましょう。</p>
                
                <!-- 左右レイアウトのメインコンテナ -->
                <div class="side-by-side-container">
                    <!-- 左側: アニメーション -->
                    <div class="left-panel">
                        <div class="animation-container">
                            <h4>🔍 動きをくわしく見てみよう</h4>
                            <div class="stage">
                                <div id="sprite2" class="sprite">🐱</div>
                                <div id="speech-bubble2" class="speech-bubble"></div>
                                <button class="play-btn" onclick="playDetailedAnimation()">🔬 くわしいアニメーションを再生</button>
                                <button class="reset-btn" onclick="resetDetailedAnimation()">🔄 リセット</button>
                            </div>
                            <div class="animation-status" id="detailed-status">くわしいアニメーションでプログラムの流れを確認しましょう！</div>
                        </div>
                    </div>

                    <!-- 右側: 順次処理の解説 -->
                    <div class="right-panel">
                        <div class="execution-container">
                            <h4>📋 順次処理の流れ:</h4>
                            <div class="execution-item">
                                <div class="step-number">1</div>
                                <div class="execution-content">
                                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                                    <div class="execution-description">プログラムのスタートちてん</div>
                                </div>
                            </div>
                            <div class="execution-item">
                                <div class="step-number">2</div>
                                <div class="execution-content">
                                    <pre class="blocks">[こんにちは！] という :: looks</pre>
                                    <div class="execution-description">最初のアクション：あいさつ</div>
                                </div>
                            </div>
                            <div class="execution-item">
                                <div class="step-number">3</div>
                                <div class="execution-content">
                                    <pre class="blocks">(1) びょうまつ :: control</pre>
                                    <div class="execution-description">あいだをあけてみやすくする</div>
                                </div>
                            </div>
                            <div class="execution-item">
                                <div class="step-number">4</div>
                                <div class="execution-content">
                                    <pre class="blocks">(50) ほうごかす :: motion</pre>
                                    <div class="execution-description">つぎのアクション：いどう</div>
                                </div>
                            </div>
                            <div class="execution-item">
                                <div class="step-number">5</div>
                                <div class="execution-content">
                                    <pre class="blocks">(1) びょうまつ :: control</pre>
                                    <div class="execution-description">またあいだをあける</div>
                                </div>
                            </div>
                            <div class="execution-item">
                                <div class="step-number">6</div>
                                <div class="execution-content">
                                    <pre class="blocks">みぎに (90) どまわす :: motion</pre>
                                    <div class="execution-description">つぎのアクション：かいてん</div>
                                </div>
                            </div>
                            <div class="execution-item">
                                <div class="step-number">7</div>
                                <div class="execution-content">
                                    <pre class="blocks">(1) びょうまつ :: control</pre>
                                    <div class="execution-description">最後の間</div>
                                </div>
                            </div>
                            <div class="execution-item">
                                <div class="step-number">8</div>
                                <div class="execution-content">
                                    <pre class="blocks">[さようなら！] という :: looks</pre>
                                    <div class="execution-description">最後のアクション：おわかれ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box learn">
                    <strong>🎓 順次処理とは？</strong><br>
                    プログラムはかならず<strong>上から下へ、順番通り</strong>に実行されます。<br>
                    これを「順次処理」とよびます。<br>
                    <strong>1つのブロックが終わってから、次のブロックが実行される</strong>のがポイントです！
                </div>

                <div class="info-box hint">
                    <strong>🌟 おぼえておこう！</strong><br>
                    • ブロックは上から順番に実行される<br>
                    • 1つずつ、順番を待って実行される<br>
                    • 途中でブロックがとばされることはない<br>
                    • 「待つ」ブロックも大切な処理の一部！
                </div>
            </div>

            <!-- Step 4: 練習問題1 -->
            <div id="step4" class="step-container">
                <h3>🎯 練習問題1: 簡単なあいさつプログラム</h3>
                <p>学んだことを活かして、自分で順次処理のプログラムを作ってみましょう！</p>
                
                <div class="info-box learn">
                    <strong>📚 作ってみよう！</strong><br>
                    ねこが次の動きをする簡単なプログラムを作ります：<br>
                    • ねこが「おはよう！」とあいさつ<br>
                    • 2秒待つ<br>
                    • 「今日もがんばろう！」とはげます<br>
                </div>

                <h3>🎬 もくひょうのうごきをかくにんしよう</h3>
                <div class="animation-container">
                    <h4>🌅 れんしゅうもんだい1のうごき</h4>
                    <div class="stage">
                        <div id="sprite-practice1" class="sprite">🐱</div>
                        <div id="speech-bubble-practice1" class="speech-bubble"></div>
                        <button class="play-btn" onclick="playPractice1Animation()">▶️ 目標アニメーションを再生</button>
                        <button class="reset-btn" onclick="resetPractice1Animation()">🔄 リセット</button>
                    </div>
                    <div class="animation-status" id="practice1-status">練習問題1の目標となる動きです</div>
                </div>

                <h3>📦 使うブロックを選ぼう</h3>
                <p>下のブロックの中から必要なものを選んで、正しい順番で組み立ててください：</p>
                
                <div class="blocks-grid">
                    <div class="block-item">
                        <pre class="blocks">[きょうもがんばろう！] という :: looks</pre>
                        <div class="japanese-label">きょうもがんばろう！と言う（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                        <div class="japanese-label">緑の旗がクリックされたとき（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(2) びょうまつ :: control</pre>
                        <div class="japanese-label">2秒待つ（制御）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">[おはよう！] という :: looks</pre>
                        <div class="japanese-label">おはよう！と言う（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                </div>

                <div class="answer-section">
                    <button class="btn answer-btn" onclick="showAnswer1()" id="answerBtn1">💡 答えを表示</button>
                    <div id="answer1" class="answer-container" style="display: none;">
                        <h4>✅ 正解:</h4>
                        <div class="block-container">
                            <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
[おはよう！] という :: looks
(2) びょうまつ :: control
[きょうもがんばろう！] という :: looks
                            </pre>
                        </div>
                        <div class="info-box success">
                            <strong>🎉 よくできました！</strong> 順次処理の基本がしっかりと理解できています。
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 5: 練習問題2 -->
            <div id="step5" class="step-container">
                <h3>🎯 練習問題2: 動きのあるプログラム</h3>
                <p>今度は動きも含めた、少し複雑なプログラムに挑戦してみましょう！</p>
                
                <div class="info-box learn">
                    <strong>📚 作ってみよう！</strong><br>
                    スプライトが次の動きをするプログラムを作ります：<br>
                    • 「出発します！」と言う<br>
                    • 左に30歩動く<br>
                    • 1秒待つ<br>
                    • 左に90度回転<br>
                    • 「到着しました！」と言う<br>
                </div>

                <h3>🎬 目標の動きを確認しよう</h3>
                <div class="animation-container">
                    <h4>🚗 練習問題2の動き</h4>
                    <div class="stage">
                        <div id="sprite-practice2" class="sprite">🐱</div>
                        <div id="speech-bubble-practice2" class="speech-bubble"></div>
                        <button class="play-btn" onclick="playPractice2Animation()">▶️ 目標アニメーションを再生</button>
                        <button class="reset-btn" onclick="resetPractice2Animation()">🔄 リセット</button>
                    </div>
                    <div class="animation-status" id="practice2-status">練習問題2の目標となる動きです</div>
                </div>

                <h3>📦 使うブロックを選ぼう</h3>
                <p>下のブロックの中から必要なものを選んで、正しい順番で組み立ててください：</p>
                
                <div class="blocks-grid">
                    <div class="block-item">
                        <pre class="blocks">ひだりに (90) どまわす :: motion</pre>
                        <div class="japanese-label">左に90度回す（動き）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">[とうちゃくしました！] という :: looks</pre>
                        <div class="japanese-label">到着しました！と言う（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                        <div class="japanese-label">緑の旗がクリックされたとき（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(1) びょうまつ :: control</pre>
                        <div class="japanese-label">1秒待つ（制御）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(-90) どにむける :: motion</pre>
                        <div class="japanese-label">左向きになる（動き）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(30) ほうごかす :: motion</pre>
                        <div class="japanese-label">30歩動かす（動き）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">[しゅっぱつします！] という :: looks</pre>
                        <div class="japanese-label">出発します！と言う（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                </div>

                <div class="answer-section">
                    <button class="btn answer-btn" onclick="showAnswer2()" id="answerBtn2">💡 答えを表示</button>
                    <div id="answer2" class="answer-container" style="display: none;">
                        <h4>✅ 正解:</h4>
                        <div class="block-container">
                            <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
[しゅっぱつします！] という :: looks
(-90) どにむける :: motion
(30) ほうごかす :: motion
(1) びょうまつ :: control
(90) どまわす :: motion
[とうちゃくしました！] という :: looks
                            </pre>
                        </div>
                        <div class="info-box success">
                            <strong>🎉 素晴らしい！</strong> 動きと待機を組み合わせた順次処理ができました。
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 6: 練習問題3 -->
            <div id="step6" class="step-container">
                <h3>🎯 練習問題3: 複雑なダンスプログラム</h3>
                <p>最後は一番難しい問題です。たくさんのブロックを使ったダンスプログラムを作りましょう！</p>
                
                <div class="info-box learn">
                    <strong>📚 作ってみよう！</strong><br>
                    スプライトが次の動きをするダンスプログラムを作ります：<br>
                    • 「ダンスを始めます♪」と言う<br>
                    • 右に15歩動く → 右に90度回転<br>
                    • 「くるくる〜」と言う<br>
                    • 右に90度回転 → 右に15歩動く<br>
                    • 「ダンス終了！」と言う<br>
                </div>

                <h3>🎬 目標の動きを確認しよう</h3>
                <div class="animation-container">
                    <h4>💃 練習問題3の動き</h4>
                    <div class="stage">
                        <div id="sprite-practice3" class="sprite">🐱</div>
                        <div id="speech-bubble-practice3" class="speech-bubble"></div>
                        <button class="play-btn" onclick="playPractice3Animation()">▶️ 目標アニメーションを再生</button>
                        <button class="reset-btn" onclick="resetPractice3Animation()">🔄 リセット</button>
                    </div>
                    <div class="animation-status" id="practice3-status">練習問題3の目標となる動きです</div>
                </div>

                <h3>📦 使うブロックを選ぼう</h3>
                <p>下のブロックの中から必要なものを選んで、正しい順番で組み立ててください：</p>
                
                <div class="blocks-grid">
                    <div class="block-item">
                        <pre class="blocks">みぎに (90) どまわす :: motion</pre>
                        <div class="japanese-label">右に90度回す（動き）<br><strong>📊 必要な個数: 2個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">[ダンスおわり！] という :: looks</pre>
                        <div class="japanese-label">ダンス終わり！と言う（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(15) ほうごかす :: motion</pre>
                        <div class="japanese-label">15歩動かす（動き）<br><strong>📊 必要な個数: 2個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">[くるくる〜] という :: looks</pre>
                        <div class="japanese-label">くるくる〜と言う（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                        <div class="japanese-label">緑の旗がクリックされたとき（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(90) どまわす :: motion</pre>
                        <div class="japanese-label">90度回す（動き）<br><strong>📊 必要な個数: 0個（みぎに90度回すを使用）</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">[ダンスをはじめます♪] という :: looks</pre>
                        <div class="japanese-label">ダンスをはじめます♪と言う（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(1) びょうまつ :: control</pre>
                        <div class="japanese-label">1秒待つ（制御）<br><strong>📊 必要な個数: 5個</strong></div>
                    </div>
                </div>

                <div class="answer-section">
                    <button class="btn answer-btn" onclick="showAnswer3()" id="answerBtn3">💡 答えを表示</button>
                    <div id="answer3" class="answer-container" style="display: none;">
                        <h4>✅ 正解:</h4>
                        <div class="block-container">
                            <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
[ダンスをはじめます♪] という :: looks
(1) びょうまつ :: control
(15) ほうごかす :: motion
(1) びょうまつ :: control
(90) どまわす :: motion
[くるくる〜] という :: looks
(1) びょうまつ :: control
(90) どまわす :: motion
(1) びょうまつ :: control
(15) ほうごかす :: motion
(1) びょうまつ :: control
[ダンスおわり！] という :: looks
                            </pre>
                        </div>
                        <div class="info-box success">
                            <strong>🎉 完璧です！</strong> 複雑な順次処理を正しく組み立てることができました。順次処理をマスターしましたね！
                        </div>
                    </div>
                </div>
            </div>

            <div class="step-nav">
                <button class="btn" id="prevBtn-program" onclick="changeStep(-1)" disabled>前へ</button>
                <button class="btn" id="nextBtn-program" onclick="changeStep(1)">次へ</button>
                <button class="btn" onclick="showHome()" style="background: #666;">ホームに戻る</button>
            </div>
        </div>



        <!-- 繰り返し -->
        <div id="loop" style="display: none;">
            <div class="progress-bar">
                <div id="progress-loop" class="progress-fill" style="width: 16.7%"></div>
            </div>
            <h2 id="step-title-loop">ステップ 1 / 6</h2>

            <!-- Step 1: 結果を見る -->
            <div id="loop-step1" class="step-container step-active">
                <h3>🎯 今日作る動きの目標</h3>
                <div class="info-box learn">
                    <strong>📚 これから作ってみよう！</strong><br>
                    同じ動きを何度も繰り返す「繰り返し」のプログラムを作ります。<br>
                    • 何回繰り返すかを決める<br>
                    • 同じ動きを指定した回数だけ実行<br>
                    • ずっと繰り返す無限ループ<br>
                    • 条件まで繰り返す<br><br>
                    <strong>🎓 学習のポイント:</strong> 同じ処理を効率的に実行する「繰り返し」を体験しよう！
                </div>

                <h3>🎬 繰り返しの動きを見てみよう！</h3>
                <p>まず完成版を見て、繰り返しによってスプライトが規則的に動く様子を確認しましょう。</p>
                
                <div class="animation-container">
                    <h4>🔄 繰り返しで動くスプライト</h4>
                    <div class="stage">
                        <div id="sprite-loop" class="sprite">🐱</div>
                        <div id="speech-bubble-loop" class="speech-bubble"></div>
                        <button class="play-btn" onclick="playLoopAnimation()">▶️ 繰り返しアニメーションを再生</button>
                        <button class="reset-btn" onclick="resetLoopAnimation()">🔄 リセット</button>
                    </div>
                    <div class="animation-status" id="loop-status">同じ動きを繰り返し実行します！</div>
                </div>

                <div class="info-box hint">
                    <strong>🤔 動きのパターンは？</strong> スプライトが「10歩動いて→右に36度回転」を10回繰り返しました。1つずつ書くと大変ですが、繰り返しブロックを使うと簡単に書けます！
                </div>

                <h3>📦 この動きを作るために必要なブロック</h3>
                <p>上の繰り返し動作を作るために、次のブロックを用意します：</p>
                
                <div class="blocks-grid">
                    <div class="block-item">
                        <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                        <div class="japanese-label"><strong>🟡 プログラムのはじまり（はたがおされたとき）</strong><br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(10) 回繰り返す {
} :: control</pre>
                        <div class="japanese-label"><strong>🔵 10回繰り返す（制御ブロック）</strong><br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(10) 歩動かす :: motion</pre>
                        <div class="japanese-label"><strong>🔷 まえにすすむ動き（動きブロック）</strong><br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">右に (36) 度回す :: motion</pre>
                        <div class="japanese-label"><strong>🔷 回転する動き（動きブロック）</strong><br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(1) 秒待つ :: control</pre>
                        <div class="japanese-label"><strong>🔵 待機する（制御ブロック）</strong><br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                </div>

                <div class="info-box success">
                    <strong>✨ 次のステップで</strong> これらのブロックを使って繰り返しプログラムの組み立て方を学びましょう！
                </div>
            </div>

            <!-- Step 2: 組み立てとロジック解説 -->
            <div id="loop-step2" class="step-container">
                <h3>🔧 繰り返しブロックを組み立ててみよう！</h3>
                <p>「repeat」ブロックを使って、同じ動きを効率的に繰り返すプログラムを作ってみましょう。</p>
                
                <div class="block-container">
                    <h4>🎯 くみたてかた:</h4>
                    <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(10) 回繰り返す {
(10) 歩動かす :: motion
右に (36) 度回す :: motion
(1) 秒待つ :: control
} :: control
                    </pre>
                    
                    <div class="info-box hint" style="margin-top: 15px;">
                        <strong>📖 日本語での読み方:</strong><br>
                        <code>repeat (数) 〜 end</code> = <strong>「〜を○回繰り返す」</strong><br>
                        このC字型ブロックの中に入った動きを、指定した回数だけ繰り返し実行します。
                    </div>
                </div>

                <h3>🧠 このプログラムがどう動くか見てみよう</h3>
                <p>組み立てたブロックがどのような流れでじっこうされるか、くわしく解説します。</p>
                
                <div class="flow-container">
                    <h4>📋 プログラムの実行フロー</h4>
                    <div class="flow-chart">
                        <div class="flow-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <strong>🚩 プログラム開始</strong><br>
                                <code>@greenFlag がクリックされたとき</code>
                            </div>
                        </div>
                        ↓
                        <div class="flow-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <strong>🔄 繰り返し開始</strong><br>
                                <code>10回繰り返し開始</code><br>
                                <small>カウンター：1回目</small>
                            </div>
                        </div>
                        ↓
                        <div class="flow-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <strong>🚶 10歩動かす</strong><br>
                                <code>前に10歩進む</code>
                            </div>
                        </div>
                        ↓
                        <div class="flow-step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <strong>🔄 36度回転</strong><br>
                                <code>右に36度回す</code>
                            </div>
                        </div>
                        ↓
                        <div class="flow-step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <strong>⏰ 1秒待つ</strong><br>
                                <code>動きを確認しやすくする</code>
                            </div>
                        </div>
                        ↓
                        <div class="flow-decision">
                            <div class="decision-content">
                                <strong>❓ 繰り返し判定</strong><br>
                                <code>まだ10回に達していない？</code>
                            </div>
                        </div>
                        <div class="flow-branches">
                            <div class="branch-true">
                                <strong>✅ はい</strong><br>
                                カウンター+1して<br>ステップ3に戻る
                            </div>
                            <div class="branch-false">
                                <strong>❌ いいえ</strong><br>
                                10回完了したので<br>繰り返し終了
                            </div>
                        </div>
                        ↓
                        <div class="flow-step">
                            <div class="step-number">🏁</div>
                            <div class="step-content">
                                <strong>終了</strong><br>
                                プログラム完了
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box learn">
                    <strong>🎓 繰り返しの重要ポイント</strong><br>
                    • <strong>効率性</strong>：同じコードを何度も書く必要がない<br>
                    • <strong>正確性</strong>：繰り返し回数を自動で管理<br>
                    • <strong>保守性</strong>：中身を変更すれば全ての繰り返しに適用<br>
                    • <strong>可読性</strong>：コードが短くて分かりやすい
                </div>
            </div>

            <!-- Step 3: 条件まで繰り返し - 目標 -->
            <div id="loop-step3" class="step-container">
                <h3>🎯 今度作る動きの目標</h3>
                <div class="info-box learn">
                    <strong>📚 これから作ってみよう！</strong><br>
                    条件が満たされるまで繰り返す「repeat until」のプログラムを作ります。<br>
                    • 端に着くまで繰り返し動く<br>
                    • 条件を自分で決められる<br>
                    • 何回繰り返すか分からない時に便利<br>
                    • 条件が満たされたら自動で止まる<br><br>
                    <strong>🎓 学習のポイント:</strong> 回数ではなく「条件」で繰り返しを制御しよう！
                </div>

                <h3>🎬 条件まで繰り返しの動きを見てみよう！</h3>
                <p>スプライトが端に着くまで動き続ける様子を確認しましょう。</p>
                
                <div class="animation-container">
                    <h4>🚀 端まで動くスプライト</h4>
                    <div class="stage">
                        <div id="sprite-until" class="sprite">🐱</div>
                        <div id="speech-bubble-until" class="speech-bubble"></div>
                        <button class="play-btn" onclick="playUntilAnimation()">▶️ 条件まで繰り返しアニメーション</button>
                        <button class="reset-btn" onclick="resetUntilAnimation()">🔄 リセット</button>
                    </div>
                    <div class="animation-status" id="until-status">端に着くまで動き続けます！</div>
                </div>

                <div class="info-box hint">
                    <strong>🤔 動きのパターンは？</strong> スプライトが「端に着く」という条件が満たされるまで、10歩ずつ動き続けました。何歩で端に着くかは分からないので、条件での制御が便利です！
                </div>

                <h3>📦 この動きを作るために必要なブロック</h3>
                <p>上の条件まで繰り返し動作を作るために、次のブロックを用意します：</p>
                
                <div class="blocks-grid">
                    <div class="block-item">
                        <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                        <div class="japanese-label"><strong>🟡 プログラムのはじまり（はたがおされたとき）</strong><br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks"><>まで繰り返す {
} :: control</pre>
                        <div class="japanese-label"><strong>🔵 条件まで繰り返す（条件付きループブロック）</strong><br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks"><(端 v)に触れた :: sensing></pre>
                        <div class="japanese-label"><strong>🟢 はしに触れたかを調べる（調べるブロック）</strong><br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(10) 歩動かす :: motion</pre>
                        <div class="japanese-label"><strong>🔷 まえにすすむ動き（動きブロック）</strong><br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(0.5) 秒待つ :: control</pre>
                        <div class="japanese-label"><strong>🔵 短い待機（制御ブロック）</strong><br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                </div>

                <div class="info-box success">
                    <strong>✨ 次のステップで</strong> これらのブロックを使って条件まで繰り返しプログラムの組み立て方を学びましょう！
                </div>
            </div>

            <!-- Step 4: 条件まで繰り返し - 組み立て -->
            <div id="loop-step4" class="step-container">
                <h3>🔧 条件まで繰り返しブロックを組み立ててみよう！</h3>
                <p>「repeat until」ブロックを使って、条件が満たされるまで動き続けるプログラムを作ってみましょう。</p>
                
                <div class="block-container">
                    <h4>🎯 くみたてかた:</h4>
                    <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
<(端 v)に触れた :: sensing>まで繰り返す {
(10) 歩動かす :: motion
(0.5) 秒待つ :: control
} :: control
                    </pre>
                    
                    <div class="info-box hint" style="margin-top: 15px;">
                        <strong>📖 日本語での読み方:</strong><br>
                        <code>repeat until &lt;条件&gt; 〜 end</code> = <strong>「条件が満たされるまで〜を繰り返す」</strong><br>
                        条件が真（True）になるまで、ブロックの中身を繰り返し実行します。
                    </div>
                </div>

                <h3>🧠 このプログラムがどう動くか見てみよう</h3>
                <p>組み立てたブロックがどのような流れでじっこうされるか、くわしく解説します。</p>
                
                <div class="flow-container">
                    <h4>📋 プログラムの実行フロー</h4>
                    <div class="flow-chart">
                        <div class="flow-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <strong>🚩 プログラム開始</strong><br>
                                <code>@greenFlag がクリックされたとき</code>
                            </div>
                        </div>
                        ↓
                        <div class="flow-decision">
                            <div class="decision-content">
                                <strong>❓ 条件チェック</strong><br>
                                <code>はしに触れた？</code>
                            </div>
                        </div>
                        <div class="flow-branches">
                            <div class="branch-true">
                                <strong>✅ はい（真）</strong><br>
                                はしに触れた<br>
                                ↓<br>
                                <strong>🏁 繰り返し終了</strong>
                            </div>
                            <div class="branch-false">
                                <strong>❌ いいえ（偽）</strong><br>
                                まだ端に着いていない<br>
                                ↓<br>
                                <strong>繰り返し続行</strong>
                            </div>
                        </div>
                        ↓（いいえの場合）
                        <div class="flow-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <strong>🚶 10歩動かす</strong><br>
                                <code>前に10歩進む</code>
                            </div>
                        </div>
                        ↓
                        <div class="flow-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <strong>⏰ 0.5秒待つ</strong><br>
                                <code>動きを確認しやすくする</code>
                            </div>
                        </div>
                        ↓
                        <div class="flow-step">
                            <div class="step-content">
                                <strong>🔄 条件チェックに戻る</strong><br>
                                <code>再び「はしに触れた？」を確認</code>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box learn">
                    <strong>🎓 repeat と repeat until の違い</strong><br>
                    • <strong>repeat (10)</strong>：決まった回数（10回）繰り返す<br>
                    • <strong>repeat until</strong>：条件が満たされるまで繰り返す<br>
                    • <strong>repeat until</strong>：何回繰り返すか分からない時に便利<br>
                    • <strong>条件</strong>：True（真）になったら繰り返しが止まる
                </div>
            </div>

            <!-- Step 5: 練習問題1 -->
            <div id="loop-step5" class="step-container">
                <h3>🎯 練習問題1: 色に着くまで動く</h3>
                <p>今度は「色に着く」という条件を使った繰り返しプログラムに挑戦してみましょう！</p>
                
                <div class="info-box learn">
                    <strong>📚 作ってみよう！</strong><br>
                    スプライトが赤色に着くまで動き続けるプログラム：<br>
                    • 赤色に着くまで繰り返す<br>
                    • 5歩ずつ動く<br>
                    • 0.3秒ずつ待つ<br>
                    • 着いたら「触れました！」と言う<br>
                </div>

                <h3>🎬 目標の動きを確認しよう</h3>
                <div class="animation-container">
                    <h4>🎨 色まで動くスプライト</h4>
                    <div class="stage">
                        <div id="sprite-color" class="sprite">🐱</div>
                        <div id="speech-bubble-color" class="speech-bubble"></div>
                        <div class="color-target" style="background: red; width: 30px; height: 30px; position: absolute; left: 250px; top: 90px;"></div>
                        <button class="play-btn" onclick="playColorAnimation()">▶️ 色まで動くアニメーション</button>
                        <button class="reset-btn" onclick="resetColorAnimation()">🔄 リセット</button>
                    </div>
                    <div class="animation-status" id="color-status">赤色に着くまで動き続けます</div>
                </div>

                <h3>📦 使うブロックを選ぼう</h3>
                <p>下のブロックの中から必要なものを選んで、正しい順番で組み立ててください：</p>
                
                <div class="blocks-grid">
                    <div class="block-item">
                        <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                        <div class="japanese-label">プログラム開始（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks"><>まで繰り返す {
} :: control</pre>
                        <div class="japanese-label">条件まで繰り返し（制御）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks"><[#ff0000] 色に触れた :: sensing></pre>
                        <div class="japanese-label">赤色に触れたかを調べる<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(5) 歩動かす :: motion</pre>
                        <div class="japanese-label">5歩移動（動き）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(0.3) 秒待つ :: control</pre>
                        <div class="japanese-label">0.3秒待機（制御）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">[触れました！] と言う :: looks</pre>
                        <div class="japanese-label">触れたメッセージ（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                </div>

                <div class="answer-section">
                    <button class="btn answer-btn" onclick="showUntilAnswer1()" id="untilAnswerBtn1">💡 答えを表示</button>
                    <div id="until-answer1" class="answer-container" style="display: none;">
                        <h4>✅ 正解:</h4>
                        <div class="block-container">
                            <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
<[#ff0000] 色に触れた :: sensing>まで繰り返す {
(5) 歩動かす :: motion
(0.3) 秒待つ :: control
} :: control
[触れました！] と言う :: looks
                            </pre>
                        </div>
                        <div class="info-box success">
                            <strong>🎉 よくできました！</strong> 条件まで繰り返しの基本が理解できています。
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 6: 練習問題2 -->
            <div id="loop-step6" class="step-container">
                <h3>🎯 練習問題2: マウスに触れるまで動く</h3>
                <p>最後はもう少し複雑な条件での繰り返しに挑戦です！</p>
                
                <div class="info-box learn">
                    <strong>📚 作ってみよう！</strong><br>
                    スプライトがマウスポインターに触れるまで動くプログラム：<br>
                    • マウスポインターに触れるまで繰り返す<br>
                    • マウスの方向を向く<br>
                    • 3歩ずつ動く<br>
                    • 近づいたら「こんにちは！」と言う<br>
                </div>

                <div class="stage">
                    <h4>🖱️ マウスに向かって動くスプライト</h4>
                    <div class="stage">
                        <div id="sprite-mouse" class="sprite">🐱</div>
                        <div id="speech-bubble-mouse" class="speech-bubble"></div>
                        <div id="mouse-pointer" style="position: absolute; left: 300px; top: 100px; font-size: 20px;">🖱️</div>
                        <button class="play-btn" onclick="playMouseAnimation()">▶️ マウスに向かうアニメーション</button>
                        <button class="reset-btn" onclick="resetMouseAnimation()">🔄 リセット</button>
                    </div>
                    <div class="animation-status" id="mouse-status">マウスポインターに触れるまで動き続けます！</div>
                </div>

                <h3>📦 使うブロックを選ぼう</h3>
                <p>下のブロックの中から必要なものを選んで、正しい順番で組み立ててください：</p>
                
                <div class="blocks-grid">
                    <div class="block-item">
                        <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                        <div class="japanese-label">プログラム開始（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks"><>まで繰り返す {
} :: control</pre>
                        <div class="japanese-label">条件まで繰り返し（制御）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks"><(マウスポインター v)に触れた :: sensing></pre>
                        <div class="japanese-label">(マウスポインター v)に触れたかを調べる<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(マウスポインター v)へ向ける :: motion</pre>
                        <div class="japanese-label">マウスへ向く（動き）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(3) 歩動かす :: motion</pre>
                        <div class="japanese-label">3歩移動（動き）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">[こんにちは！] と言う :: looks</pre>
                        <div class="japanese-label">挨拶メッセージ（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(0.1) 秒待つ :: control</pre>
                        <div class="japanese-label">0.1秒待機（制御）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                </div>

                <div class="answer-section">
                    <button class="btn answer-btn" onclick="showUntilAnswer2()" id="untilAnswerBtn2">💡 答えを表示</button>
                    <div id="until-answer2" class="answer-container" style="display: none;">
                        <h4>✅ 正解:</h4>
                        <div class="block-container">
                            <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
<(マウスポインター v)に触れた :: sensing>まで繰り返す {
(マウスポインター v)へ向ける :: motion
(3) 歩動かす :: motion
(0.1) 秒待つ :: control
} :: control
[こんにちは！] と言う :: looks
                            </pre>
                        </div>
                        <div class="info-box success">
                            <strong>🎉 完璧です！</strong> 条件まで繰り返しをマスターしました。様々な条件で繰り返しを制御できるようになりましたね！
                        </div>
                    </div>
                </div>
            </div>

            <div class="step-nav">
                <button class="btn" id="prevBtn-loop" onclick="changeLoopStep(-1)" disabled>前へ</button>
                <button class="btn" id="nextBtn-loop" onclick="changeLoopStep(1)">次へ</button>
                <button class="btn" onclick="showHome()" style="background: #666;">ホームに戻る</button>
            </div>
        </div>

        <!-- 座標とステージ -->
        <div id="coordinates" style="display: none;">
            <div class="progress-bar">
                <div id="progress-coordinates" class="progress-fill" style="width: 25%"></div>
            </div>
            <h2 id="step-title-coordinates">ステップ 1 / 4</h2>

            <!-- Step 1: アニメーションデモと必要なブロック -->
            <div id="coordinates-step1" class="step-container step-active">
                <h3>🎯 座標で動かすスプライト</h3>
                <div class="info-box learn">
                    <strong>📚 これから学ぶこと！</strong><br>
                    X・Y座標を使ってスプライトを正確な位置に動かします。<br>
                    • X座標：左右の位置（-240〜240）<br>
                    • Y座標：上下の位置（-180〜180）<br>
                    • 座標を指定してスプライトを移動<br>
                    • 四角形や三角形を描いてみよう<br><br>
                </div>

                <div class="stage">
                    <h4>🎯 座標で四角形を描くスプライト</h4>
                    <div class="stage">
                        <canvas id="coordinates-canvas" class="pen-canvas" width="400" height="300"></canvas>
                        <div id="sprite-coordinates" class="sprite">🐱</div>
                        <div id="speech-bubble-coordinates" class="speech-bubble"></div>
                        <!-- 座標軸とグリッド -->
                        <div style="position: absolute; left: 200px; top: 0; width: 1px; height: 100%; background: #ddd;"></div>
                        <div style="position: absolute; left: 0; top: 60px; width: 100%; height: 1px; background: #ddd;"></div>
                        <div style="position: absolute; left: 210px; top: 5px; font-size: 10px; color: #666;">X軸</div>
                        <div style="position: absolute; left: 5px; top: 50px; font-size: 10px; color: #666;">Y軸</div>
                        <button class="play-btn" onclick="playCoordinatesAnimation()">▶️ 四角形を描くアニメーション</button>
                        <button class="reset-btn" onclick="resetCoordinatesAnimation()">🔄 リセット</button>
                    </div>
                    <div class="animation-status" id="coordinates-status">座標を使って四角形を描きます！</div>
                </div>

                <h3>📦 座標で動かすために必要なブロック</h3>
                <p>座標を使ってスプライトを動かすためのブロックを確認しましょう：</p>
                
                <div class="blocks-grid">
                    <div class="block-item">
                        <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                        <div class="japanese-label">緑の旗がクリックされたとき（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">全部消す :: pen</pre>
                        <div class="japanese-label">画面の線を全部消す（ペン）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">ペンを置く :: pen</pre>
                        <div class="japanese-label">ペンで線を描き始める（ペン）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">x座標を (100) にする :: motion</pre>
                        <div class="japanese-label">X座標を指定して左右に移動<br><strong>📊 必要な個数: 3個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">y座標を (50) にする :: motion</pre>
                        <div class="japanese-label">Y座標を指定して上下に移動<br><strong>📊 必要な個数: 3個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(1) 秒待つ :: control</pre>
                        <div class="japanese-label">動きを見やすくするため<br><strong>📊 必要な個数: 4個</strong></div>
                    </div>
                </div>

                <div class="info-box hint">
                    <strong>💡 座標の仕組み：</strong> ステージの中央が(0, 0)で、右がプラスX、上がプラスYです。<br>
                    <strong>🔢 座標の範囲：</strong> X座標は-240〜240、Y座標は-180〜180の範囲で動かせます。
                </div>
            </div>

            <!-- Step 2: 組み立て方 -->
            <div id="coordinates-step2" class="step-container">
                <h3>🔧 このように組み立ててください</h3>
                <p>四角形を描くプログラムの組み立て方を見てみましょう：</p>
                
                <div class="block-container">
                    <h4>🎯 四角形を描くくみたてかた:</h4>
                    <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
全部消す :: pen
ペンを置く :: pen
x座標を (0) にする :: motion
y座標を (0) にする :: motion
(1) 秒待つ :: control
x座標を (100) にする :: motion
(1) 秒待つ :: control
y座標を (100) にする :: motion
(1) 秒待つ :: control
x座標を (0) にする :: motion
(1) 秒待つ :: control
y座標を (0) にする :: motion
                    </pre>
                    
                    <div class="info-box hint" style="margin-top: 15px;">
                        <strong>📖 動きの流れ:</strong><br>
                        1. 中央(0,0)からスタート<br>
                        2. 右に移動 → X座標を100に<br>
                        3. 上に移動 → Y座標を100に<br>
                        4. 左に移動 → X座標を0に<br>
                        5. 下に移動 → Y座標を0に戻る<br>
                        これで四角形の完成！
                    </div>
                </div>

                <div class="info-box success">
                    <strong>✅ ポイント！</strong> 座標を指定すると、スプライトがその位置に瞬間移動します。
                </div>
            </div>

            <!-- Step 3: 練習問題1 -->
            <div id="coordinates-step3" class="step-container">
                <h3>🎯 練習問題1: 三角形を描く</h3>
                <p>今度は座標を使って三角形を描いてみましょう！</p>
                
                <div class="info-box learn">
                    <strong>📚 作ってみよう！</strong><br>
                    三角形の3つの頂点を座標で指定します：<br>
                    • 1つ目：(0, 100) - 上の頂点<br>
                    • 2つ目：(-80, -50) - 左下の頂点<br>
                    • 3つ目：(80, -50) - 右下の頂点<br>
                    • 最後：(0, 100) - 上に戻って完成<br>
                </div>

                <div class="stage">
                    <h4>🔺 三角形を描くスプライト</h4>
                    <div class="stage">
                        <canvas id="triangle-canvas" class="pen-canvas" width="400" height="300"></canvas>
                        <div id="sprite-triangle" class="sprite">🐱</div>
                        <div id="speech-bubble-triangle" class="speech-bubble"></div>
                        <button class="play-btn" onclick="playTriangleAnimation()">▶️ 三角形アニメーション</button>
                        <button class="reset-btn" onclick="resetTriangleAnimation()">🔄 リセット</button>
                    </div>
                    <div class="animation-status" id="triangle-status">三角形の頂点を座標で指定します</div>
                </div>

                <h3>📦 使うブロックを選ぼう</h3>
                <div class="blocks-grid">
                    <div class="block-item">
                        <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                        <div class="japanese-label">プログラム開始<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">全部消す :: pen</pre>
                        <div class="japanese-label">画面の線を全部消す（ペン）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">ペンを置く :: pen</pre>
                        <div class="japanese-label">ペンで線を描き始める（ペン）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">x座標を (0) にする :: motion</pre>
                        <div class="japanese-label">X座標設定<br><strong>📊 必要な個数: 4個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">y座標を (100) にする :: motion</pre>
                        <div class="japanese-label">Y座標設定<br><strong>📊 必要な個数: 4個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(1) 秒待つ :: control</pre>
                        <div class="japanese-label">待機時間<br><strong>📊 必要な個数: 3個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">[三角形完成！] と言う :: looks</pre>
                        <div class="japanese-label">完成メッセージ<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                </div>

                <div class="answer-section">
                    <button class="btn answer-btn" onclick="showCoordinatesAnswer1()">💡 答えを表示</button>
                    <div id="coordinates-answer1" class="answer-container" style="display: none;">
                        <h4>✅ 正解:</h4>
                        <div class="block-container">
                            <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
全部消す :: pen
ペンを置く :: pen
x座標を (0) にする :: motion
y座標を (100) にする :: motion
(1) 秒待つ :: control
x座標を (-80) にする :: motion
y座標を (-50) にする :: motion
(1) 秒待つ :: control
x座標を (80) にする :: motion
y座標を (-50) にする :: motion
(1) 秒待つ :: control
x座標を (0) にする :: motion
y座標を (100) にする :: motion
[三角形完成！] と言う :: looks
                            </pre>
                        </div>
                        <div class="info-box success">
                            <strong>🎉 素晴らしい！</strong> 座標を使って三角形が描けました！
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: 練習問題2 -->
            <div id="coordinates-step4" class="step-container">
                <h3>🎯 練習問題2: 星型を描く</h3>
                <p>最後の挑戦として、5つの座標を使って星型を描いてみましょう！</p>
                
                <div class="info-box learn">
                    <strong>📚 チャレンジ！</strong><br>
                    星型の5つの頂点を座標で指定します：<br>
                    • 上の頂点：(0, 120)<br>
                    • 右上：(70, 40)<br>
                    • 右下：(45, -80)<br>
                    • 左下：(-45, -80)<br>
                    • 左上：(-70, 40)<br>
                    • 最後：(0, 120) - 元に戻って完成<br>
                </div>

                <div class="stage">
                    <h4>⭐ 星型を描くスプライト</h4>
                    <div class="stage">
                        <canvas id="star-canvas" class="pen-canvas" width="400" height="300"></canvas>
                        <div id="sprite-star" class="sprite">🐱</div>
                        <div id="speech-bubble-star" class="speech-bubble"></div>
                        <button class="play-btn" onclick="playStarAnimation()">▶️ 五角形アニメーション</button>
                        <button class="reset-btn" onclick="resetStarAnimation()">🔄 リセット</button>
                    </div>
                    <div class="animation-status" id="star-status">五角形の頂点を座標で移動します</div>
                </div>

                <h3>📦 使うブロックを選ぼう</h3>
                <div class="blocks-grid">
                    <div class="block-item">
                        <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                        <div class="japanese-label">プログラム開始<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">全部消す :: pen</pre>
                        <div class="japanese-label">画面の線を全部消す（ペン）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">ペンを置く :: pen</pre>
                        <div class="japanese-label">ペンで線を描き始める（ペン）<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">x座標を (0) にする :: motion</pre>
                        <div class="japanese-label">X座標設定<br><strong>📊 必要な個数: 6個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">y座標を (120) にする :: motion</pre>
                        <div class="japanese-label">Y座標設定<br><strong>📊 必要な個数: 6個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">(1) 秒待つ :: control</pre>
                        <div class="japanese-label">待機時間<br><strong>📊 必要な個数: 5個</strong></div>
                    </div>
                    <div class="block-item">
                        <pre class="blocks">[五角形完成！] と言う :: looks</pre>
                        <div class="japanese-label">完成メッセージ<br><strong>📊 必要な個数: 1個</strong></div>
                    </div>
                </div>

                <div class="answer-section">
                    <button class="btn answer-btn" onclick="showCoordinatesAnswer2()">💡 答えを表示</button>
                    <div id="coordinates-answer2" class="answer-container" style="display: none;">
                        <h4>✅ 正解:</h4>
                        <div class="block-container">
                            <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
全部消す :: pen
ペンを置く :: pen
x座標を (0) にする :: motion
y座標を (120) にする :: motion
(1) 秒待つ :: control
x座標を (70) にする :: motion
y座標を (40) にする :: motion
(1) 秒待つ :: control
x座標を (45) にする :: motion
y座標を (-80) にする :: motion
(1) 秒待つ :: control
x座標を (-45) にする :: motion
y座標を (-80) にする :: motion
(1) 秒待つ :: control
x座標を (-70) にする :: motion
y座標を (40) にする :: motion
(1) 秒待つ :: control
x座標を (0) にする :: motion
y座標を (120) にする :: motion
[星型完成！] と言う :: looks
                            </pre>
                        </div>
                        <div class="info-box success">
                            <strong>🎉 完璧です！</strong> 座標をマスターして星型まで描けました！
                        </div>
                    </div>
                </div>
            </div>

            <div class="step-nav">
                <button class="btn" id="prevBtn-coordinates" onclick="changeCoordinatesStep(-1)" disabled>前へ</button>
                <button class="btn" id="nextBtn-coordinates" onclick="changeCoordinatesStep(1)">次へ</button>
                <button class="btn" onclick="showHome()" style="background: #666;">ホームに戻る</button>
            </div>
        </div>
    </div>

    <!-- 変数と計算メニュー -->
    <div id="variables-menu" style="display: none;">
        <div class="container">
            <div class="header">
                <h1>📊 変数と計算</h1>
                <p>数字や文字を覚えて、計算してみよう！</p>
            </div>

            <div class="lesson-grid">
                <div class="lesson-card" onclick="showHealthSystem()">
                    <div class="emoji">💖</div>
                    <div class="lesson-title">体力システム</div>
                    <div class="lesson-desc">キャラクターの体力を変数で管理しよう！</div>
                </div>
                <div class="lesson-card" onclick="showScoreSystem()">
                    <div class="emoji">🏆</div>
                    <div class="lesson-title">スコア計算</div>
                    <div class="lesson-desc">ゲームの得点を計算してみよう！</div>
                </div>
                <div class="lesson-card" onclick="showStringVariables()">
                    <div class="emoji">💬</div>
                    <div class="lesson-title">文字の変数</div>
                    <div class="lesson-desc">名前やメッセージを覚えさせよう！</div>
                </div>
            </div>

            <div class="step-nav">
                <button class="btn" onclick="showHome()" style="background: #666;">ホームに戻る</button>
            </div>
        </div>
    </div>

    <!-- 体力システム -->
    <div id="health-system" style="display: none;">
        <div class="progress-bar">
            <div id="health-progress" class="progress-fill" style="width: 25%"></div>
        </div>
        <h2 id="health-step-title">ステップ 1 / 4</h2>

        <!-- Step 1: デモを見る -->
        <div id="health-step1" class="step-container step-active">
            <h3>💖 キャラクターの体力システム</h3>
            <div class="info-box learn">
                <strong>📚 体力システムについて学ぼう！</strong><br>
                変数は数字を覚えておく「箱」のようなものです。<br>
                キャラクターの体力を変数で管理すると：<br>
                • ダメージを受けたときに体力が減る<br>
                • 回復アイテムで体力が増える<br>
                • 体力が0になったらゲームオーバー<br><br>
                <strong>🎓 今日のもくひょう:</strong> 体力変数を使ったシステムを作ろう！
            </div>

            <h3>🎬 体力システムの動きを見てみよう</h3>
            <p>まずは体力システムがどのように動くか確認しましょう。</p>
            
            <div class="animation-container">
                <h4>❤️ 体力変数のデモ</h4>
                <div class="stage">
                    <div class="sprite">🧙‍♂️</div>
                    <div id="health-display" style="font-size: 24px; color: #4CAF50; margin: 20px;">❤️ 体力: 100</div>
                    <button class="play-btn" onclick="playHealthAnimation()">▶️ 体力システムを見る</button>
                    <button class="reset-btn" onclick="resetHealthAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="health-status">体力システムのアニメーション</div>
            </div>

            <div class="info-box hint">
                <strong>🤔 どんな動きをした？</strong> 体力が100から始まって、ダメージで80、60と減り、最後に回復アイテムで100に戻りました！
            </div>

            <h3>📦 体力システムに必要なブロック</h3>
            <p>キャラクターの体力を管理するために必要なブロックです：</p>
            
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">プログラムの開始（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(体力 :: variables) を (100) にする :: variables</pre>
                    <div class="japanese-label">体力を100に設定（変数ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(体力 :: variables) を (-20) ずつ変える :: variables</pre>
                    <div class="japanese-label">体力を20減らす（変数ブロック）<br><strong>📊 必要な個数: 2個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(体力 :: variables) と言う :: looks</pre>
                    <div class="japanese-label">体力を表示（見た目ブロック）<br><strong>📊 必要な個数: 3個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(2) 秒待つ :: control</pre>
                    <div class="japanese-label">待機（制御ブロック）<br><strong>📊 必要な個数: 2個</strong></div>
                </div>
            </div>

            <div class="info-box success">
                <strong>✨ 次のステップで</strong> これらのブロックを組み立てて、実際に体力システムを作ってみましょう！
            </div>
        </div>

        <!-- Step 2: 組み立て -->
        <div id="health-step2" class="step-container">
            <h3>🔧 体力システムを組み立てよう！</h3>
            <p>変数「体力」を使って、キャラクターの体力が変わるプログラムを作ります。</p>
            
            <div class="block-container">
                <h4>🎯 組み立て方:</h4>
                <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(体力 :: variables) を (100) にする :: variables
(体力 :: variables) と言う :: looks
(2) 秒待つ :: control
(体力 :: variables) を (-20) ずつ変える :: variables
(体力 :: variables) と言う :: looks
(2) 秒待つ :: control
(体力 :: variables) を (-20) ずつ変える :: variables
(体力 :: variables) と言う :: looks
                </pre>
            </div>

            <div class="info-box hint">
                <strong>💡 ポイント:</strong><br>
                • 変数「体力」をまず100に設定<br>
                • 「-20ずつ変える」でダメージを表現<br>
                • 変数の値を言うブロックで体力を表示<br>
                • 体力が100→80→60と変化します
            </div>

            <div class="info-box success">
                <strong>✅ やってみよう！</strong> 実際のScratchでこのとおりにブロックを組み立てて、緑の旗を押してみてください！
            </div>
        </div>

        <!-- Step 3: 練習問題 -->
        <div id="health-step3" class="step-container">
            <h3>🎯 練習問題：シンプルな体力システム</h3>
            <p>学んだことを活かして、体力システムの練習問題に挑戦しましょう！</p>
            
            <div class="info-box learn">
                <strong>📚 練習問題: 体力80から始めよう</strong><br>
                次の動きをするプログラムを作りましょう：<br>
                • キャラクターの体力を80に設定<br>
                • 「体力:80」と表示<br>
                • 2秒待つ<br>
                • 体力を30減らす<br>
                • 「体力:50」と表示<br>
            </div>

            <h3>📦 使うブロックを選ぼう</h3>
            <p>下のブロックの中から必要なものを選んで、正しい順番で組み立ててください：</p>
            
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">緑の旗がクリックされたとき（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(体力 :: variables) を (80) にする :: variables</pre>
                    <div class="japanese-label">体力を80に設定（変数）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(体力 :: variables) を (-30) ずつ変える :: variables</pre>
                    <div class="japanese-label">体力を30減らす（変数）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">([体力:] と (体力 :: variables) をつなげる :: operators) と言う :: looks</pre>
                    <div class="japanese-label">体力を表示（見た目）<br><strong>📊 必要な個数: 2個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(2) 秒待つ :: control</pre>
                    <div class="japanese-label">2秒待つ（制御）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
            </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showHealthAnswer1()" id="healthAnswerBtn1">💡 答えを表示</button>
                <div id="health-answer1" class="answer-container" style="display: none;">
                    <h4>✅ 正解:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(体力 :: variables) を (80) にする :: variables
([体力:] と (体力 :: variables) をつなげる :: operators) と言う :: looks
(2) 秒待つ :: control
(体力 :: variables) を (-30) ずつ変える :: variables
([体力:] と (体力 :: variables) をつなげる :: operators) と言う :: looks
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 よくできました！</strong> 変数の基本的な使い方が理解できています。
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: まとめ -->
        <div id="health-step4" class="step-container">
            <h3>🌟 体力システムをマスターしました！</h3>
            
            <div class="info-box learn">
                <strong>🎓 学んだこと:</strong><br>
                • 変数は数字を覚える「箱」<br>
                • 「〜にする」で変数に値を設定<br>
                • 「〜ずつ変える」で値を増減<br>
                • 変数と文字をつなげて表示<br><br>
                <strong>💡 体力システムの活用:</strong><br>
                • RPGゲームのHP管理<br>
                • アクションゲームのライフ<br>
                • 食べ物ゲームの満腹度など
            </div>

            <div class="animation-container">
                <h4>🎉 最終デモンストレーション</h4>
                <div class="stage">
                    <div class="sprite">🧙‍♂️</div>
                    <div id="health-display-final" style="font-size: 24px; color: #4CAF50; margin: 20px;">❤️ 体力: 100</div>
                    <button class="play-btn" onclick="playHealthAnimation()">▶️ もう一度見る</button>
                    <button class="reset-btn" onclick="resetHealthAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="health-status-final">体力システムを完全にマスターしました！</div>
            </div>

            <div class="info-box success">
                <strong>🏆 次はスコア計算システムに挑戦してみましょう！</strong><br>
                変数を使ってゲームの得点を計算する方法を学びます。
            </div>
        </div>

        <!-- ナビゲーション -->
        <div class="step-nav">
            <button class="btn" id="healthPrevBtn" onclick="changeHealthStep(-1)" disabled>前へ</button>
            <button class="btn" id="healthNextBtn" onclick="changeHealthStep(1)">次へ</button>
        </div>
    </div>

    <!-- スコア計算システム -->
    <div id="score-system" style="display: none;">
        <div class="progress-bar">
            <div id="score-progress" class="progress-fill" style="width: 33%"></div>
        </div>
        <h2 id="score-step-title">ステップ 1 / 3</h2>

        <!-- Step 1: デモを見る -->
        <div id="score-step1" class="step-container step-active">
            <h3>🏆 ゲームスコア計算システム</h3>
            <div class="info-box learn">
                <strong>📚 スコア計算について学ぼう！</strong><br>
                ゲームでは得点（スコア）を計算することがとても大切です。<br>
                • アイテムを取ったら点数が増える<br>
                • ボーナスで高い点数がもらえる<br>
                • 最終的に合計点数を計算<br><br>
                <strong>🎓 今日のもくひょう:</strong> 変数を使ってスコアを計算しよう！
            </div>

            <h3>🎬 スコア計算の動きを見てみよう</h3>
            <p>まずはスコアがどのように計算されるか確認しましょう。</p>
            
            <div class="animation-container">
                <h4>🎮 スコア計算のデモ</h4>
                <div class="stage">
                    <div class="sprite">🎯</div>
                    <div id="score-display" style="font-size: 24px; color: #2c3e50; margin: 20px;">🏆 スコア: 0</div>
                    <button class="play-btn" onclick="playScoreAnimation()">▶️ スコア計算を見る</button>
                    <button class="reset-btn" onclick="resetScoreAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="score-status">スコア計算のアニメーション</div>
            </div>

            <div class="info-box hint">
                <strong>🤔 どんな計算をした？</strong> スコアが0から始まって、アイテムで+10、+10、ボーナスで+50の合計70点になりました！
            </div>

            <h3>📦 スコア計算に必要なブロック</h3>
            <p>ゲームのスコアを計算するために必要なブロックです：</p>
            
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">プログラムの開始（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(スコア :: variables) を (0) にする :: variables</pre>
                    <div class="japanese-label">スコアを0に設定（変数ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(スコア :: variables) を (10) ずつ変える :: variables</pre>
                    <div class="japanese-label">スコアを10点追加（変数ブロック）<br><strong>📊 必要な個数: 2個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(スコア :: variables) を (50) ずつ変える :: variables</pre>
                    <div class="japanese-label">ボーナス50点追加（変数ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[スコア:] と (スコア :: variables) をつなげる :: operators</pre>
                    <div class="japanese-label">スコア表示の文字を作る（演算ブロック）<br><strong>📊 必要な個数: 3個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">([スコア:] と (スコア :: variables) をつなげる :: operators) と言う :: looks</pre>
                    <div class="japanese-label">スコアを表示（見た目ブロック）<br><strong>📊 必要な個数: 3個</strong></div>
                </div>
            </div>

            <div class="info-box success">
                <strong>✨ 次のステップで</strong> これらのブロックを組み立てて、実際にスコア計算システムを作ってみましょう！
            </div>
        </div>

        <!-- Step 2: 組み立て -->
        <div id="score-step2" class="step-container">
            <h3>🔧 スコア計算システムを組み立てよう！</h3>
            <p>変数「スコア」を使って、ゲームの得点を計算するプログラムを作ります。</p>
            
            <div class="block-container">
                <h4>🎯 組み立て方:</h4>
                <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(スコア :: variables) を (0) にする :: variables
([スコア:] と (スコア :: variables) をつなげる :: operators) と言う :: looks
(2) 秒待つ :: control
(スコア :: variables) を (10) ずつ変える :: variables
([スコア:] と (スコア :: variables) をつなげる :: operators) と言う :: looks
(2) 秒待つ :: control
(スコア :: variables) を (10) ずつ変える :: variables
([スコア:] と (スコア :: variables) をつなげる :: operators) と言う :: looks
(2) 秒待つ :: control
(スコア :: variables) を (50) ずつ変える :: variables
([スコア:] と (スコア :: variables) をつなげる :: operators) と言う :: looks
                </pre>
            </div>

            <div class="info-box hint">
                <strong>💡 ポイント:</strong><br>
                • 変数「スコア」をまず0に設定<br>
                • 「+10ずつ変える」でアイテム取得<br>
                • 「+50ずつ変える」でボーナス獲得<br>
                • 「つなげる」で文字と数字を組み合わせ表示
            </div>

            <div class="info-box learn">
                <strong>🎓 計算のしくみ:</strong><br>
                • アイテム1個 = +10点<br>
                • アイテム2個 = +10点<br>
                • ボーナスアイテム = +50点<br>
                • 最終スコア = 0 + 10 + 10 + 50 = 70点
            </div>
        </div>

        <!-- Step 3: 練習問題 -->
        <div id="score-step3" class="step-container">
            <h3>🎯 練習問題：簡単スコア計算</h3>
            <p>学んだことを活かして、スコア計算の練習問題に挑戦しましょう！</p>
            
            <div class="info-box learn">
                <strong>📚 練習問題: 100点ゲーム</strong><br>
                次の動きをするプログラムを作りましょう：<br>
                • スコアを0に設定<br>
                • 「スコア:0」と表示<br>
                • スコアを30点追加<br>
                • 「スコア:30」と表示<br>
                • さらに70点追加<br>
                • 「スコア:100」と表示<br>
            </div>

            <h3>📦 使うブロックを選ぼう</h3>
            <p>下のブロックの中から必要なものを選んで、正しい順番で組み立ててください：</p>
            
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">緑の旗がクリックされたとき（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(スコア :: variables) を (0) にする :: variables</pre>
                    <div class="japanese-label">スコアを0に設定（変数）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(スコア :: variables) を (30) ずつ変える :: variables</pre>
                    <div class="japanese-label">スコアを30追加（変数）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(スコア :: variables) を (70) ずつ変える :: variables</pre>
                    <div class="japanese-label">スコアを70追加（変数）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">([スコア:] と (スコア :: variables) をつなげる :: operators) と言う :: looks</pre>
                    <div class="japanese-label">スコアを表示（見た目）<br><strong>📊 必要な個数: 3個</strong></div>
                </div>
            </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showScoreAnswer1()" id="scoreAnswerBtn1">💡 答えを表示</button>
                <div id="score-answer1" class="answer-container" style="display: none;">
                    <h4>✅ 正解:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(スコア :: variables) を (0) にする :: variables
([スコア:] と (スコア :: variables) をつなげる :: operators) と言う :: looks
(スコア :: variables) を (30) ずつ変える :: variables
([スコア:] と (スコア :: variables) をつなげる :: operators) と言う :: looks
(スコア :: variables) を (70) ずつ変える :: variables
([スコア:] と (スコア :: variables) をつなげる :: operators) と言う :: looks
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 素晴らしい！</strong> スコア計算と表示の仕組みが理解できました。
                    </div>
                </div>
            </div>
            
            <div class="info-box learn">
                <strong>🌟 スコアシステムをマスターしました！</strong><br>
                • 変数でスコアを管理<br>
                • 加算でポイント獲得<br>
                • 文字列と数値の組み合わせ表示<br><br>
                <strong>💡 応用例:</strong><br>
                • シューティングゲームの得点<br>
                • パズルゲームのクリア点数<br>
                • 料理ゲームの評価ポイント
            </div>
        </div>

        <!-- ナビゲーション -->
        <div class="step-nav">
            <button class="btn" id="scorePrevBtn" onclick="changeScoreStep(-1)" disabled>前へ</button>
            <button class="btn" id="scoreNextBtn" onclick="changeScoreStep(1)">次へ</button>
        </div>
    </div>

    <!-- 文字列変数システム -->
    <div id="string-variables" style="display: none;">
        <div class="progress-bar">
            <div id="string-progress" class="progress-fill" style="width: 33%"></div>
        </div>
        <h2 id="string-step-title">ステップ 1 / 3</h2>

        <!-- Step 1: デモを見る -->
        <div id="string-step1" class="step-container step-active">
            <h3>💬 文字列変数：名前を覚えよう</h3>
            <div class="info-box learn">
                <strong>📚 文字列変数について学ぼう！</strong><br>
                変数は数字だけでなく、文字（もじ）も覚えることができます。<br>
                • プレイヤーの名前を覚える<br>
                • 好きな色やペットの名前<br>
                • メッセージや物語を作る<br><br>
                <strong>🎓 今日のもくひょう:</strong> 文字を覚えて、あいさつシステムを作ろう！
            </div>

            <h3>🎬 文字列変数の動きを見てみよう</h3>
            <p>まずは文字列変数がどのように動くか確認しましょう。</p>
            
            <div class="animation-container">
                <h4>📝 文字列変数のデモ</h4>
                <div class="stage">
                    <div class="sprite">👋</div>
                    <div id="name-display" style="font-size: 20px; color: #2c3e50; margin: 20px;">👤 名前: </div>
                    <button class="play-btn" onclick="playNameAnimation()">▶️ 名前システムを見る</button>
                    <button class="reset-btn" onclick="resetNameAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="name-status">文字列変数のアニメーション</div>
            </div>

            <div class="info-box hint">
                <strong>🤔 どんな動きをした？</strong> 名前を入力して、その名前を使って色々なあいさつができました！
            </div>

            <h3>📦 名前システムに必要なブロック</h3>
            <p>プレイヤーの名前を覚えて、あいさつするプログラムです：</p>
            
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">プログラムの開始（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[お名前を入力してください] と聞いて待つ :: sensing</pre>
                    <div class="japanese-label">名前を聞く（調べるブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(名前 :: variables) を (答え :: sensing) にする :: variables</pre>
                    <div class="japanese-label">答えを名前変数に保存（変数ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[こんにちは、] と (名前 :: variables) をつなげる :: operators</pre>
                    <div class="japanese-label">あいさつ文を作る（演算ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">([こんにちは、] と (名前 :: variables) をつなげる :: operators) と言う :: looks</pre>
                    <div class="japanese-label">あいさつを表示（見た目ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
            </div>

            <div class="info-box success">
                <strong>✨ 次のステップで</strong> これらのブロックを組み立てて、実際に名前システムを作ってみましょう！
            </div>
        </div>

        <!-- Step 2: 組み立て -->
        <div id="string-step2" class="step-container">
            <h3>🔧 名前システムを組み立てよう！</h3>
            <p>変数「名前」を使って、プレイヤーの名前を覚えてあいさつするプログラムを作ります。</p>
            
            <div class="block-container">
                <h4>🎯 組み立て方:</h4>
                <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
[お名前を入力してください] と聞いて待つ :: sensing
(名前 :: variables) を (答え :: sensing) にする :: variables
([こんにちは、] と (名前 :: variables) をつなげる :: operators) と言う :: looks
(2) 秒待つ :: control
([今日も元気ですね、] と (名前 :: variables) をつなげる :: operators) と言う :: looks
                </pre>
            </div>

            <div class="info-box hint">
                <strong>💡 文字列変数のポイント:</strong><br>
                • 文字列 = 文字や言葉を入れる変数<br>
                • 「つなげる」ブロックで文字を組み合わせ<br>
                • 「と聞いて待つ」でユーザー入力を受け取り<br>
                • 「答え」ブロックで入力された内容を取得
            </div>

            <div class="info-box success">
                <strong>✅ やってみよう！</strong> 実際のScratchでこのとおりにブロックを組み立てて、緑の旗を押してみてください！
            </div>
        </div>

        <!-- Step 3: 練習問題 -->
        <div id="string-step3" class="step-container">
            <h3>🎯 練習問題：好きな色システム</h3>
            <p>学んだことを活かして、文字列変数の練習問題に挑戦しましょう！</p>
            
            <div class="info-box learn">
                <strong>📚 練習問題: 好きな色を聞こう</strong><br>
                次の動きをするプログラムを作りましょう：<br>
                • プレイヤーに「好きな色は？」と質問<br>
                • 答えを「色」変数に保存<br>
                • 「あなたの好きな色は○○ですね！」と表示<br>
            </div>

            <h3>📦 使うブロックを選ぼう</h3>
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">緑の旗がクリックされたとき（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[好きな色は？] と聞いて待つ :: sensing</pre>
                    <div class="japanese-label">質問をする（調べる）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(色 :: variables) を (答え :: sensing) にする :: variables</pre>
                    <div class="japanese-label">答えを変数に保存（変数）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[あなたの好きな色は] と (色 :: variables) をつなげる :: operators</pre>
                    <div class="japanese-label">文字をつなげる1（演算）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">([あなたの好きな色は] と (色 :: variables) をつなげる :: operators) と [ですね！] をつなげる :: operators</pre>
                    <div class="japanese-label">文字をつなげる2（演算）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(完成した文章) と言う :: looks</pre>
                    <div class="japanese-label">メッセージを表示（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
            </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showStringAnswer1()" id="stringAnswerBtn1">💡 答えを表示</button>
                <div id="string-answer1" class="answer-container" style="display: none;">
                    <h4>✅ 正解:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
[好きな色は？] と聞いて待つ :: sensing
(色 :: variables) を (答え :: sensing) にする :: variables
((([あなたの好きな色は] と (色 :: variables) をつなげる :: operators) と [ですね！] をつなげる :: operators)) と言う :: looks
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 素晴らしい！</strong> 文字列変数と演算ブロックの組み合わせができました。
                    </div>
                </div>
            </div>
            
            <div class="info-box learn">
                <strong>🌟 文字列変数をマスターしました！</strong><br>
                • 文字を覚える変数の使い方<br>
                • ユーザー入力の受け取り方<br>
                • 文字列の連結と表示<br><br>
                <strong>💡 応用例:</strong><br>
                • 物語ゲームのキャラクター名<br>
                • クイズゲームの答え入力<br>
                • 日記アプリのメッセージ保存
            </div>
        </div>

        <!-- ナビゲーション -->
        <div class="step-nav">
            <button class="btn" id="stringPrevBtn" onclick="changeStringStep(-1)" disabled>前へ</button>
            <button class="btn" id="stringNextBtn" onclick="changeStringStep(1)">次へ</button>
        </div>
    </div>

    <!-- 見た目の変更セクション -->
    <div id="costumes-section" style="display: none;">
        <div class="progress-bar">
            <div id="costumes-progress" class="progress-fill" style="width: 25%"></div>
        </div>
        <h2 id="costumes-step-title">ステップ 1 / 4</h2>

        <!-- Step 1: デモを見る -->
        <div id="costumes-step1" class="step-container step-active">
            <h3>👗 見た目の変更：キャラクターの姿を変えよう</h3>
            <div class="info-box learn">
                <strong>📚 見た目の変更について学ぼう！</strong><br>
                Scratchでは、スプライトの見た目をいろいろな方法で変更できます。<br>
                • <strong>コスチューム変更</strong>：キャラクターの服装や表情を変える<br>
                • <strong>サイズ変更</strong>：キャラクターを大きくしたり小さくしたり<br>
                • <strong>色効果</strong>：キャラクターの色を変える<br>
                • <strong>透明効果</strong>：キャラクターを透明にする<br><br>
                <strong>🎓 今日のもくひょう:</strong> 見た目の変更をマスターしよう！
            </div>

            <h3>🎬 見た目の変更を見てみよう</h3>
            <p>まずは見た目がどのように変わるか確認しましょう。</p>
            
            <div class="animation-container">
                <h4>🎭 見た目変更のデモ</h4>
                <div class="stage" style="height: 300px; position: relative; overflow: visible;">
                    <div id="sprite-costumes" class="sprite" style="position: absolute; left: 200px; top: 100px; width: 80px; height: 80px; background: #ff6b6b; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; color: white; font-weight: bold; border: 3px solid #333; transition: all 0.5s ease; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">🐱</div>
                    <div id="speech-bubble-costumes" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playCostumesAnimation()">▶️ 見た目の変更を見る</button>
                    <button class="reset-btn" onclick="resetCostumesAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="costumes-status">見た目が変わる様子を見てみよう！</div>
            </div>

            <div class="info-box hint">
                <strong>🤔 どんな変化をした？</strong> キャラクターの見た目が順番に変わりました！大きさ、色、透明度など、いろいろな効果を組み合わせました。
            </div>

            <h3>📦 見た目の変更に必要なブロック</h3>
            <p>見た目を変更するために必要なブロックです：</p>
            
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">プログラムの開始（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">コスチュームを [コスチューム2 v] にする :: looks</pre>
                    <div class="japanese-label">コスチューム変更（見た目ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">大きさを (150) ％にする :: looks</pre>
                    <div class="japanese-label">サイズ変更（見た目ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[色 v] の効果を (50) にする :: looks</pre>
                    <div class="japanese-label">色効果（見た目ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[うれしい！] と言う :: looks</pre>
                    <div class="japanese-label">メッセージ表示（見た目ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(2) 秒待つ :: control</pre>
                    <div class="japanese-label">待機（制御ブロック）<br><strong>📊 必要な個数: 3個</strong></div>
                </div>
            </div>

            <div class="info-box success">
                <strong>✨ 次のステップで</strong> これらのブロックを組み立てて、実際に見た目を変更してみましょう！
            </div>
        </div>

        <!-- Step 2: 組み立て -->
        <div id="costumes-step2" class="step-container">
            <h3>🔧 見た目変更プログラムを組み立てよう！</h3>
            <p>見た目を変更するブロックを組み立てて、キャラクターを変身させます。</p>
            
            <div class="block-container">
                <h4>🎯 組み立て方:</h4>
                <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
コスチュームを [コスチューム2 v] にする :: looks
[新しい見た目！] と言う :: looks
(2) 秒待つ :: control
大きさを (150) ％にする :: looks
[大きくなった！] と言う :: looks
(2) 秒待つ :: control
[色 v] の効果を (50) にする :: looks
[色も変わった！] と言う :: looks
                </pre>
            </div>

            <div class="info-box hint">
                <strong>💡 重要なポイント！</strong><br>
                • <strong>「コスチュームを〜にする」</strong>：キャラクターの見た目を変える<br>
                • <strong>「大きさを〜％にする」</strong>：キャラクターのサイズを変える<br>
                • <strong>「色の効果を〜にする」</strong>：キャラクターの色を変える<br>
                • <strong>「〜と言う」</strong>：変化を説明するメッセージを表示
            </div>

            <div class="info-box learn">
                <strong>🎓 見た目の変更の基本ルール</strong><br>
                • 効果は重ねて使うことができる<br>
                • 効果の値を変えることで、変化の度合いを調整できる<br>
                • 「元に戻す」ことも可能<br>
                • アニメーションのような効果を作れる
            </div>

            <div class="info-box success">
                <strong>✅ やってみよう！</strong> 実際のScratchで組み立てて、キャラクターが変身する様子を確認してみてください！
            </div>
        </div>

        <!-- Step 3: 詳しい解説 -->
        <div id="costumes-step3" class="step-container">
            <h3>🔍 見た目効果の種類を詳しく学ぼう</h3>
            <p>Scratchで使える見た目効果について詳しく解説します。</p>
            
            <div class="info-box learn">
                <strong>📚 見た目効果の種類</strong><br>
                Scratchには多くの見た目効果があります：<br>
                • <strong>色効果</strong>：キャラクターの色相を変える（0-200）<br>
                • <strong>魚眼効果</strong>：レンズのような歪みを作る<br>
                • <strong>旋回効果</strong>：渦巻きのような効果<br>
                • <strong>ピクセル効果</strong>：モザイクのような効果<br>
                • <strong>モザイク効果</strong>：画像をぼかす効果<br>
                • <strong>明度効果</strong>：明るさを変える<br>
                • <strong>幽霊効果</strong>：透明度を変える（0-100）
            </div>

            <h3>🎬 いろいろな効果を見てみよう</h3>
            <div class="animation-container">
                <h4>🌈 効果の種類デモ</h4>
                <div class="stage">
                    <div id="sprite-effects" class="sprite" style="position: absolute; left: 200px; top: 100px;">🎭</div>
                    <div id="speech-bubble-effects" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playEffectsAnimation()">▶️ いろいろな効果を見る</button>
                    <button class="reset-btn" onclick="resetEffectsAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="effects-status">様々な効果を体験してみよう</div>
            </div>

            <div class="info-box hint">
                <strong>🤔 理解のポイント</strong><br>
                • 効果は数値で強さを調整できる<br>
                • 複数の効果を同時に使うことも可能<br>
                • 「全ての効果をなくす」で元に戻せる<br>
                • ゲームやアニメーションで表現力がアップ
            </div>

            <h3>📊 見た目変更を使った表現の例</h3>
            <div class="blocks-grid">
                <div class="block-item">
                    <div class="example-icon">👻</div>
                    <div class="example-title">幽霊効果</div>
                    <div class="example-desc">キャラクターがだんだん透明になって消える</div>
                </div>
                <div class="block-item">
                    <div class="example-icon">🌈</div>
                    <div class="example-title">色変化</div>
                    <div class="example-desc">キャラクターの色が虹色に変わる</div>
                </div>
                <div class="block-item">
                    <div class="example-icon">📏</div>
                    <div class="example-title">サイズ変化</div>
                    <div class="example-desc">キャラクターが大きくなったり小さくなったり</div>
                </div>
                <div class="block-item">
                    <div class="example-icon">🎪</div>
                    <div class="example-title">変身シーン</div>
                    <div class="example-desc">コスチュームを変えて華麗な変身</div>
                </div>
            </div>

            <div class="info-box success">
                <strong>✨ 次は実際に作ってみよう！</strong> ステップ4では実際に見た目変更を使った表現を体験します。
            </div>
        </div>

        <!-- Step 4: 練習問題 -->
        <div id="costumes-step4" class="step-container">
            <h3>🎯 練習問題: 虹色変身アニメーション</h3>
            <p>キャラクターが虹色に変身するアニメーションを作りましょう！</p>
            
            <div class="info-box learn">
                <strong>📚 チャレンジ内容</strong><br>
                今回は以下のプログラムを作ります：<br>
                • キャラクターが「変身します！」と言う<br>
                • 6回繰り返して虹色に変化<br>
                • 各色で0.5秒待つ<br>
                • 最後に元の色に戻る<br>
                • 「変身完了！」と言う
            </div>

            <h3>🎬 目標の動きを確認しよう</h3>
            <div class="animation-container">
                <h4>🌈 虹色変身アニメーション</h4>
                <div class="stage">
                    <div id="sprite-rainbow" class="sprite" style="position: absolute; left: 200px; top: 100px;">🦄</div>
                    <div id="speech-bubble-rainbow" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playRainbowAnimation()">▶️ 虹色変身アニメーション</button>
                    <button class="reset-btn" onclick="resetRainbowAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="rainbow-status">虹色に変身するアニメーション</div>
            </div>

            <h3>📦 使うブロックを選ぼう</h3>
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">プログラム開始<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[変身します！] と言う :: looks</pre>
                    <div class="japanese-label">開始メッセージ<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(6) 回繰り返す {
} :: control</pre>
                    <div class="japanese-label">6回繰り返し<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[色 v] の効果を (30) ずつ変える :: looks</pre>
                    <div class="japanese-label">色効果を変更<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(0.5) 秒待つ :: control</pre>
                    <div class="japanese-label">短い待機<br><strong>📊 必要な個数: 2個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[色 v] の効果をなくす :: looks</pre>
                    <div class="japanese-label">色効果リセット<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[変身完了！] と言う :: looks</pre>
                    <div class="japanese-label">完了メッセージ<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
            </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showCostumesAnswer()">💡 答えを表示</button>
                <div id="costumes-answer" class="answer-container" style="display: none;">
                    <h4>✅ 正解プログラム:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
[変身します！] と言う :: looks
(0.5) 秒待つ :: control
(6) 回繰り返す {
[色 v] の効果を (30) ずつ変える :: looks
(0.5) 秒待つ :: control
} :: control
[色 v] の効果をなくす :: looks
[変身完了！] と言う :: looks
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 よくできました！</strong><br>
                        • 繰り返しブロックで6回色を変更<br>
                        • 「ずつ変える」で段階的に色を変化<br>
                        • 待機ブロックでアニメーション効果<br>
                        • 最後に効果をリセット
                    </div>
                </div>
            </div>

            <div class="info-box challenge">
                <strong>🚀 さらなるチャレンジ！</strong><br>
                基本ができたら、こんなアレンジも試してみよう：<br>
                • 大きさも一緒に変えてみる<br>
                • 幽霊効果と組み合わせる<br>
                • 繰り返し回数を変える<br>
                • コスチュームも変更してみる
            </div>
        </div>

        <div class="step-nav">
            <button class="btn" id="costumesPrevBtn" onclick="changeCostumesStep(-1)" disabled>前へ</button>
            <button class="btn" id="costumesNextBtn" onclick="changeCostumesStep(1)">次へ</button>
            <button class="btn" onclick="showHome()" style="background: #666;">ホームに戻る</button>
        </div>
    </div>

    <!-- クローン機能メニュー -->
    <div id="clones-menu" style="display: none;">
        <div class="container">
            <div style="background: #7C3F9E; color: white; padding: 25px; border-radius: 20px; margin-bottom: 30px; text-align: center; box-shadow: 0 8px 20px rgba(124, 63, 158, 0.3); border: 3px solid #fff;">
                <h1>👥 クローン機能</h1>
                <p>スプライトをたくさん作ってみよう！</p>
            </div>

            <div class="lesson-grid">
                <div class="lesson-card" onclick="showBasicClone()">
                    <div class="emoji">🧬</div>
                    <div class="lesson-title">基本的なクローン作成</div>
                    <div class="lesson-desc">クローンの基本概念を学ぼう！</div>
                </div>
                <div class="lesson-card" onclick="showCloneMovement()">
                    <div class="emoji">🏃</div>
                    <div class="lesson-title">クローンで動きを作る</div>
                    <div class="lesson-desc">複数のクローンに動きを与えよう！</div>
                </div>
                <div class="lesson-card" onclick="showCloneDeletion()">
                    <div class="emoji">🗑️</div>
                    <div class="lesson-title">クローンの削除と管理</div>
                    <div class="lesson-desc">クローンを上手に管理しよう！</div>
                </div>
                <div class="lesson-card" onclick="showCloneApplications()">
                    <div class="emoji">🎆</div>
                    <div class="lesson-title">クローンを使った応用例</div>
                    <div class="lesson-desc">星空や花火を作ってみよう！</div>
                </div>
            </div>

            <div class="step-nav">
                <button class="btn" onclick="showHome()" style="background: #666;">ホームに戻る</button>
            </div>
        </div>
    </div>

    <!-- 基本的なクローン作成 -->
    <div id="basic-clone-section" style="display: none;">
        <div class="progress-bar">
            <div id="clone-basic-progress" class="progress-fill" style="width: 25%"></div>
        </div>
        <h2 id="clone-basic-step-title">ステップ 1 / 4</h2>

        <!-- Step 1: デモを見る -->
        <div id="clone-basic-step1" class="step-container step-active">
            <h3>🧬 基本的なクローン作成：スプライトをコピーしよう</h3>
            <div class="info-box learn">
                <strong>📚 クローンについて学ぼう！</strong><br>
                クローンとは、元のスプライトとまったく同じ見た目のコピーを作る機能です。<br>
                • 1つのスプライトから何個でもコピーが作れる<br>
                • それぞれのクローンは独立して動かせる<br>
                • ゲームでたくさんのキャラクターや物を出したいときに便利<br><br>
                <strong>🎓 今日のもくひょう:</strong> クローン機能の基本をマスターしよう！
            </div>

            <h3>🎬 クローン作成の動きを見てみよう</h3>
            <p>まずはクローンがどのように作られるか確認しましょう。</p>
            
            <div class="animation-container">
                <h4>👥 クローン作成のデモ</h4>
                <div class="stage" style="height: 300px; position: relative; overflow: visible;">
                    <div id="sprite-clone-basic" class="sprite" style="position: absolute; left: 50px; top: 50px; width: 50px; height: 50px; background: #ff6b6b; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; font-weight: bold; border: 3px solid #333; transition: all 0.5s ease; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">😸</div>
                    <div id="speech-bubble-clone-basic" class="speech-bubble" style="position: absolute; background: white; border: 2px solid #333; border-radius: 10px; padding: 8px 12px; font-size: 14px; font-weight: bold; display: none; z-index: 10; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
                    <button class="play-btn" onclick="startBasicCloneAnimation()">▶️ クローン作成を見る</button>
                    <button class="reset-btn" onclick="resetBasicCloneAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="clone-basic-status">クローンが作られる様子を見てみよう！</div>
            </div>

            <div class="info-box hint">
                <strong>🤔 どんな動きをした？</strong> 元の猫から同じ見た目の猫のコピーが3個作られました！それぞれが独立して存在しています。
            </div>

            <h3>📦 クローン作成に必要なブロック</h3>
            <p>クローンを作るために必要なブロックです：</p>
            
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">プログラムの開始（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[自分自身 v] のクローンを作る :: control</pre>
                    <div class="japanese-label">クローンを作る（制御ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">クローンされたとき :: events hat</pre>
                    <div class="japanese-label">クローンが作られたときのイベント<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[こんにちは！] と言う :: looks</pre>
                    <div class="japanese-label">クローンがあいさつ（見た目ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(3) 回繰り返す {
} :: control</pre>
                    <div class="japanese-label">繰り返しブロック（3個のクローン作成用）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(1) 秒待つ :: control</pre>
                    <div class="japanese-label">待機ブロック（タイミング調整用）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
            </div>

            <div class="info-box success">
                <strong>✨ 次のステップで</strong> これらのブロックを使って実際にクローンを作ってみましょう！
            </div>
        </div>

        <!-- Step 2: 組み立て -->
        <div id="clone-basic-step2" class="step-container">
            <h3>🔧 クローン作成プログラムを組み立てよう！</h3>
            <p>クローンを作るブロックを組み立てて、実際にスプライトのコピーを作ります。</p>
            
            <div class="block-container">
                <h4>🎯 組み立て方:</h4>
                <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(3) 回繰り返す {
[自分自身 v] のクローンを作る :: control
(1) 秒待つ :: control
} :: control

クローンされたとき :: events hat
[こんにちは！] と言う :: looks
                </pre>
            </div>

            <div class="info-box hint">
                <strong>💡 重要なポイント！</strong><br>
                • <strong>「クローンを作る」ブロック</strong>：新しいコピーを1個作る<br>
                • <strong>「クローンされたとき」</strong>：作られたクローンが最初に実行するプログラム<br>
                • <strong>繰り返し</strong>：同じクローンを複数個作るため<br>
                • <strong>待つ</strong>：クローンが作られるタイミングを調整
            </div>

            <div class="info-box learn">
                <strong>🎓 クローンの基本ルール</strong><br>
                • クローンは元のスプライトと同じ見た目で作られる<br>
                • クローンにも独立したプログラムを書ける<br>
                • 「クローンされたとき」でクローンの動作を決める<br>
                • 元のスプライトとクローンは別々に動く
            </div>

            <div class="info-box success">
                <strong>✅ やってみよう！</strong> 実際のScratchで組み立てて、クローンが作られる様子を確認してみてください！
            </div>
        </div>

        <!-- Step 3: 詳しい解説 -->
        <div id="clone-basic-step3" class="step-container">
            <h3>🔍 クローンの仕組みを詳しく学ぼう</h3>
            <p>クローンがどのように動くのか、詳しく解説します。</p>
            
            <div class="info-box learn">
                <strong>📚 クローンの重要なポイント</strong><br>
                クローンには元のスプライトとは違う特別な性質があります：<br>
                • <strong>独立性</strong>：クローンは元のスプライトとは別々に動く<br>
                • <strong>同一性</strong>：見た目は元のスプライトと全く同じ<br>
                • <strong>一意性</strong>：それぞれのクローンに個別のプログラムが実行される<br>
                • <strong>継承性</strong>：元のスプライトの設定（コスチューム、サイズなど）を継承
            </div>

            <h3>🎬 クローンの動き方を詳しく見よう</h3>
            <div class="animation-container">
                <h4>📋 クローン作成の流れ</h4>
                <div class="stage">
                    <div id="sprite-clone-detail" class="sprite" style="position: absolute; left: 50px; top: 50px;">🎭</div>
                    <div id="speech-bubble-clone-detail" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playCloneDetailAnimation()">▶️ 詳しいクローン作成を見る</button>
                    <button class="reset-btn" onclick="resetCloneDetailAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="clone-detail-status">クローンの詳しい動作を見てみよう</div>
            </div>

            <div class="info-box hint">
                <strong>🤔 理解のポイント</strong><br>
                • 元のスプライトが「クローンを作る」ブロックを実行<br>
                • 新しいクローンが作られる瞬間に「クローンされたとき」が実行される<br>
                • クローンは作られた場所で独自の動作を開始<br>
                • 元のスプライトは次の処理を続行
            </div>

            <h3>📊 クローンを使った表現の例</h3>
            <div class="blocks-grid">
                <div class="block-item">
                    <div class="example-icon">🌟</div>
                    <div class="example-title">星空効果</div>
                    <div class="example-desc">たくさんの星をクローンで作って、きらめく夜空を表現</div>
                </div>
                <div class="block-item">
                    <div class="example-icon">🎆</div>
                    <div class="example-title">花火ゲーム</div>
                    <div class="example-desc">打ち上げ花火の火花一つ一つをクローンで表現</div>
                </div>
                <div class="block-item">
                    <div class="example-icon">🍎</div>
                    <div class="example-title">落ちゲー</div>
                    <div class="example-desc">上から落ちてくるアイテムをクローンで大量生成</div>
                </div>
                <div class="block-item">
                    <div class="example-icon">👾</div>
                    <div class="example-title">敵キャラ</div>
                    <div class="example-desc">シューティングゲームの敵をクローンで次々と出現</div>
                </div>
            </div>

            <div class="info-box success">
                <strong>✨ 次は実際に作ってみよう！</strong> ステップ4では実際にクローンを使った表現を体験します。
            </div>
        </div>

        <!-- Step 4: 練習問題 -->
        <div id="clone-basic-step4" class="step-container">
            <h3>🎯 練習問題: 色違いクローンを作ろう</h3>
            <p>クローンを作って、それぞれに違う色を付けてみましょう！</p>
            
            <div class="info-box learn">
                <strong>📚 チャレンジ内容</strong><br>
                今回は以下のプログラムを作ります：<br>
                • 5個のクローンを作る<br>
                • それぞれのクローンが違う色効果を付ける<br>
                • クローンは横一列に並ぶ<br>
                • クローンが作られるたびにあいさつをする
            </div>

            <h3>🎬 目標の動きを確認しよう</h3>
            <div class="animation-container">
                <h4>🌈 色違いクローンの動き</h4>
                <div class="stage">
                    <div id="sprite-clone-practice1" class="sprite" style="position: absolute; left: 50px; top: 100px;">🐱</div>
                    <div id="speech-bubble-clone-practice1" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playClonePractice1Animation()">▶️ 色違いクローンアニメーション</button>
                    <button class="reset-btn" onclick="resetClonePractice1Animation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="clone-practice1-status">カラフルなクローンが作られます</div>
            </div>

            <h3>📦 使うブロックを選ぼう</h3>
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">プログラム開始<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(5) 回繰り返す {
} :: control</pre>
                    <div class="japanese-label">5回繰り返し<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[自分自身 v] のクローンを作る :: control</pre>
                    <div class="japanese-label">クローン作成<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(1) 秒待つ :: control</pre>
                    <div class="japanese-label">待機<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">クローンされたとき :: events hat</pre>
                    <div class="japanese-label">クローンイベント<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">色の効果を (25) にする :: looks</pre>
                    <div class="japanese-label">色効果変更<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">x座標を (100) ずつ変える :: motion</pre>
                    <div class="japanese-label">位置移動<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[私は色違いです！] と言う :: looks</pre>
                    <div class="japanese-label">あいさつメッセージ<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
            </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showClonePractice1Answer()">💡 答えを表示</button>
                <div id="clone-practice1-answer" class="answer-container" style="display: none;">
                    <h4>✅ 正解プログラム:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(5) 回繰り返す {
[自分自身 v] のクローンを作る :: control
(1) 秒待つ :: control
} :: control

クローンされたとき :: events hat
色の効果を (25) にする :: looks
x座標を (100) ずつ変える :: motion
[私は色違いです！] と言う :: looks
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 よくできました！</strong><br>
                        • 繰り返しブロックで5個のクローンを作成<br>
                        • 「クローンされたとき」でクローンの動作を定義<br>
                        • 色効果で見た目を変更<br>
                        • x座標を変えて横に並べる
                    </div>
                </div>
            </div>

            <div class="info-box challenge">
                <strong>🚀 さらなるチャレンジ！</strong><br>
                基本ができたら、こんなアレンジも試してみよう：<br>
                • クローンの数を変えてみる（3個、10個など）<br>
                • 色効果の値を変えてみる（50、100など）<br>
                • クローンを縦に並べてみる（y座標を変える）<br>
                • 異なるメッセージを言わせてみる
            </div>
        </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showCloneAnswer1()" id="cloneAnswerBtn1">💡 答えを表示</button>
                <div id="clone-answer1" class="answer-container" style="display: none;">
                    <h4>✅ 正解:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(5) 回繰り返す {
[自分自身 v] のクローンを作る :: control
(0.5) 秒待つ :: control
} :: control

クローンされたとき :: events hat
[色 v] の効果を ([1] から [5] までの乱数 :: operators) * (30) ずつ変える :: looks
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 素晴らしい！</strong> クローンに色効果を付ける方法をマスターしました。
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: 練習問題2 -->
        <div id="clone-basic-step4" class="step-container">
            <h3>🎯 練習問題2: 位置を変えるクローン</h3>
            <p>クローンを作って、それぞれを違う位置に移動させてみましょう！</p>
            
            <div class="info-box learn">
                <strong>📚 作ってみよう！</strong><br>
                クローンの位置を変えるプログラム：<br>
                • 3個のクローンを作る<br>
                • それぞれのクローンが違う位置に移動<br>
                • 位置はランダムに決まる<br>
                • 移動した後にメッセージを表示
            </div>

            <h3>🎬 目標の動きを確認しよう</h3>
            <div class="animation-container">
                <h4>📍 位置変更クローンの動き</h4>
                <div class="stage">
                    <div id="sprite-clone-practice2" class="sprite">🐱</div>
                    <div id="speech-bubble-clone-practice2" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playClonePractice2Animation()">▶️ 位置変更クローンアニメーション</button>
                    <button class="reset-btn" onclick="resetClonePractice2Animation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="clone-practice2-status">クローンが色々な場所に散らばります</div>
            </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showCloneAnswer2()" id="cloneAnswerBtn2">💡 答えを表示</button>
                <div id="clone-answer2" class="answer-container" style="display: none;">
                    <h4>✅ 正解:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(3) 回繰り返す {
[自分自身 v] のクローンを作る :: control
(1) 秒待つ :: control
} :: control

クローンされたとき :: events hat
x座標を ([-200] から [200] までの乱数 :: operators) 、y座標を ([-150] から [150] までの乱数 :: operators) にする :: motion
[新しい場所に来ました！] と言う :: looks
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 完璧です！</strong> クローンの位置制御をマスターしました！
                    </div>
                </div>
            </div>
        </div>

        <!-- ナビゲーション -->
        <div class="step-nav">
            <button class="btn" id="cloneBasicPrevBtn" onclick="changeCloneBasicStep(-1)" disabled>前へ</button>
            <button class="btn" id="cloneBasicNextBtn" onclick="changeCloneBasicStep(1)">次へ</button>
        </div>
    </div>

    <!-- クローンで動きを作る -->
    <div id="clone-movement-section" style="display: none;">
        <div class="progress-bar">
            <div id="clone-movement-progress" class="progress-fill" style="width: 25%"></div>
        </div>
        <h2 id="clone-movement-step-title">ステップ 1 / 4</h2>

        <!-- Step 1: デモを見る -->
        <div id="clone-movement-step1" class="step-container step-active">
            <h3>🏃 クローンで動きを作る：みんなで一緒に動こう</h3>
            <div class="info-box learn">
                <strong>📚 クローンの動きについて学ぼう！</strong><br>
                クローンは作られた後、それぞれが独立して動くことができます。<br>
                • 同じ動きをするクローン（みんなで踊る）<br>
                • 違う動きをするクローン（それぞれ別の方向へ）<br>
                • ランダムな動きをするクローン（星がキラキラ）<br><br>
                <strong>🎓 今日のもくひょう:</strong> クローンに動きを与えてアニメーションを作ろう！
            </div>

            <h3>🎬 クローンの動きを見てみよう</h3>
            <p>まずはクローンがどのように動くか確認しましょう。</p>
            
            <div class="animation-container">
                <h4>🏃 動くクローンのデモ</h4>
                <div class="stage">
                    <div id="sprite-clone-movement" class="sprite">🐱</div>
                    <div id="speech-bubble-clone-movement" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playCloneMovementAnimation()">▶️ 動くクローンを見る</button>
                    <button class="reset-btn" onclick="resetCloneMovementAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="clone-movement-status">クローンが動く様子を見てみよう！</div>
            </div>

            <div class="info-box hint">
                <strong>🤔 どんな動きをした？</strong> 3つのクローンが作られて、それぞれが違う方向に動いていきました！
            </div>

            <h3>📦 クローンの動きに必要なブロック</h3>
            <p>クローンに動きを付けるために必要なブロックです：</p>
            
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">プログラムの開始（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(3) 回繰り返す {
} :: control</pre>
                    <div class="japanese-label">3回繰り返し（制御ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[自分自身 v] のクローンを作る :: control</pre>
                    <div class="japanese-label">クローンを作る（制御ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">クローンされたとき :: events hat</pre>
                    <div class="japanese-label">クローンが作られたときのイベント<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">([90] から [270] までの乱数 :: operators) 度に向ける :: motion</pre>
                    <div class="japanese-label">ランダムな方向に向く（動きブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">ずっと {
} :: control</pre>
                    <div class="japanese-label">ずっと繰り返し（制御ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(3) 歩動かす :: motion</pre>
                    <div class="japanese-label">少しずつ動く（動きブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">もし<端に触れた :: sensing>なら {
} :: control</pre>
                    <div class="japanese-label">端に触れたら跳ね返る条件<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">もし橋に着いたら跳ね返る :: motion</pre>
                    <div class="japanese-label">跳ね返り（動きブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
            </div>

            <div class="info-box success">
                <strong>✨ 次のステップで</strong> これらのブロックを使って実際にクローンに動きを与えてみましょう！
            </div>
        </div>

        <!-- Step 2: 組み立て -->
        <div id="clone-movement-step2" class="step-container">
            <h3>🔧 動くクローンプログラムを組み立てよう！</h3>
            <p>クローンを作って、それぞれに違う動きを与えるプログラムを作ります。</p>
            
            <div class="block-container">
                <h4>🎯 組み立て方:</h4>
                <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(3) 回繰り返す {
[自分自身 v] のクローンを作る :: control
} :: control

クローンされたとき :: events hat
([90] から [270] までの乱数 :: operators) 度に向ける :: motion
ずっと {
(3) 歩動かす :: motion
もし<端に触れた :: sensing>なら {
もし橋に着いたら跳ね返る :: motion
} :: control
} :: control
                </pre>
            </div>

            <div class="info-box hint">
                <strong>💡 重要なポイント！</strong><br>
                • <strong>ランダムな方向</strong>：クローンが作られるたびに違う方向を向く<br>
                • <strong>「ずっと」ブロック</strong>：クローンが永続的に動き続ける<br>
                • <strong>「もし橋に着いたら跳ね返る」</strong>：端に当たったら反対方向に進む<br>
                • <strong>独立した動作</strong>：各クローンが別々の動きをする
            </div>

            <div class="info-box learn">
                <strong>🎓 クローンの動きの仕組み</strong><br>
                • 各クローンは「クローンされたとき」で独自の動作を開始<br>
                • 「ずっと」ブロックでクローンが継続的に動く<br>
                • ランダム要素で各クローンが違う動きをする<br>
                • 元のスプライトとクローンは完全に独立
            </div>

            <div class="info-box success">
                <strong>✅ やってみよう！</strong> 実際のScratchで組み立てて、動き回るクローンを確認してみてください！
            </div>
        </div>

        <!-- Step 3: 練習問題1 -->
        <div id="clone-movement-step3" class="step-container">
            <h3>🎯 練習問題1: キラキラ星のアニメーション</h3>
            <p>星のクローンを作って、キラキラと輝くアニメーションを作ってみましょう！</p>
            
            <div class="info-box learn">
                <strong>📚 作ってみよう！</strong><br>
                キラキラ星のアニメーション：<br>
                • 10個の星クローンを作る<br>
                • それぞれの星が画面のランダムな場所に移動<br>
                • 星が大きくなったり小さくなったりする<br>
                • 色がランダムに変わる
            </div>

            <h3>🎬 目標の動きを確認しよう</h3>
            <div class="animation-container">
                <h4>⭐ キラキラ星のアニメーション</h4>
                <div class="stage">
                    <div id="sprite-clone-stars" class="sprite">⭐</div>
                    <div id="speech-bubble-clone-stars" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playCloneStarsAnimation()">▶️ キラキラ星アニメーション</button>
                    <button class="reset-btn" onclick="resetCloneStarsAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="clone-stars-status">星がキラキラと輝きます</div>
            </div>

            <h3>📦 使うブロックを選ぼう</h3>
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">プログラム開始（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(10) 回繰り返す {
} :: control</pre>
                    <div class="japanese-label">10回繰り返し（制御）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[自分自身 v] のクローンを作る :: control</pre>
                    <div class="japanese-label">クローン作成（制御）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">クローンされたとき :: events hat</pre>
                    <div class="japanese-label">クローンイベント（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">x座標を ([-200] から [200] までの乱数 :: operators) にする :: motion</pre>
                    <div class="japanese-label">ランダムなX座標に移動<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">y座標を ([-150] から [150] までの乱数 :: operators) にする :: motion</pre>
                    <div class="japanese-label">ランダムなY座標に移動<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[色 v] の効果を ([1] から [200] までの乱数 :: operators) にする :: looks</pre>
                    <div class="japanese-label">色をランダムに設定<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">ずっと {
} :: control</pre>
                    <div class="japanese-label">ずっと繰り返し（制御）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">大きさを (50) ％にする :: looks</pre>
                    <div class="japanese-label">小さくする（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(0.2) 秒待つ :: control</pre>
                    <div class="japanese-label">短時間待機（制御）<br><strong>📊 必要な個数: 2個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">大きさを (100) ％にする :: looks</pre>
                    <div class="japanese-label">元のサイズに戻す（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
            </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showCloneMovementAnswer1()" id="cloneMovementAnswerBtn1">💡 答えを表示</button>
                <div id="clone-movement-answer1" class="answer-container" style="display: none;">
                    <h4>✅ 正解:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(10) 回繰り返す {
[自分自身 v] のクローンを作る :: control
} :: control

クローンされたとき :: events hat
x座標を ([-200] から [200] までの乱数 :: operators) にする :: motion
y座標を ([-150] から [150] までの乱数 :: operators) にする :: motion
[色 v] の効果を ([1] から [200] までの乱数 :: operators) にする :: looks
ずっと {
大きさを (50) ％にする :: looks
(0.2) 秒待つ :: control
大きさを (100) ％にする :: looks
(0.2) 秒待つ :: control
} :: control
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 よくできました！</strong> クローンの動きが理解できています。
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: 練習問題2 -->
        <div id="clone-movement-step4" class="step-container">
            <h3>🎯 練習問題2: フォーメーション移動</h3>
            <p>クローンが決まった形に並んで動くプログラムを作ってみましょう！</p>
            
            <div class="info-box learn">
                <strong>📚 作ってみよう！</strong><br>
                フォーメーション移動：<br>
                • 5個のクローンを作る<br>
                • 各クローンが円形に配置される<br>
                • みんなで一緒に回転する<br>
                • 色違いで見分けやすくする
            </div>

            <h3>🎬 目標の動きを確認しよう</h3>
            <div class="animation-container">
                <h4>🌀 フォーメーション移動</h4>
                <div class="stage">
                    <div id="sprite-clone-formation" class="sprite">🐠</div>
                    <div id="speech-bubble-clone-formation" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playCloneFormationAnimation()">▶️ フォーメーション移動</button>
                    <button class="reset-btn" onclick="resetCloneFormationAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="clone-formation-status">みんなで一緒に回転します</div>
            </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showCloneMovementAnswer2()" id="cloneMovementAnswerBtn2">💡 答えを表示</button>
                <div id="clone-movement-answer2" class="answer-container" style="display: none;">
                    <h4>✅ 正解:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(5) 回繰り返す {
[自分自身 v] のクローンを作る :: control
} :: control

クローンされたとき :: events hat
[色 v] の効果を ([1] から [5] までの乱数 :: operators) * (40) ずつ変える :: looks
(100) 歩動かす :: motion
ずっと {
右に (72) 度回す :: motion
(100) 歩動かす :: motion
右に (10) 度回す :: motion
} :: control
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 素晴らしい！</strong> 複雑なクローンの動きもマスターしました。
                    </div>
                </div>
            </div>

            <div class="info-box learn">
                <strong>🎓 学んだクローンの動きテクニック:</strong><br>
                • 各クローンが独立して動作する<br>
                • ランダム要素で多様な動きを作る<br>
                • 「ずっと」ブロックで継続的なアニメーション<br>
                • 位置と色でクローンを差別化する<br><br>
                <strong>💡 これらの技術の活用例:</strong><br>
                • ゲームの敵キャラクター群<br>
                • パーティクル効果（雨、雪、火花）<br>
                • 群衆のシミュレーション
            </div>
        </div>

        <!-- ナビゲーション -->
        <div class="step-nav">
            <button class="btn" id="cloneMovementPrevBtn" onclick="changeCloneMovementStep(-1)" disabled>前へ</button>
            <button class="btn" id="cloneMovementNextBtn" onclick="changeCloneMovementStep(1)">次へ</button>
        </div>
    </div>

    <!-- クローンの削除と管理 -->
    <div id="clone-deletion-section" style="display: none;">
        <div class="progress-bar">
            <div id="clone-deletion-progress" class="progress-fill" style="width: 25%"></div>
        </div>
        <h2 id="clone-deletion-step-title">ステップ 1 / 4</h2>

        <!-- Step 1: デモを見る -->
        <div id="clone-deletion-step1" class="step-container step-active">
            <h3>🗑️ クローンの削除と管理：きれいに片付けよう</h3>
            <div class="info-box learn">
                <strong>📚 クローンの管理について学ぼう！</strong><br>
                クローンを作るだけでなく、不要になったクローンを削除することも大切です。<br>
                • 古いクローンを削除してメモリを節約<br>
                • 特定の条件でクローンを消す<br>
                • 画面をきれいに保つ<br><br>
                <strong>🎓 今日のもくひょう:</strong> クローンの作成と削除をマスターしよう！
            </div>

            <h3>🎬 クローンの削除を見てみよう</h3>
            <p>まずはクローンがどのように削除されるか確認しましょう。</p>
            
            <div class="animation-container">
                <h4>🗑️ クローン削除のデモ</h4>
                <div class="stage">
                    <div id="sprite-clone-deletion" class="sprite">🐱</div>
                    <div id="speech-bubble-clone-deletion" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playCloneDeletionAnimation()">▶️ クローン削除を見る</button>
                    <button class="reset-btn" onclick="resetCloneDeletionAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="clone-deletion-status">クローンが削除される様子を見てみよう！</div>
            </div>

            <div class="info-box hint">
                <strong>🤔 どんな動きをした？</strong> 5つのクローンが作られた後、3秒待ってから順番に削除されました！
            </div>

            <h3>📦 クローンの削除に必要なブロック</h3>
            <p>クローンを削除するために必要なブロックです：</p>
            
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">プログラムの開始（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(5) 回繰り返す {
} :: control</pre>
                    <div class="japanese-label">5回繰り返し（制御ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[自分自身 v] のクローンを作る :: control</pre>
                    <div class="japanese-label">クローンを作る（制御ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">クローンされたとき :: events hat</pre>
                    <div class="japanese-label">クローンが作られたときのイベント<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(3) 秒待つ :: control</pre>
                    <div class="japanese-label">時間待機（制御ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">このクローンを削除する :: control</pre>
                    <div class="japanese-label">クローン削除（制御ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">もし<(x座標 :: motion) < (-200)>なら {
} :: control</pre>
                    <div class="japanese-label">条件判定（制御ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(5) 歩動かす :: motion</pre>
                    <div class="japanese-label">移動（動きブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
            </div>

            <div class="info-box success">
                <strong>✨ 次のステップで</strong> これらのブロックを使って実際にクローンの削除プログラムを作ってみましょう！
            </div>
        </div>

        <!-- Step 2: 組み立て -->
        <div id="clone-deletion-step2" class="step-container">
            <h3>🔧 クローン削除プログラムを組み立てよう！</h3>
            <p>クローンを作って、条件に合ったときに削除するプログラムを作ります。</p>
            
            <div class="block-container">
                <h4>🎯 組み立て方:</h4>
                <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(5) 回繰り返す {
[自分自身 v] のクローンを作る :: control
} :: control

クローンされたとき :: events hat
ずっと {
(5) 歩動かす :: motion
もし<(x座標 :: motion) < (-200)>なら {
このクローンを削除する :: control
} :: control
} :: control
                </pre>
            </div>

            <div class="info-box hint">
                <strong>💡 重要なポイント！</strong><br>
                • <strong>「このクローンを削除する」</strong>：そのクローンだけを削除<br>
                • <strong>条件判定</strong>：画面の端に出たクローンを削除<br>
                • <strong>メモリ管理</strong>：不要なクローンを削除してパフォーマンス向上<br>
                • <strong>自動削除</strong>：プログラムが自動的にクリーンアップ
            </div>

            <div class="info-box learn">
                <strong>🎓 クローン削除の仕組み</strong><br>
                • 「このクローンを削除する」は実行したクローンのみ削除<br>
                • 元のスプライトは削除されない<br>
                • 削除されたクローンのプログラムは停止<br>
                • 条件を使って削除タイミングを制御
            </div>

            <div class="info-box success">
                <strong>✅ やってみよう！</strong> 実際のScratchで組み立てて、クローンが自動削除される様子を確認してみてください！
            </div>
        </div>

        <!-- Step 3: 練習問題1 -->
        <div id="clone-deletion-step3" class="step-container">
            <h3>🎯 練習問題1: 時間制限付きクローン</h3>
            <p>作られてから一定時間後に自動的に消えるクローンを作ってみましょう！</p>
            
            <div class="info-box learn">
                <strong>📚 作ってみよう！</strong><br>
                時間制限付きクローン：<br>
                • 3個のクローンを作る<br>
                • 各クローンは作られてから5秒後に削除<br>
                • 削除される前に「さようなら！」と言う<br>
                • 色が時間と共に薄くなる
            </div>

            <h3>🎬 目標の動きを確認しよう</h3>
            <div class="animation-container">
                <h4>⏰ 時間制限付きクローン</h4>
                <div class="stage">
                    <div id="sprite-clone-timer" class="sprite">🚀</div>
                    <div id="speech-bubble-clone-timer" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playCloneTimerAnimation()">▶️ 時間制限クローン</button>
                    <button class="reset-btn" onclick="resetCloneTimerAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="clone-timer-status">時間が経つとクローンが消えます</div>
            </div>

            <h3>📦 使うブロックを選ぼう</h3>
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">プログラム開始（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(3) 回繰り返す {
} :: control</pre>
                    <div class="japanese-label">3回繰り返し（制御）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[自分自身 v] のクローンを作る :: control</pre>
                    <div class="japanese-label">クローン作成（制御）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">クローンされたとき :: events hat</pre>
                    <div class="japanese-label">クローンイベント（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(5) 秒待つ :: control</pre>
                    <div class="japanese-label">5秒待機（制御）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[さようなら！] と言う :: looks</pre>
                    <div class="japanese-label">お別れメッセージ（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[幽霊 v] の効果を (100) にする :: looks</pre>
                    <div class="japanese-label">透明効果（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">このクローンを削除する :: control</pre>
                    <div class="japanese-label">クローン削除（制御）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
            </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showCloneDeletionAnswer1()" id="cloneDeletionAnswerBtn1">💡 答えを表示</button>
                <div id="clone-deletion-answer1" class="answer-container" style="display: none;">
                    <h4>✅ 正解:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(3) 回繰り返す {
[自分自身 v] のクローンを作る :: control
} :: control

クローンされたとき :: events hat
(5) 秒待つ :: control
[さようなら！] と言う :: looks
[幽霊 v] の効果を (100) にする :: looks
(1) 秒待つ :: control
このクローンを削除する :: control
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 よくできました！</strong> クローンの時間管理が理解できています。
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: 練習問題2 -->
        <div id="clone-deletion-step4" class="step-container">
            <h3>🎯 練習問題2: クリックで削除</h3>
            <p>マウスでクリックしたときにクローンが削除されるプログラムを作ってみましょう！</p>
            
            <div class="info-box learn">
                <strong>📚 作ってみよう！</strong><br>
                クリック削除システム：<br>
                • 5個の的クローンを作る<br>
                • クローンをクリックすると削除される<br>
                • 削除時にエフェクトを表示<br>
                • すべて削除すると「クリア！」メッセージ
            </div>

            <h3>🎬 目標の動きを確認しよう</h3>
            <div class="animation-container">
                <h4>🎯 クリック削除ゲーム</h4>
                <div class="stage">
                    <div id="sprite-clone-click" class="sprite">🎯</div>
                    <div id="speech-bubble-clone-click" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playCloneClickAnimation()">▶️ クリック削除デモ</button>
                    <button class="reset-btn" onclick="resetCloneClickAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="clone-click-status">的をクリックして削除しよう</div>
            </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showCloneDeletionAnswer2()" id="cloneDeletionAnswerBtn2">💡 答えを表示</button>
                <div id="clone-deletion-answer2" class="answer-container" style="display: none;">
                    <h4>✅ 正解:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(5) 回繰り返す {
[自分自身 v] のクローンを作る :: control
} :: control

クローンされたとき :: events hat
x座標を ([-150] から [150] までの乱数 :: operators) にする :: motion
y座標を ([-100] から [100] までの乱数 :: operators) にする :: motion

このスプライトがクリックされたとき :: events hat
[ヒット！] と言う :: looks
(0.5) 秒待つ :: control
このクローンを削除する :: control
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 素晴らしい！</strong> インタラクティブなクローン削除もマスターしました。
                    </div>
                </div>
            </div>

            <div class="info-box learn">
                <strong>🎓 学んだクローン管理テクニック:</strong><br>
                • 自動削除で画面をきれいに保つ<br>
                • 条件判定で削除タイミングを制御<br>
                • 時間制限による自動削除<br>
                • インタラクション（クリック）による削除<br><br>
                <strong>💡 これらの技術の活用例:</strong><br>
                • シューティングゲームの弾丸管理<br>
                • パーティクル効果の最適化<br>
                • リソース管理の自動化
            </div>
        </div>

        <!-- ナビゲーション -->
        <div class="step-nav">
            <button class="btn" id="cloneDeletionPrevBtn" onclick="changeCloneDeletionStep(-1)" disabled>前へ</button>
            <button class="btn" id="cloneDeletionNextBtn" onclick="changeCloneDeletionStep(1)">次へ</button>
        </div>
    </div>

    <!-- クローンを使った応用例 -->
    <div id="clone-applications-section" style="display: none;">
        <div class="progress-bar">
            <div id="clone-applications-progress" class="progress-fill" style="width: 25%"></div>
        </div>
        <h2 id="clone-applications-step-title">ステップ 1 / 4</h2>

        <!-- Step 1: デモを見る -->
        <div id="clone-applications-step1" class="step-container step-active">
            <h3>🎆 クローンを使った応用例：すごい作品を作ろう</h3>
            <div class="info-box learn">
                <strong>📚 クローンの応用について学ぼう！</strong><br>
                これまで学んだクローンの技術を組み合わせて、本格的な作品を作ってみましょう。<br>
                • 星空シミュレーション（たくさんの星）<br>
                • 花火アニメーション（爆発効果）<br>
                • 雨や雪の表現（自然現象）<br>
                • シューティングゲーム（弾丸システム）<br><br>
                <strong>🎓 今日のもくひょう:</strong> 実用的なクローン活用をマスターしよう！
            </div>

            <h3>🎬 クローンの応用例を見てみよう</h3>
            <p>まずはクローンでどんなすごい作品が作れるか確認しましょう。</p>
            
            <div class="animation-container">
                <h4>🌟 星空シミュレーション</h4>
                <div class="stage" style="height: 300px; position: relative; overflow: visible;">
                    <div id="sprite-starfield" class="sprite" style="position: absolute; left: 150px; top: 120px; width: 50px; height: 50px; background: #ff6b6b; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; font-weight: bold; border: 3px solid #333; transition: all 0.5s ease; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">⭐</div>
                    <div id="speech-bubble-starfield" class="speech-bubble" style="position: absolute; background: white; border: 2px solid #333; border-radius: 10px; padding: 8px 12px; font-size: 14px; font-weight: bold; display: none; z-index: 10; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
                    <button class="play-btn" onclick="startStarfieldAnimation()">▶️ 星空を見る</button>
                    <button class="reset-btn" onclick="resetStarfieldAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="starfield-status">美しい星空を作ってみよう！</div>
            </div>

            <div class="info-box hint">
                <strong>🤔 どんな動きをした？</strong> たくさんの星がランダムに現れて、キラキラと輝く星空ができました！
            </div>

            <h3>📦 星空に必要なブロック</h3>
            <p>星空シミュレーションを作るために必要なブロックです：</p>
            
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">プログラムの開始（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">ずっと {
} :: control</pre>
                    <div class="japanese-label">永続実行（制御ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[自分自身 v] のクローンを作る :: control</pre>
                    <div class="japanese-label">クローンを作る（制御ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(0.2) 秒待つ :: control</pre>
                    <div class="japanese-label">タイミング調整（制御ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">クローンされたとき :: events hat</pre>
                    <div class="japanese-label">クローンイベント（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">x座標を ([-240] から [240] までの乱数 :: operators) にする :: motion</pre>
                    <div class="japanese-label">ランダムX座標（動きブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">y座標を ([-180] から [180] までの乱数 :: operators) にする :: motion</pre>
                    <div class="japanese-label">ランダムY座標（動きブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">大きさを ([50] から [150] までの乱数 :: operators) ％にする :: looks</pre>
                    <div class="japanese-label">ランダムサイズ（見た目ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[色 v] の効果を ([1] から [200] までの乱数 :: operators) にする :: looks</pre>
                    <div class="japanese-label">ランダム色効果（見た目ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
            </div>

            <div class="info-box success">
                <strong>✨ 次のステップで</strong> 星空から始まる素晴らしい作品を一緒に作ってみましょう！
            </div>
        </div>

        <!-- Step 2: 花火アニメーション -->
        <div id="clone-applications-step2" class="step-container">
            <h3>🎆 花火アニメーション：爆発の美しさを表現しよう</h3>
            <p>クローンを使って迫力のある花火アニメーションを作ります。</p>
            
            <div class="animation-container">
                <h4>🎆 花火爆発アニメーション</h4>
                <div class="stage">
                    <div id="sprite-fireworks" class="sprite">🔥</div>
                    <div id="speech-bubble-fireworks" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playFireworksAnimation()">▶️ 花火を打ち上げる</button>
                    <button class="reset-btn" onclick="resetFireworksAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="fireworks-status">花火が爆発する瞬間を見よう！</div>
            </div>
            
            <div class="block-container">
                <h4>🎯 花火プログラム:</h4>
                <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
ずっと {
(3) 秒待つ :: control
[自分自身 v] のクローンを作る :: control
} :: control

クローンされたとき :: events hat
x座標を ([-150] から [150] までの乱数 :: operators) にする :: motion
y座標を (100) にする :: motion
[color v] の効果を ([1] から [200] までの乱数 :: operators) にする :: looks
(15) 回繰り返す {
[自分自身 v] のクローンを作る :: control
} :: control
このクローンを削除する :: control
                </pre>
            </div>

            <div class="info-box hint">
                <strong>💡 花火のポイント！</strong><br>
                • <strong>中心から爆発</strong>：1つのクローンが15個の火花を作る<br>
                • <strong>ランダムな位置</strong>：毎回違う場所で爆発<br>
                • <strong>色の変化</strong>：ランダムな色で美しい効果<br>
                • <strong>継続的な打ち上げ</strong>：3秒ごとに新しい花火
            </div>
        </div>

        <!-- Step 3: 練習問題1 -->
        <div id="clone-applications-step3" class="step-container">
            <h3>🎯 練習問題1: 雨のアニメーション</h3>
            <p>自然現象をクローンで表現してみましょう！雨が降るアニメーションを作ります。</p>
            
            <div class="info-box learn">
                <strong>📚 作ってみよう！</strong><br>
                雨のアニメーション：<br>
                • 画面上部からたくさんの雨粒が降る<br>
                • 雨粒は下に向かって落ちる<br>
                • 地面に着いたら雨粒が消える<br>
                • 継続的に新しい雨粒が作られる
            </div>

            <h3>🎬 目標の動きを確認しよう</h3>
            <div class="animation-container">
                <h4>🌧️ 雨のアニメーション</h4>
                <div class="stage">
                    <div id="sprite-rain" class="sprite">💧</div>
                    <div id="speech-bubble-rain" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playRainAnimation()">▶️ 雨を降らせる</button>
                    <button class="reset-btn" onclick="resetRainAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="rain-status">雨が降る様子を見てみよう</div>
            </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showCloneApplicationsAnswer1()" id="cloneApplicationsAnswerBtn1">💡 答えを表示</button>
                <div id="clone-applications-answer1" class="answer-container" style="display: none;">
                    <h4>✅ 正解:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
ずっと {
[自分自身 v] のクローンを作る :: control
(0.1) 秒待つ :: control
} :: control

クローンされたとき :: events hat
x座標を ([-240] から [240] までの乱数 :: operators) にする :: motion
y座標を (180) にする :: motion
ずっと {
y座標を ((y座標 :: motion) - (5)) にする :: motion
もし<(y座標 :: motion) < (-180)>なら {
このクローンを削除する :: control
} :: control
} :: control
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 よくできました！</strong> 自然現象の表現ができています。
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: 練習問題2 -->
        <div id="clone-applications-step4" class="step-container">
            <h3>🎯 練習問題2: シューティングゲーム</h3>
            <p>ゲーム開発で最も使われるクローン技術、弾丸システムを作ってみましょう！</p>
            
            <div class="info-box learn">
                <strong>📚 作ってみよう！</strong><br>
                シューティングゲーム：<br>
                • スペースキーで弾丸を発射<br>
                • 弾丸は上に向かって飛ぶ<br>
                • 画面の端に達したら弾丸が消える<br>
                • 連続して弾丸を撃てる
            </div>

            <h3>🎬 目標の動きを確認しよう</h3>
            <div class="animation-container">
                <h4>🚀 シューティングゲーム</h4>
                <div class="stage">
                    <div id="sprite-bullet" class="sprite">🚀</div>
                    <div id="speech-bubble-bullet" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playBulletAnimation()">▶️ 弾丸発射デモ</button>
                    <button class="reset-btn" onclick="resetBulletAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="bullet-status">スペースキーで弾丸を撃とう</div>
            </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showCloneApplicationsAnswer2()" id="cloneApplicationsAnswerBtn2">💡 答えを表示</button>
                <div id="clone-applications-answer2" class="answer-container" style="display: none;">
                    <h4>✅ 正解:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
ずっと {
もし<[space v] キーが押された :: sensing>なら {
[自分自身 v] のクローンを作る :: control
(0.2) 秒待つ :: control
} :: control
} :: control

クローンされたとき :: events hat
ずっと {
y座標を ((y座標 :: motion) + (10)) にする :: motion
もし<(y座標 :: motion) > (180)>なら {
このクローンを削除する :: control
} :: control
} :: control
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 素晴らしい！</strong> ゲーム開発の基礎技術をマスターしました。
                    </div>
                </div>
            </div>

            <div class="info-box learn">
                <strong>🎓 学んだクローン応用テクニック:</strong><br>
                • 大量のオブジェクト生成（星空、雨粒）<br>
                • 爆発効果の表現（花火）<br>
                • 自然現象のシミュレーション（雨、雪）<br>
                • ゲーム要素の実装（弾丸システム）<br><br>
                <strong>💡 これらの技術で作れるもの:</strong><br>
                • アクションゲーム（敵、弾丸、アイテム）<br>
                • 視覚効果（爆発、魔法、パーティクル）<br>
                • 環境表現（天候、背景効果）<br>
                • インタラクティブアート作品
            </div>
        </div>

        <!-- ナビゲーション -->
        <div class="step-nav">
            <button class="btn" id="cloneApplicationsPrevBtn" onclick="changeCloneApplicationsStep(-1)" disabled>前へ</button>
            <button class="btn" id="cloneApplicationsNextBtn" onclick="changeCloneApplicationsStep(1)">次へ</button>
        </div>
    </div>

    <!-- 条件分岐メニュー -->
    <div id="conditional-menu" style="display: none;">
        <div class="container">
            <div class="header">
                <h1>🤔 条件分岐</h1>
                <p>条件によって動きを変えてみよう！</p>
            </div>

            <div class="lesson-grid">
                <div class="lesson-card" onclick="showIfThen()">
                    <div class="emoji">🤔</div>
                    <div class="lesson-title">もし〜なら</div>
                    <div class="lesson-desc">条件が合ったときだけ動かそう！</div>
                </div>
                <div class="lesson-card" onclick="showIfElse()">
                    <div class="emoji">⚡</div>
                    <div class="lesson-title">もし〜ならでなければ</div>
                    <div class="lesson-desc">2つの道から選択させよう！</div>
                </div>
            </div>

            <div class="step-nav">
                <button class="btn" onclick="showHome()" style="background: #666;">ホームに戻る</button>
            </div>
        </div>
    </div>

    <!-- もし〜なら（If-Then） -->
    <div id="if-then-section" style="display: none;">
        <div class="progress-bar">
            <div id="if-progress" class="progress-fill" style="width: 20%"></div>
        </div>
        <h2 id="if-step-title">ステップ 1 / 5</h2>

        <!-- Step 1: 結果を見る -->
        <div id="if-step1" class="step-container step-active">
            <h3>🎯 きょうつくるうごきのもくひょう</h3>
            <div class="info-box learn">
                <strong>📚 これからつくってみよう！</strong><br>
                すうじによってうごきがかわる「もしなら」のプログラムをつくります。<br>
                • ランダムなすうじ（1〜10）をえらぶ<br>
                • すうじがおおきければ（6いじょう）ねこがみぎにうごく<br>
                • すうじがちいさければ（5いか）なにもしない<br>
                • まいかいちがうけっかになるおもしろさをたいけん<br><br>
                <strong>🎓 べんきょうのポイント:</strong> じょうけんによってじっこうされるブロックがかわる「もしなら」をたいけんしよう！
            </div>

            <h3>🎬 もしならのうごきをみてみよう！</h3>
            <p>まずはかんせいばんをみて、じょうけんによってうごきがかわるようすをかくにんしましょう。</p>
            
            <div class="animation-container">
                <h4>🎲 じょうけんによってかわるねこのうごき</h4>
                <div class="stage">
                    <div id="sprite-if" class="sprite">🐱</div>
                    <div id="speech-bubble-if" class="speech-bubble"></div>
                    <button class="play-btn" onclick="playIfAnimation()">▶️ ランダムアニメーションを再生</button>
                    <button class="reset-btn" onclick="resetIfAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="if-status">ランダムなすうじによってうごきがかわります！</div>
            </div>

            <div class="info-box hint">
                <strong>🤔 うごきのパターンは？</strong> すうじが6いじょうなら「メッセージひょうじ→みぎにいどう」、5いかなら「なにもしない」でした。じょうけんによってじっこうされるブロックがかわるのがポイントです！
            </div>

            <h3>📦 このうごきをつくるためにひつようなブロック</h3>
            <p>うえのもしならをつくるために、つぎのブロックをよういします：</p>
            
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label"><strong>🟡 プログラムのはじまり（はたがおされたとき）</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[数 v] を ([1] から [10] までのらんすう :: operators) にする :: variables</pre>
                    <div class="japanese-label"><strong>🟠 へんすう「すう」にみどりいろのらんすうブロックをいれる</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">もし<>なら {
} :: control</pre>
                    <div class="japanese-label"><strong>🔵 もし〜なら（じょうけんをしらべるCじがたブロック）</strong><br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(数 :: variables) > (5) :: operators</pre>
                    <div class="japanese-label"><strong>🟢 へんすう「すう」とすうじのおおきさくらべ（えんざんブロック）</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[すうじはおおきいです！] という :: looks</pre>
                    <div class="japanese-label"><strong>🟣 じょうけんがほんとうのときのメッセージ（みためブロック）</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(100) ほうごかす :: motion</pre>
                    <div class="japanese-label"><strong>🔷 じょうけんがほんとうのときのうごき（うごきブロック）</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">([] と [] :: operators)</pre>
                    <div class="japanese-label"><strong>🟢 つなげるブロック（もじをつなげるえんざんブロック）</strong></div>
                </div>
            </div>

            <div class="info-box success">
                <strong>✨ 次のステップで</strong> これらのブロックを使って条件分岐プログラムの組み立て方を学びましょう！
            </div>
        </div>

        <!-- Step 2: 組み立てとロジック解説 -->
        <div id="if-step2" class="step-container">
            <h3>🔧 もしならブロックをくみたててみよう！</h3>
            <p>「もし〜なら」ブロックをつかって、じょうけんによってうごきをかえるプログラムをつくってみましょう。</p>
            
            <div class="block-container">
                <h4>🎯 くみたてかた:</h4>
                <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
[数 v] を ([1] から [10] までのらん数 :: operators) にする :: variables
([選んだ数字は] と (数 :: variables) :: operators) と言う :: looks
もし<(数 :: variables) > (5)>なら {
[数字は大きいです！] と言う :: looks
(100) 歩動かす :: motion
} :: control
もし<(数 :: variables) > (5)>なら {
[すごい！] と言う :: looks
} :: control
                </pre>
            </div>

            <div class="info-box hint">
                <strong>💡 ポイント:</strong><br>
                • 変数「数」にランダムな数字（1〜10）を設定<br>
                • 「もし〜なら」ブロックの条件部分に「数 > 5」を入れる<br>
                • 条件が真（本当）のときだけ中のブロックが実行される<br>
                • 数字が5以下の場合は「すごい！」は表示されない
            </div>

            <div class="info-box success">
                <strong>✅ やってみよう！</strong> 実際のScratchでこのとおりにブロックを組み立てて、何回も緑の旗を押してみてください！
            </div>
        </div>

        <!-- Step 3: 練習問題 -->
        <div id="if-step3" class="step-container">
            <h3>🎯 練習問題：年齢チェックシステム</h3>
            <p>学んだことを活かして、条件分岐の練習問題に挑戦しましょう！</p>
            
            <div class="info-box learn">
                <strong>📚 練習問題: 大人かな？子どもかな？</strong><br>
                次の動きをするプログラムを作りましょう：<br>
                • 「年齢はいくつですか？」と質問<br>
                • 答えを「年齢」変数に保存<br>
                • もし年齢が18以上なら「大人ですね！」と表示<br>
            </div>

            <h3>📦 使うブロックを選ぼう</h3>
            <p>下のブロックの中から必要なものを選んで、正しい順番で組み立ててください：</p>
            
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">緑の旗がクリックされたとき（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[年齢はいくつですか？] と聞いて待つ :: sensing</pre>
                    <div class="japanese-label">年齢を質問（調べる）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(年齢 :: variables) を (答え :: sensing) にする :: variables</pre>
                    <div class="japanese-label">答えを年齢変数に保存（変数）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">もし<>なら {
} :: control</pre>
                    <div class="japanese-label">もし〜なら（条件分岐）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(年齢 :: variables) ≥ (18) :: operators</pre>
                    <div class="japanese-label">年齢が18以上かチェック（演算）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[大人ですね！] と言う :: looks</pre>
                    <div class="japanese-label">大人のメッセージ（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
            </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showIfAnswer1()" id="ifAnswerBtn1">💡 答えを表示</button>
                <div id="if-answer1" class="answer-container" style="display: none;">
                    <h4>✅ 正解:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
[年齢はいくつですか？] と聞いて待つ :: sensing
(年齢 :: variables) を (答え :: sensing) にする :: variables
もし<(年齢 :: variables) ≥ (18)>なら {
[大人ですね！] と言う :: looks
} :: control
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 よくできました！</strong> 条件分岐の基本が理解できています。
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: まとめ -->
        <div id="if-step4" class="step-container">
            <h3>🌟 「もし〜なら」をマスターしました！</h3>
            
            <div class="info-box learn">
                <strong>🎓 学んだこと:</strong><br>
                • 条件分岐は「もし〜なら」ブロックで作る<br>
                • 条件が真（本当）のときだけ中身が実行される<br>
                • 比較演算子（>, <, =, ≥, ≤）で条件を作る<br>
                • 変数と数字を比較できる<br><br>
                <strong>💡 条件分岐の活用例:</strong><br>
                • ゲームのクリア条件判定<br>
                • パスワード入力チェック<br>
                • 年齢や点数による分類
            </div>

            <div class="info-box success">
                <strong>🏆 次は「もし〜ならでなければ」に挑戦してみましょう！</strong><br>
                条件が合わないときの動作も指定できる、より高度な条件分岐を学びます。
            </div>
        </div>

        <!-- ナビゲーション -->
        <div class="step-nav">
            <button class="btn" id="ifPrevBtn" onclick="changeIfStep(-1)" disabled>前へ</button>
            <button class="btn" id="ifNextBtn" onclick="changeIfStep(1)">次へ</button>
        </div>
    </div>

    <!-- もし〜ならでなければ（If-Else） -->
    <div id="if-else-section" style="display: none;">
        <div class="progress-bar">
            <div id="ifelse-progress" class="progress-fill" style="width: 25%"></div>
        </div>
        <h2 id="ifelse-step-title">ステップ 1 / 4</h2>

        <!-- Step 1: デモを見る -->
        <div id="ifelse-step1" class="step-container step-active">
            <h3>⚡ もし〜ならでなければ：2つの道から選択</h3>
            <div class="info-box learn">
                <strong>📚 if-else条件分岐について学ぼう！</strong><br>
                「もし〜ならでなければ」は、条件が合うときと合わないときの両方の動作を指定できます。<br>
                • もし晴れなら公園に行く、でなければ家で読書<br>
                • もし正解なら「正解！」、でなければ「残念」<br>
                • もし偶数なら「偶数です」、でなければ「奇数です」<br><br>
                <strong>🎓 今日のもくひょう:</strong> 2つの選択肢があるプログラムを作ろう！
            </div>

            <h3>🎬 if-else分岐の動きを見てみよう</h3>
            <p>まずは「もし〜ならでなければ」がどのように動くか確認しましょう。</p>
            
            <div class="animation-container">
                <h4>🎯 if-else分岐のデモ</h4>
                <div class="stage">
                    <div class="sprite">🎲</div>
                    <div id="ifelse-display" style="font-size: 20px; color: #2c3e50; margin: 20px;">🎲 数字: ?</div>
                    <button class="play-btn" onclick="playIfElseAnimation()">▶️ if-else分岐を見る</button>
                    <button class="reset-btn" onclick="resetIfElseAnimation()">🔄 リセット</button>
                </div>
                <div class="animation-status" id="ifelse-status">if-else分岐のアニメーション</div>
            </div>

            <div class="info-box hint">
                <strong>🤔 どんな動きをした？</strong> 数字が偶数なら「偶数！」、奇数なら「奇数！」と必ずどちらかのメッセージが表示されました！
            </div>

            <h3>📦 if-else分岐に必要なブロック</h3>
            <p>「もし〜ならでなければ」の条件分岐に必要なブロックです：</p>
            
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">プログラムの開始（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(数字 :: variables) を ([1] から [10] までの乱数 :: operators) にする :: variables</pre>
                    <div class="japanese-label">変数にランダムな数を設定<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">もし<>なら {
} でなければ {
} :: control</pre>
                    <div class="japanese-label">もし〜ならでなければ（2つのCじがたがつながったブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">((数字 :: variables) を (2) で割った余り :: operators) = (0) :: operators</pre>
                    <div class="japanese-label">偶数か奇数かを調べる（演算ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[偶数！] と言う :: looks</pre>
                    <div class="japanese-label">偶数のときのメッセージ（見た目ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[奇数！] と言う :: looks</pre>
                    <div class="japanese-label">奇数のときのメッセージ（見た目ブロック）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
            </div>

            <div class="info-box success">
                <strong>✨ 次のステップで</strong> これらのブロックを組み立てて、実際にif-else分岐プログラムを作ってみましょう！
            </div>
        </div>

        <!-- Step 2: 組み立て -->
        <div id="ifelse-step2" class="step-container">
            <h3>🔧 if-else分岐プログラムを組み立てよう！</h3>
            <p>「もし〜ならでなければ」ブロックを使って、2つの選択肢があるプログラムを作ります。</p>
            
            <div class="block-container">
                <h4>🎯 組み立て方:</h4>
                <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
(数字 :: variables) を ([1] から [10] までの乱数 :: operators) にする :: variables
(数字 :: variables) と言う :: looks
もし<((数字 :: variables) を (2) で割った余り :: operators) = (0)>なら {
[偶数！] と言う :: looks
} でなければ {
[奇数！] と言う :: looks
} :: control
                </pre>
            </div>

            <div class="info-box hint">
                <strong>💡 ポイント:</strong><br>
                • 「もし〜ならでなければ」ブロックには2つの部分がある<br>
                • 上の部分：条件が真（本当）のときに実行<br>
                • 下の部分：条件が偽（うそ）のときに実行<br>
                • 必ずどちらか一方が実行される
            </div>

            <div class="info-box learn">
                <strong>🎓 偶数・奇数の判定方法:</strong><br>
                • 偶数：2で割り切れる数（余りが0）<br>
                • 奇数：2で割り切れない数（余りが1）<br>
                • 「〜を〜で割った余り」ブロックで余りを計算
            </div>
        </div>

        <!-- Step 3: 練習問題 -->
        <div id="ifelse-step3" class="step-container">
            <h3>🎯 練習問題：温度判定システム</h3>
            <p>学んだことを活かして、if-else分岐の練習問題に挑戦しましょう！</p>
            
            <div class="info-box learn">
                <strong>📚 練習問題: 今日は暑い？涼しい？</strong><br>
                次の動きをするプログラムを作りましょう：<br>
                • 「今日の気温は？」と質問<br>
                • 答えを「気温」変数に保存<br>
                • もし気温が25度以上なら「暑いですね！」<br>
                • でなければ「涼しいですね！」と表示<br>
            </div>

            <h3>📦 使うブロックを選ぼう</h3>
            <p>下のブロックの中から必要なものを選んで、正しい順番で組み立ててください：</p>
            
            <div class="blocks-grid">
                <div class="block-item">
                    <pre class="blocks">@greenFlag がクリックされたとき :: events hat</pre>
                    <div class="japanese-label">緑の旗がクリックされたとき（イベント）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[今日の気温は？] と聞いて待つ :: sensing</pre>
                    <div class="japanese-label">気温を質問（調べる）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(気温 :: variables) を (答え :: sensing) にする :: variables</pre>
                    <div class="japanese-label">答えを気温変数に保存（変数）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">もし<>なら {
} でなければ {
} :: control</pre>
                    <div class="japanese-label">もし〜ならでなければ（条件分岐）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">(気温 :: variables) ≥ (25) :: operators</pre>
                    <div class="japanese-label">気温が25度以上かチェック（演算）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[暑いですね！] と言う :: looks</pre>
                    <div class="japanese-label">暑いときのメッセージ（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
                <div class="block-item">
                    <pre class="blocks">[涼しいですね！] と言う :: looks</pre>
                    <div class="japanese-label">涼しいときのメッセージ（見た目）<br><strong>📊 必要な個数: 1個</strong></div>
                </div>
            </div>

            <div class="answer-section">
                <button class="btn answer-btn" onclick="showIfElseAnswer1()" id="ifelseAnswerBtn1">💡 答えを表示</button>
                <div id="ifelse-answer1" class="answer-container" style="display: none;">
                    <h4>✅ 正解:</h4>
                    <div class="block-container">
                        <pre class="blocks">
@greenFlag がクリックされたとき :: events hat
[今日の気温は？] と聞いて待つ :: sensing
(気温 :: variables) を (答え :: sensing) にする :: variables
もし<(気温 :: variables) ≥ (25)>なら {
[暑いですね！] と言う :: looks
} でなければ {
[涼しいですね！] と言う :: looks
} :: control
                        </pre>
                    </div>
                    <div class="info-box success">
                        <strong>🎉 素晴らしい！</strong> if-else分岐の仕組みが理解できました。
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: まとめ -->
        <div id="ifelse-step4" class="step-container">
            <h3>🌟 「もし〜ならでなければ」をマスターしました！</h3>
            
            <div class="info-box learn">
                <strong>🎓 学んだこと:</strong><br>
                • if-else分岐は2つの選択肢を提供<br>
                • 条件が真なら上の部分、偽なら下の部分が実行<br>
                • 必ずどちらか一方が実行される<br>
                • より複雑な条件判定ができる<br><br>
                <strong>💡 if-else分岐の活用例:</strong><br>
                • 正解・不正解の判定<br>
                • 昼・夜の時間判定<br>
                • 勝ち・負けの結果表示
            </div>

            <div class="info-box success">
                <strong>🏆 条件分岐をマスターしました！</strong><br>
                これで、より賢いプログラムが作れるようになりました。次は繰り返しや変数などの他の機能と組み合わせて、さらに高度なプログラムに挑戦してみましょう！
            </div>
        </div>

        <!-- ナビゲーション -->
        <div class="step-nav">
            <button class="btn" id="ifelsePrevBtn" onclick="changeIfElseStep(-1)" disabled>前へ</button>
            <button class="btn" id="ifelseNextBtn" onclick="changeIfElseStep(1)">次へ</button>
        </div>
    </div>

    <!-- 音と音楽メニュー -->
    <div id="sounds-menu" style="display: none;">
        <div class="container">
            <div class="header">
                <h1>🎵 音と音楽</h1>
                <p>音楽や効果音を使って、楽しいプログラムを作ろう！</p>
            </div>

            <div class="lesson-grid">
                <div class="lesson-card" onclick="showBasicSounds()">
                    <div class="emoji">🔊</div>
                    <div class="lesson-title">基本的な音</div>
                    <div class="lesson-desc">音を鳴らすブロックを使おう！</div>
                </div>
                <div class="lesson-card" onclick="showMusicInstruments()">
                    <div class="emoji">🎺</div>
                    <div class="lesson-title">楽器の音</div>
                    <div class="lesson-desc">色々な楽器の音を鳴らそう！</div>
                </div>
                <div class="lesson-card" onclick="showSoundEffects()">
                    <div class="emoji">🎭</div>
                    <div class="lesson-title">効果音</div>
                    <div class="lesson-desc">ゲームや劇の効果音を作ろう！</div>
                </div>
                <div class="lesson-card" onclick="showMusicControl()">
                    <div class="emoji">🎛️</div>
                    <div class="lesson-title">音楽の制御</div>
                    <div class="lesson-desc">テンポや音量を調整しよう！</div>
                </div>
            </div>

            <div class="step-nav">
                <button class="btn" onclick="showHome()" style="background: #666;">ホームに戻る</button>
            </div>
        </div>
    </div>

    <!-- メッセージ機能メニュー -->
    <div id="messages-menu" style="display: none;">
        <div class="container">
            <div class="header">
                <h1>📢 メッセージ機能</h1>
                <p>スプライト同士で会話して、連携プログラムを作ろう！</p>
            </div>

            <div class="lesson-grid">
                <div class="lesson-card" onclick="showBasicMessages()">
                    <div class="emoji">📨</div>
                    <div class="lesson-title">メッセージの送受信</div>
                    <div class="lesson-desc">メッセージを送ったり受け取ったりしよう！</div>
                </div>
                <div class="lesson-card" onclick="showSpritesCommunication()">
                    <div class="emoji">🤝</div>
                    <div class="lesson-title">スプライト間の通信</div>
                    <div class="lesson-desc">複数のスプライトを連携させよう！</div>
                </div>
            </div>

            <div class="step-nav">
                <button class="btn" onclick="showHome()" style="background: #666;">ホームに戻る</button>
            </div>
        </div>
    </div>

    <!-- 背景とステージメニュー -->
    <div id="backgrounds-menu" style="display: none;">
        <div class="container">
            <div class="header">
                <h1>🎭 背景とステージ</h1>
                <p>ステージの背景を変えて、素敵な世界を作ろう！</p>
            </div>

            <div class="lesson-grid">
                <div class="lesson-card" onclick="showBackgroundBasics()">
                    <div class="emoji">🖼️</div>
                    <div class="lesson-title">背景の基本</div>
                    <div class="lesson-desc">背景を変えるブロックを使おう！</div>
                </div>
                <div class="lesson-card" onclick="showBackgroundSwitching()">
                    <div class="emoji">🔄</div>
                    <div class="lesson-title">背景の切り替え</div>
                    <div class="lesson-desc">場面に応じて背景を変えよう！</div>
                </div>
            </div>

            <div class="step-nav">
                <button class="btn" onclick="showHome()" style="background: #666;">ホームに戻る</button>
            </div>
        </div>
    </div>

    <!-- リスト機能メニュー -->
    <div id="lists-menu" style="display: none;">
        <div class="container">
            <div class="header">
                <h1>📋 リスト</h1>
                <p>たくさんのデータを整理して使おう！</p>
            </div>

            <div class="lesson-grid">
                <div class="lesson-card" onclick="showListBasics()">
                    <div class="emoji">📝</div>
                    <div class="lesson-title">リストの基本</div>
                    <div class="lesson-desc">リストを作って使ってみよう！</div>
                </div>
                <div class="lesson-card" onclick="showListOperations()">
                    <div class="emoji">➕</div>
                    <div class="lesson-title">リストの操作</div>
                    <div class="lesson-desc">データを追加・削除してみよう！</div>
                </div>
                <div class="lesson-card" onclick="showListAccess()">
                    <div class="emoji">🔍</div>
                    <div class="lesson-title">リストの内容を使う</div>
                    <div class="lesson-desc">リストの中身を取り出して使おう！</div>
                </div>
                <div class="lesson-card" onclick="showListApplications()">
                    <div class="emoji">🎯</div>
                    <div class="lesson-title">リストの活用</div>
                    <div class="lesson-desc">実際のプログラムでリストを使おう！</div>
                </div>
            </div>

            <div class="step-nav">
                <button class="btn" onclick="showHome()" style="background: #666;">ホームに戻る</button>
            </div>
        </div>
    </div>

    <!-- ペン機能メニュー -->
    <div id="pen-menu" style="display: none;">
        <div class="container">
            <div class="header">
                <h1>✏️ ペン機能</h1>
                <p>ペンを使って、線や図形を描いてアート作品を作ろう！</p>
            </div>

            <div class="lesson-grid">
                <div class="lesson-card" onclick="showPenBasics()">
                    <div class="emoji">🖊️</div>
                    <div class="lesson-title">ペンの基本</div>
                    <div class="lesson-desc">ペンを下ろして線を描こう！</div>
                </div>
                <div class="lesson-card" onclick="showPenColors()">
                    <div class="emoji">🌈</div>
                    <div class="lesson-title">色と太さ</div>
                    <div class="lesson-desc">ペンの色と太さを変えよう！</div>
                </div>
                <div class="lesson-card" onclick="showShapeDrawing()">
                    <div class="emoji">🔺</div>
                    <div class="lesson-title">図形を描く</div>
                    <div class="lesson-desc">三角形や四角形を描こう！</div>
                </div>
                <div class="lesson-card" onclick="showArtCreation()">
                    <div class="emoji">🎨</div>
                    <div class="lesson-title">アート作品</div>
                    <div class="lesson-desc">自由に絵を描いて作品を作ろう！</div>
                </div>
            </div>

            <div class="step-nav">
                <button class="btn" onclick="showHome()" style="background: #666;">ホームに戻る</button>
            </div>
        </div>
    </div>

    <script src="https://scratchblocks.github.io/js/scratchblocks-v3.6.3-min.js"></script>
    <link rel="stylesheet" href="https://scratchblocks.github.io/css/scratchblocks-v3.6.3.css">
    
    <script>
        let currentStep = 1;
        let blocksLoaded = false;
        
        function updateStatus(message, type = 'loading') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + type;
            if (type === 'success') {
                setTimeout(() => status.style.display = 'none', 2000);
            }
        }
        
        function initializeBlocks() {
            setTimeout(() => {
                if (typeof scratchblocks !== 'undefined') {
                    try {
                        // Use English blocks with proper category syntax
                        scratchblocks.renderMatching('pre.blocks', {
                            languages: ['en'],
                            scale: 0.8,
                            style: 'scratch3'
                        });
                        blocksLoaded = true;
                        updateStatus('ブロック読み込み完了！', 'success');
                        console.log('Blocks rendered successfully');
                    } catch (e) {
                        console.error('Error rendering blocks:', e);
                        updateStatus('ブロック描画エラー', 'error');
                    }
                } else {
                    updateStatus('ライブラリ読み込み失敗', 'error');
                }
            }, 1000);
        }
        
        function renderBlocks() {
            // Disable re-rendering to preserve correct colors
            // Only render once during initialization
            return;
        }
        
        function showProgramFlow() {
            document.getElementById('home-view').style.display = 'none';
            document.getElementById('program-flow').style.display = 'block';
            document.getElementById('conditional-if').style.display = 'none';
            document.getElementById('conditional-ifelse').style.display = 'none';
            currentStep = 1;
            updateStep();
            // 再レンダリングを完全に無効化して色分けを維持
        }
        
        function showHome() {
            hideAllViews();
            document.getElementById('home-view').style.display = 'block';
        }
        
        function changeStep(direction) {
            currentStep += direction;
            if (currentStep < 1) currentStep = 1;
            if (currentStep > 6) currentStep = 6;
            updateStep();
            // Remove re-rendering call
        }
        
        function updateStep() {
            // Hide all steps
            document.querySelectorAll('.step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            
            // Show current step
            document.getElementById('step' + currentStep).classList.add('step-active');
            
            // Update title and progress
            document.getElementById('step-title').textContent = `ステップ ${currentStep} / 6`;
            document.getElementById('progress').style.width = (currentStep / 6 * 100) + '%';
            
            // Update buttons
            document.getElementById('prevBtn-program').disabled = currentStep === 1;
            document.getElementById('nextBtn-program').disabled = currentStep === 6;
            if (currentStep <= 3) {
                document.getElementById('nextBtn-program').textContent = '次へ';
            } else if (currentStep < 6) {
                document.getElementById('nextBtn-program').textContent = '次の問題';
            } else {
                document.getElementById('nextBtn-program').textContent = '完了';
            }
        }
        
        function showLesson(type) {
            alert(`${type}のレッスンは準備中です！`);
        }
        
        // Phase 1-4: 新機能の関数
        function showCoordinates() {
            document.getElementById('home-view').style.display = 'none';
            document.getElementById('coordinates').style.display = 'block';
            currentCoordinatesStep = 1;
            updateCoordinatesStep();
            setTimeout(renderBlocks, 200);
        }
        
        function showVariables() {
            alert('変数と計算のレッスンは準備中です！');
        }
        
        function showCostumes() {
            hideAllViews();
            document.getElementById('costumes-section').style.display = 'block';
            currentCostumesStep = 1;
            updateCostumesStep();
        }
        
        
        // 条件分岐コンテンツ表示
        function showConditional(type) {
            document.getElementById('home-view').style.display = 'none';
            document.getElementById('program-flow').style.display = 'none';
            
            if (type === 'if') {
                document.getElementById('conditional-if').style.display = 'block';
                document.getElementById('conditional-ifelse').style.display = 'none';
                currentIfStep = 1;
                updateIfStep();
            } else if (type === 'ifelse') {
                document.getElementById('conditional-if').style.display = 'none';
                document.getElementById('conditional-ifelse').style.display = 'block';
                currentIfElseStep = 1;
                updateIfElseStep();
            }
            
            // 条件分岐ページでは初回のみレンダリング、既に読み込み済みなら実行しない
            if (!blocksLoaded) {
                setTimeout(() => {
                    if (typeof scratchblocks !== 'undefined') {
                        try {
                            scratchblocks.renderMatching('pre.blocks', {
                                languages: ['en'],
                                scale: 0.8,
                                style: 'scratch3'
                            });
                            console.log('Conditional blocks rendered successfully');
                        } catch (e) {
                            console.error('Error rendering conditional blocks:', e);
                        }
                    }
                }, 300);
            }
        }
        
        // アニメーション制御
        let isAnimating = false;
        let isDetailedAnimating = false;
        
        function playAnimation() {
            if (isAnimating) return;
            
            isAnimating = true;
            const sprite = document.getElementById('sprite');
            const bubble = document.getElementById('speech-bubble');
            const status = document.getElementById('animation-status');
            const playBtn = document.querySelector('.play-btn');
            
            playBtn.disabled = true;
            playBtn.textContent = '⏸️ 実行中...';
            
            // 初期位置にリセット
            resetAnimation();
            
            // アニメーション開始
            setTimeout(() => {
                status.textContent = '🚩 はたがクリックされました！';
            }, 500);
            
            // こんにちは！と言う
            setTimeout(() => {
                status.textContent = '💬 こんにちは！と言う';
                bubble.textContent = 'こんにちは！';
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
            }, 1500);
            
            // 1秒待つ
            setTimeout(() => {
                status.textContent = '⏰ 1秒待つ...';
                bubble.style.display = 'none';
            }, 3500);
            
            // 50歩動かす
            setTimeout(() => {
                status.textContent = '🚶 50歩動かす';
                sprite.style.left = '200px';
            }, 4500);
            
            // 1秒待つ
            setTimeout(() => {
                status.textContent = '⏰ 1秒待つ...';
            }, 5500);
            
            // 右に90度回す
            setTimeout(() => {
                status.textContent = '🔄 右に90度回す';
                sprite.style.transform = 'rotate(90deg)';
            }, 6500);
            
            // 1秒待つ
            setTimeout(() => {
                status.textContent = '⏰ 1秒待つ...';
            }, 7500);
            
            // さようなら！と言う
            setTimeout(() => {
                status.textContent = '👋 さようなら！と言う';
                bubble.textContent = 'さようなら！';
                bubble.style.display = 'block';
                bubble.style.left = '250px';
                bubble.style.top = '20px';
            }, 8500);
            
            // アニメーション終了
            setTimeout(() => {
                status.textContent = '✅ 動きが完成しました！この流れを作ってみましょう。';
                bubble.style.display = 'none';
                playBtn.disabled = false;
                playBtn.textContent = '▶️ アニメーションを再生';
                isAnimating = false;
            }, 10500);
        }
        
        function resetAnimation() {
            const sprite = document.getElementById('sprite');
            const bubble = document.getElementById('speech-bubble');
            const status = document.getElementById('animation-status');
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.transform = 'rotate(0deg)';
            bubble.style.display = 'none';
            status.textContent = '緑の旗をクリックしてアニメーションを開始しましょう！';
            
            isAnimating = false;
            const playBtn = document.querySelector('.play-btn');
            playBtn.disabled = false;
            playBtn.textContent = '▶️ アニメーションを再生';
        }
        
        // 詳細アニメーション（ステップ3用）
        function playDetailedAnimation() {
            if (isDetailedAnimating) return;
            
            isDetailedAnimating = true;
            const sprite = document.getElementById('sprite2');
            const bubble = document.getElementById('speech-bubble2');
            const status = document.getElementById('detailed-status');
            const playBtn = document.querySelectorAll('.play-btn')[1];
            
            playBtn.disabled = true;
            playBtn.textContent = '🔬 解説中...';
            
            // 初期位置にリセット
            resetDetailedAnimation();
            
            // より詳しい解説付きアニメーション
            setTimeout(() => {
                status.textContent = '📝 ステップ1: プログラムが始まります（イベントブロック）';
                highlightExecutionItem(1);
            }, 1000);
            
            setTimeout(() => {
                status.textContent = '📝 ステップ2: 最初の処理を実行（見た目ブロック）';
                bubble.textContent = 'こんにちは！';
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
                highlightExecutionItem(2);
            }, 2500);
            
            setTimeout(() => {
                status.textContent = '📝 ステップ3: 処理を区切るために待機（制御ブロック）';
                bubble.style.display = 'none';
                highlightExecutionItem(3);
            }, 4000);
            
            setTimeout(() => {
                status.textContent = '📝 ステップ4: 次の処理を実行（動きブロック）';
                sprite.style.left = '200px';
                highlightExecutionItem(4);
            }, 5500);
            
            setTimeout(() => {
                status.textContent = '📝 ステップ5: また待機して次の準備（制御ブロック）';
                highlightExecutionItem(5);
            }, 7000);
            
            setTimeout(() => {
                status.textContent = '📝 ステップ6: 回転の処理を実行（動きブロック）';
                sprite.style.transform = 'rotate(90deg)';
                highlightExecutionItem(6);
            }, 8500);
            
            setTimeout(() => {
                status.textContent = '📝 ステップ7: 最後の待機（制御ブロック）';
                highlightExecutionItem(7);
            }, 10000);
            
            setTimeout(() => {
                status.textContent = '📝 ステップ8: 最後の処理を実行（見た目ブロック）';
                bubble.textContent = 'さようなら！';
                bubble.style.display = 'block';
                bubble.style.left = '250px';
                bubble.style.top = '20px';
                highlightExecutionItem(8);
            }, 11500);
            
            setTimeout(() => {
                status.textContent = '🎓 完了！これが順次処理です。上から順番に、一つずつ確実に実行されました。';
                bubble.style.display = 'none';
                clearHighlights();
                playBtn.disabled = false;
                playBtn.textContent = '🔬 詳細アニメーションを再生';
                isDetailedAnimating = false;
            }, 13000);
        }
        
        function resetDetailedAnimation() {
            const sprite = document.getElementById('sprite2');
            const bubble = document.getElementById('speech-bubble2');
            const status = document.getElementById('detailed-status');
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.transform = 'rotate(0deg)';
            bubble.style.display = 'none';
            status.textContent = '詳細アニメーションでプログラムの流れを確認しましょう！';
            clearHighlights();
            
            isDetailedAnimating = false;
            const playBtn = document.querySelectorAll('.play-btn')[1];
            if (playBtn) {
                playBtn.disabled = false;
                playBtn.textContent = '🔬 詳細アニメーションを再生';
            }
        }
        
        function highlightExecutionItem(step) {
            clearHighlights();
            const items = document.querySelectorAll('.execution-item');
            if (items[step - 1]) {
                items[step - 1].style.backgroundColor = '#fff3cd';
                items[step - 1].style.borderColor = '#ffc107';
                items[step - 1].style.transform = 'scale(1.02)';
            }
        }
        
        function clearHighlights() {
            const items = document.querySelectorAll('.execution-item');
            items.forEach(item => {
                item.style.backgroundColor = '#f0f8ff';
                item.style.borderColor = '#4A90E2';
                item.style.transform = 'scale(1)';
            });
        }
        
        // 条件分岐のステップ管理
        let currentIfStep = 1;
        let currentIfElseStep = 1;
        let isIfAnimating = false;
        let isIfElseAnimating = false;
        
        // もし〜なら のステップ管理
        function changeIfStep(direction) {
            currentIfStep += direction;
            if (currentIfStep < 1) currentIfStep = 1;
            if (currentIfStep > 5) currentIfStep = 5;
            updateIfStep();
            // 再レンダリングを無効化して色分けを維持
        }
        
        function updateIfStep() {
            document.querySelectorAll('#conditional-if .step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            document.getElementById('if-step' + currentIfStep).classList.add('step-active');
            document.getElementById('step-title-if').textContent = `ステップ ${currentIfStep} / 5`;
            document.getElementById('progress-if').style.width = (currentIfStep / 5 * 100) + '%';
            document.getElementById('prevBtn-if').disabled = currentIfStep === 1;
            document.getElementById('nextBtn-if').disabled = currentIfStep === 5;
            document.getElementById('nextBtn-if').textContent = currentIfStep === 5 ? '完了' : '次へ';
        }
        
        // もし〜ならでなければ のステップ管理
        function changeIfElseStep(direction) {
            currentIfElseStep += direction;
            if (currentIfElseStep < 1) currentIfElseStep = 1;
            if (currentIfElseStep > 4) currentIfElseStep = 4;
            updateIfElseStep();
            // 再レンダリングを無効化して色分けを維持
        }
        
        function updateIfElseStep() {
            document.querySelectorAll('#conditional-ifelse .step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            document.getElementById('ifelse-step' + currentIfElseStep).classList.add('step-active');
            document.getElementById('step-title-ifelse').textContent = `ステップ ${currentIfElseStep} / 4`;
            document.getElementById('progress-ifelse').style.width = (currentIfElseStep / 4 * 100) + '%';
            document.getElementById('prevBtn-ifelse').disabled = currentIfElseStep === 1;
            document.getElementById('nextBtn-ifelse').disabled = currentIfElseStep === 4;
            document.getElementById('nextBtn-ifelse').textContent = currentIfElseStep === 4 ? '完了' : '次へ';
        }
        
        // 条件分岐アニメーション機能
        function playIfAnimation() {
            if (isIfAnimating) return;
            isIfAnimating = true;
            
            const sprite = document.getElementById('sprite-if');
            const bubble = document.getElementById('speech-bubble-if');
            const status = document.getElementById('if-status');
            const randomNum = Math.floor(Math.random() * 10) + 1;
            
            // リセット
            resetIfAnimation();
            
            setTimeout(() => {
                status.textContent = `🎲 変数「数」: ${randomNum}`;
                bubble.textContent = `数は${randomNum}`;
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
            }, 1000);
            
            setTimeout(() => {
                if (randomNum > 5) {
                    status.textContent = `✅ ${randomNum} > 5 なので条件が真！右に動きます`;
                    bubble.textContent = '数字は大きいです！';
                    sprite.style.left = '250px';
                } else {
                    status.textContent = `❌ ${randomNum} ≤ 5 なので条件が偽！何もしません`;
                    bubble.style.display = 'none';
                }
            }, 3000);
            
            setTimeout(() => {
                bubble.style.display = 'none';
                status.textContent = '🔄 もう一度実行して違いを確認しよう！';
                isIfAnimating = false;
            }, 5000);
        }
        
        function resetIfAnimation() {
            const sprite = document.getElementById('sprite-if');
            const bubble = document.getElementById('speech-bubble-if');
            const status = document.getElementById('if-status');
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.transform = 'rotate(0deg)';
            bubble.style.display = 'none';
            status.textContent = 'ランダムな数字によって動きが変わります！';
            isIfAnimating = false;
        }
        
        function playIfElseAnimation() {
            if (isIfElseAnimating) return;
            isIfElseAnimating = true;
            
            const sprite = document.getElementById('sprite-ifelse');
            const bubble = document.getElementById('speech-bubble-ifelse');
            const status = document.getElementById('ifelse-status');
            const randomNum = Math.floor(Math.random() * 10) + 1;
            
            // リセット
            resetIfElseAnimation();
            
            setTimeout(() => {
                status.textContent = `🎲 選んだ数字: ${randomNum}`;
                bubble.textContent = `選んだ数字は${randomNum}`;
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
            }, 1000);
            
            setTimeout(() => {
                if (randomNum > 5) {
                    status.textContent = `✅ ${randomNum} > 5 なので条件が真！右に動きます`;
                    bubble.textContent = '大きい数字！';
                    sprite.style.left = '250px';
                } else {
                    status.textContent = `❌ ${randomNum} ≤ 5 なので条件が偽！左に動きます`;
                    bubble.textContent = '小さい数字！';
                    sprite.style.left = '0px';
                }
            }, 3000);
            
            setTimeout(() => {
                bubble.textContent = '動き完了！';
                status.textContent = '✨ 必ずどちらかの動きが実行されました！';
            }, 5000);
            
            setTimeout(() => {
                bubble.style.display = 'none';
                status.textContent = '🔄 何度も実行して2つのパターンを確認しよう！';
                isIfElseAnimating = false;
            }, 7000);
        }
        
        function resetIfElseAnimation() {
            const sprite = document.getElementById('sprite-ifelse');
            const bubble = document.getElementById('speech-bubble-ifelse');
            const status = document.getElementById('ifelse-status');
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.transform = 'rotate(0deg)';
            bubble.style.display = 'none';
            status.textContent = 'どちらかの動きが必ず実行されます！';
            isIfElseAnimating = false;
        }
        
        // 詳細アニメーション機能（後で実装）
        function playDetailedIfAnimation() {
            alert('詳細アニメーション機能は準備中です！');
        }
        
        function resetDetailedIfAnimation() {
            // 準備中
        }
        
        function playDetailedIfElseAnimation() {
            alert('詳細アニメーション機能は準備中です！');
        }
        
        function resetDetailedIfElseAnimation() {
            // 準備中
        }
        
        // 練習問題のアニメーション機能
        function playPractice1Animation() {
            const sprite = document.getElementById('sprite-practice1');
            const bubble = document.getElementById('speech-bubble-practice1');
            const status = document.getElementById('practice1-status');
            
            resetPractice1Animation();
            
            setTimeout(() => {
                status.textContent = '🌅 おはよう！';
                bubble.textContent = 'おはよう！';
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
            }, 1000);
            
            setTimeout(() => {
                status.textContent = '⏰ 2秒待機中...';
                bubble.style.display = 'none';
            }, 3000);
            
            setTimeout(() => {
                status.textContent = '💪 今日もがんばろう！';
                bubble.textContent = '今日もがんばろう！';
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
            }, 5000);
            
            setTimeout(() => {
                bubble.style.display = 'none';
                status.textContent = '✅ 練習問題1の目標動作完了！';
            }, 7000);
        }
        
        function resetPractice1Animation() {
            const sprite = document.getElementById('sprite-practice1');
            const bubble = document.getElementById('speech-bubble-practice1');
            const status = document.getElementById('practice1-status');
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.transform = 'rotate(0deg)';
            bubble.style.display = 'none';
            status.textContent = '練習問題1の目標となる動きです';
        }
        
        function playPractice2Animation() {
            const sprite = document.getElementById('sprite-practice2');
            const bubble = document.getElementById('speech-bubble-practice2');
            const status = document.getElementById('practice2-status');
            
            resetPractice2Animation();
            
            setTimeout(() => {
                status.textContent = '🚗 出発します！';
                bubble.textContent = '出発します！';
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
            }, 1000);
            
            setTimeout(() => {
                status.textContent = '⬅️ 左に30歩移動';
                bubble.style.display = 'none';
                sprite.style.left = '20px';
            }, 2500);
            
            setTimeout(() => {
                status.textContent = '⏰ 1秒待機';
            }, 3500);
            
            setTimeout(() => {
                status.textContent = '🔄 左に90度回転';
                sprite.style.transform = 'rotate(-90deg)';
            }, 4500);
            
            setTimeout(() => {
                status.textContent = '🏁 到着しました！';
                bubble.textContent = '到着しました！';
                bubble.style.display = 'block';
                bubble.style.left = '70px';
                bubble.style.top = '20px';
            }, 5500);
            
            setTimeout(() => {
                bubble.style.display = 'none';
                status.textContent = '✅ 練習問題2の目標動作完了！';
            }, 7000);
        }
        
        function resetPractice2Animation() {
            const sprite = document.getElementById('sprite-practice2');
            const bubble = document.getElementById('speech-bubble-practice2');
            const status = document.getElementById('practice2-status');
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.transform = 'rotate(0deg)';
            bubble.style.display = 'none';
            status.textContent = '練習問題2の目標となる動きです';
        }
        
        function playPractice3Animation() {
            const sprite = document.getElementById('sprite-practice3');
            const bubble = document.getElementById('speech-bubble-practice3');
            const status = document.getElementById('practice3-status');
            
            resetPractice3Animation();
            
            setTimeout(() => {
                status.textContent = '💃 ダンスを始めます♪';
                bubble.textContent = 'ダンスを始めます♪';
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
            }, 1000);
            
            setTimeout(() => {
                status.textContent = '➡️ 右に15歩移動';
                bubble.style.display = 'none';
                sprite.style.left = '100px';
            }, 2500);
            
            setTimeout(() => {
                status.textContent = '🔄 右に90度回転';
                sprite.style.transform = 'rotate(90deg)';
            }, 3500);
            
            setTimeout(() => {
                status.textContent = '🌀 くるくる〜';
                bubble.textContent = 'くるくる〜';
                bubble.style.display = 'block';
                bubble.style.left = '150px';
                bubble.style.top = '20px';
            }, 4500);
            
            setTimeout(() => {
                status.textContent = '🔄 また右に90度回転';
                bubble.style.display = 'none';
                sprite.style.transform = 'rotate(180deg)';
            }, 6000);
            
            setTimeout(() => {
                status.textContent = '➡️ また右に15歩移動';
                sprite.style.left = '150px';
            }, 7000);
            
            setTimeout(() => {
                status.textContent = '🎉 ダンス終了！';
                bubble.textContent = 'ダンス終了！';
                bubble.style.display = 'block';
                bubble.style.left = '200px';
                bubble.style.top = '20px';
            }, 8000);
            
            setTimeout(() => {
                bubble.style.display = 'none';
                status.textContent = '✅ 練習問題3の目標動作完了！';
            }, 9500);
        }
        
        function resetPractice3Animation() {
            const sprite = document.getElementById('sprite-practice3');
            const bubble = document.getElementById('speech-bubble-practice3');
            const status = document.getElementById('practice3-status');
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.transform = 'rotate(0deg)';
            bubble.style.display = 'none';
            status.textContent = '練習問題3の目標となる動きです';
        }
        
        // 答え表示機能
        function showAnswer1() {
            document.getElementById('answer1').style.display = 'block';
            document.getElementById('answerBtn1').disabled = true;
            document.getElementById('answerBtn1').textContent = '✅ 答えを表示中';
        }
        
        function showAnswer2() {
            document.getElementById('answer2').style.display = 'block';
            document.getElementById('answerBtn2').disabled = true;
            document.getElementById('answerBtn2').textContent = '✅ 答えを表示中';
        }
        
        function showAnswer3() {
            document.getElementById('answer3').style.display = 'block';
            document.getElementById('answerBtn3').disabled = true;
            document.getElementById('answerBtn3').textContent = '✅ 答えを表示中';
        }
        
        // もし〜なら の練習問題アニメーション機能
        function playIfPractice1Animation() {
            const sprite = document.getElementById('sprite-if-practice1');
            const bubble = document.getElementById('speech-bubble-if-practice1');
            const status = document.getElementById('if-practice1-status');
            const age = Math.floor(Math.random() * 20) + 1; // 1-20歳のランダム
            
            resetIfPractice1Animation();
            
            setTimeout(() => {
                status.textContent = `👤 年齢: ${age}歳`;
                bubble.textContent = `年齢は${age}歳`;
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
            }, 1000);
            
            setTimeout(() => {
                status.textContent = `⏱️ 1秒待つ...`;
                bubble.textContent = '1秒待つ';
            }, 3000);
            
            setTimeout(() => {
                if (age > 10) {
                    status.textContent = `✅ ${age}歳 > 10歳 なので大人ですね！`;
                    bubble.textContent = '大人ですね！';
                } else {
                    status.textContent = `❌ ${age}歳 ≤ 10歳 なので10歳以下ですね`;
                    bubble.textContent = '10歳以下ですね';
                }
            }, 4000);
            
            setTimeout(() => {
                bubble.style.display = 'none';
                status.textContent = '✅ 年齢チェック完了！';
            }, 6000);
        }
        
        function resetIfPractice1Animation() {
            const sprite = document.getElementById('sprite-if-practice1');
            const bubble = document.getElementById('speech-bubble-if-practice1');
            const status = document.getElementById('if-practice1-status');
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.transform = 'rotate(0deg)';
            bubble.style.display = 'none';
            status.textContent = '年齢をチェックするプログラムです';
        }
        
        function playIfPractice2Animation() {
            const sprite = document.getElementById('sprite-if-practice2');
            const bubble = document.getElementById('speech-bubble-if-practice2');
            const status = document.getElementById('if-practice2-status');
            const 天気 = Math.floor(Math.random() * 10) + 1; // 1-10の乱数
            
            resetIfPractice2Animation();
            
            setTimeout(() => {
                status.textContent = `🎲 天気の数値: ${天気}`;
                bubble.textContent = `天気は${天気}`;
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
            }, 1000);
            
            setTimeout(() => {
                if (天気 > 5) {
                    status.textContent = `☀️ ${天気} > 5 なので晴れだ！`;
                    bubble.textContent = '晴れだ！';
                    sprite.style.left = '200px';
                } else {
                    status.textContent = `☔ ${天気} ≤ 5 なので何もしません`;
                    bubble.style.display = 'none';
                }
            }, 3000);
            
            setTimeout(() => {
                bubble.style.display = 'none';
                status.textContent = '✅ 天気による行動決定完了！';
            }, 5000);
        }
        
        function resetIfPractice2Animation() {
            const sprite = document.getElementById('sprite-if-practice2');
            const bubble = document.getElementById('speech-bubble-if-practice2');
            const status = document.getElementById('if-practice2-status');
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.transform = 'rotate(0deg)';
            bubble.style.display = 'none';
            status.textContent = '天気に応じて行動を決めるプログラムです';
        }
        
        function playIfPractice3Animation() {
            const sprite = document.getElementById('sprite-if-practice3');
            const bubble = document.getElementById('speech-bubble-if-practice3');
            const status = document.getElementById('if-practice3-status');
            const スコア = Math.floor(Math.random() * 100) + 1; // 1-100点のランダム
            
            resetIfPractice3Animation();
            
            setTimeout(() => {
                status.textContent = `🎮 ゲーム開始！`;
                bubble.textContent = 'ゲーム開始';
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
            }, 1000);
            
            setTimeout(() => {
                status.textContent = `🎲 スコア生成: ${スコア}点`;
                bubble.textContent = `スコアは${スコア}点`;
                bubble.style.left = '150px';
            }, 3000);
            
            setTimeout(() => {
                if (スコア > 80) {
                    status.textContent = `🎉 ${スコア}点 > 80点 なのでレベルアップ！`;
                    bubble.textContent = 'レベルアップ！';
                    
                    // 36回繰り返して10度ずつ回転（合計360度）
                    let rotationCount = 0;
                    const rotateInterval = setInterval(() => {
                        rotationCount++;
                        const currentRotation = rotationCount * 10; // 10度ずつ回転
                        sprite.style.transform = `rotate(${currentRotation}deg)`;
                        
                        if (rotationCount >= 36) { // 36回回転したら停止
                            clearInterval(rotateInterval);
                        }
                    }, 50); // 50msごとに回転（合計1.8秒で一周）
                    
                } else {
                    status.textContent = `😐 ${スコア}点 ≤ 80点 なので何もしません`;
                    bubble.style.display = 'none';
                }
            }, 5000);
            
            setTimeout(() => {
                bubble.style.display = 'none';
                status.textContent = '✅ レベル判定完了！';
            }, 7000);
        }
        
        function resetIfPractice3Animation() {
            const sprite = document.getElementById('sprite-if-practice3');
            const bubble = document.getElementById('speech-bubble-if-practice3');
            const status = document.getElementById('if-practice3-status');
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.transform = 'rotate(0deg)';
            bubble.style.display = 'none';
            status.textContent = 'スコアによってレベルアップするかが決まります';
        }
        
        // もし〜なら の練習問題答え表示機能
        function showIfAnswer1() {
            document.getElementById('if-answer1').style.display = 'block';
            document.getElementById('ifAnswerBtn1').disabled = true;
            document.getElementById('ifAnswerBtn1').textContent = '✅ 答えを表示中';
        }
        
        function showIfAnswer2() {
            document.getElementById('if-answer2').style.display = 'block';
            document.getElementById('ifAnswerBtn2').disabled = true;
            document.getElementById('ifAnswerBtn2').textContent = '✅ 答えを表示中';
        }
        
        function showIfAnswer3() {
            document.getElementById('if-answer3').style.display = 'block';
            document.getElementById('ifAnswerBtn3').disabled = true;
            document.getElementById('ifAnswerBtn3').textContent = '✅ 答えを表示中';
        }
        
        // if-else練習問題のアニメーション機能
        function playIfElsePractice1Animation() {
            const sprite = document.getElementById('sprite-ifelse-practice1');
            const bubble = document.getElementById('speech-bubble-ifelse-practice1');
            const status = document.getElementById('ifelse-practice1-status');
            const 温度 = Math.floor(Math.random() * 21) + 10; // 10-30度のランダム
            
            resetIfElsePractice1Animation();
            
            setTimeout(() => {
                status.textContent = `🌡️ 今日の気温: ${温度}度`;
                bubble.textContent = `今日の気温は${温度}度`;
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
            }, 1000);
            
            setTimeout(() => {
                status.textContent = '⏱️ 1秒待つ...';
                bubble.textContent = '1秒待つ';
            }, 2500);
            
            setTimeout(() => {
                if (温度 < 20) {
                    status.textContent = `❄️ ${温度}度 < 20度 なので寒い！コートを着よう`;
                    bubble.textContent = 'コートを着よう';
                    sprite.style.transform = 'rotate(-90deg)'; // 左に回転
                } else {
                    status.textContent = `☀️ ${温度}度 ≥ 20度 なので暖かい！Tシャツでいいね`;
                    bubble.textContent = 'Tシャツでいいね';
                    sprite.style.transform = 'rotate(90deg)'; // 右に回転
                }
            }, 4000);
        }
        
        function resetIfElsePractice1Animation() {
            const sprite = document.getElementById('sprite-ifelse-practice1');
            const bubble = document.getElementById('speech-bubble-ifelse-practice1');
            const status = document.getElementById('ifelse-practice1-status');
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.transform = 'rotate(0deg)';
            bubble.style.display = 'none';
            status.textContent = '温度によって服装が決まります';
        }
        
        function playIfElsePractice2Animation() {
            const sprite = document.getElementById('sprite-ifelse-practice2');
            const bubble = document.getElementById('speech-bubble-ifelse-practice2');
            const status = document.getElementById('ifelse-practice2-status');
            const 時間 = Math.floor(Math.random() * 17) + 6; // 6-22時のランダム
            
            resetIfElsePractice2Animation();
            
            setTimeout(() => {
                status.textContent = `⏰ 現在の時刻: ${時間}時`;
                bubble.textContent = `現在の時刻は${時間}時だよ`;
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
            }, 1000);
            
            setTimeout(() => {
                status.textContent = '⏱️ 1秒待つ...';
                bubble.textContent = '1秒待つ';
            }, 2500);
            
            setTimeout(() => {
                if (時間 < 12) {
                    status.textContent = `🌅 ${時間}時 < 12時 なので午前！おはよう`;
                    bubble.textContent = 'おはよう！';
                    sprite.style.left = '150px'; // 右に移動
                } else {
                    status.textContent = `🌞 ${時間}時 ≥ 12時 なので午後！こんにちは`;
                    bubble.textContent = 'こんにちは！';
                    sprite.style.left = '0px'; // 左に移動
                }
            }, 4000);
        }
        
        function resetIfElsePractice2Animation() {
            const sprite = document.getElementById('sprite-ifelse-practice2');
            const bubble = document.getElementById('speech-bubble-ifelse-practice2');
            const status = document.getElementById('ifelse-practice2-status');
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.transform = 'rotate(0deg)';
            bubble.style.display = 'none';
            status.textContent = '時間によって挨拶が変わります';
        }
        
        // if-else答え表示機能
        function showIfElseAnswer1() {
            document.getElementById('ifelse-answer1').style.display = 'block';
            document.getElementById('ifElseAnswerBtn1').disabled = true;
            document.getElementById('ifElseAnswerBtn1').textContent = '✅ 答えを表示中';
        }
        
        function showIfElseAnswer2() {
            document.getElementById('ifelse-answer2').style.display = 'block';
            document.getElementById('ifElseAnswerBtn2').disabled = true;
            document.getElementById('ifElseAnswerBtn2').textContent = '✅ 答えを表示中';
        }
        
        // 繰り返し関連の関数
        function showLoop() {
            document.getElementById('home-view').style.display = 'none';
            document.getElementById('loop').style.display = 'block';
            currentLoopStep = 1;
            updateLoopStep();
            setTimeout(renderBlocks, 200);
        }
        
        let currentLoopStep = 1;
        
        function changeLoopStep(direction) {
            currentLoopStep += direction;
            if (currentLoopStep < 1) currentLoopStep = 1;
            if (currentLoopStep > 6) currentLoopStep = 6;
            updateLoopStep();
            setTimeout(renderBlocks, 200);
        }
        
        function updateLoopStep() {
            // Hide all steps
            document.querySelectorAll('#loop .step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            
            // Show current step
            document.getElementById('loop-step' + currentLoopStep).classList.add('step-active');
            
            // Update title and progress
            document.getElementById('step-title-loop').textContent = `ステップ ${currentLoopStep} / 6`;
            document.getElementById('progress-loop').style.width = (currentLoopStep / 6 * 100) + '%';
            
            // Update buttons
            document.getElementById('prevBtn-loop').disabled = currentLoopStep === 1;
            document.getElementById('nextBtn-loop').disabled = currentLoopStep === 6;
            document.getElementById('nextBtn-loop').textContent = currentLoopStep === 6 ? '完了' : '次へ';
        }
        
        // ループアニメーション
        function playLoopAnimation() {
            const sprite = document.getElementById('sprite-loop');
            const bubble = document.getElementById('speech-bubble-loop');
            const status = document.getElementById('loop-status');
            
            resetLoopAnimation();
            
            status.textContent = '🔄 10回繰り返し開始...';
            
            let loopCount = 0;
            const totalLoops = 10;
            
            function executeLoop() {
                if (loopCount >= totalLoops) {
                    status.textContent = '✅ 10回の繰り返しが完了しました！円が完成しました。';
                    return;
                }
                
                loopCount++;
                status.textContent = `🔄 ${loopCount}回目の繰り返し実行中...`;
                
                // 10歩動かす
                setTimeout(() => {
                    const currentLeft = parseInt(sprite.style.left) || 50;
                    const currentTop = parseInt(sprite.style.top) || 50;
                    const currentRotation = parseInt(sprite.style.transform.replace(/[^0-9-]/g, '')) || 0;
                    
                    // 現在の向きに基づいて移動
                    const radians = (currentRotation * Math.PI) / 180;
                    const moveX = Math.cos(radians) * 10;
                    const moveY = Math.sin(radians) * 10;
                    
                    sprite.style.left = (currentLeft + moveX) + 'px';
                    sprite.style.top = (currentTop + moveY) + 'px';
                }, 500);
                
                // 36度回転
                setTimeout(() => {
                    const currentRotation = parseInt(sprite.style.transform.replace(/[^0-9-]/g, '')) || 0;
                    sprite.style.transform = `rotate(${currentRotation + 36}deg)`;
                }, 1000);
                
                // 1秒待つ
                setTimeout(() => {
                    status.textContent = `⏰ ${loopCount}回目: 1秒待つ...`;
                }, 1500);
                
                // 次のループ実行
                setTimeout(executeLoop, 2500);
            }
            
            executeLoop();
        }
        
        function resetLoopAnimation() {
            const sprite = document.getElementById('sprite-loop');
            const bubble = document.getElementById('speech-bubble-loop');
            const status = document.getElementById('loop-status');
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.transform = 'rotate(0deg)';
            bubble.style.display = 'none';
            status.textContent = '同じ動きを繰り返し実行します！';
        }
        
        // 「何々まで繰り返す」デモ用のアニメーション
        function playUntilAnimation() {
            const sprite = document.getElementById('sprite-until');
            const status = document.getElementById('until-status');
            
            let stepCount = 0;
            let spritePos = 50;
            
            function executeUntilLoop() {
                stepCount++;
                status.textContent = `⏰ ${stepCount}回目: 10歩動かす...`;
                
                setTimeout(() => {
                    spritePos += 30;
                    sprite.style.left = spritePos + 'px';
                    
                    if (spritePos >= 300) {
                        // はしに触れた
                        setTimeout(() => {
                            status.textContent = '✅ はしに触れたので繰り返しを終了します！';
                        }, 500);
                    } else {
                        // まだ端に触れていない
                        setTimeout(() => {
                            status.textContent = '⏰ 0.5秒待つ...';
                        }, 500);
                        
                        setTimeout(() => {
                            status.textContent = '❓ はしに触れた...まだです';
                        }, 1000);
                        
                        setTimeout(executeUntilLoop, 1500);
                    }
                }, 500);
            }
            
            executeUntilLoop();
        }
        
        function resetUntilAnimation() {
            const sprite = document.getElementById('sprite-until');
            const status = document.getElementById('until-status');
            
            sprite.style.left = '50px';
            status.textContent = '条件が成立するまで繰り返します！';
        }
        
        // 色検出アニメーション
        function playColorAnimation() {
            const sprite = document.getElementById('sprite-color');
            const status = document.getElementById('color-status');
            
            let stepCount = 0;
            let spritePos = 50;
            
            function executeColorLoop() {
                stepCount++;
                status.textContent = `⏰ ${stepCount}回目: 5歩動かす...`;
                
                setTimeout(() => {
                    spritePos += 25;
                    sprite.style.left = spritePos + 'px';
                    
                    if (spritePos >= 250) {
                        // 色に触れた
                        setTimeout(() => {
                            status.textContent = '✅ 赤色に触れたので繰り返しを終了します！';
                        }, 500);
                    } else {
                        // まだ色に触れていない
                        setTimeout(() => {
                            status.textContent = '❓ 赤色に触れた？...まだです';
                        }, 500);
                        
                        setTimeout(executeColorLoop, 1000);
                    }
                }, 500);
            }
            
            executeColorLoop();
        }
        
        function resetColorAnimation() {
            const sprite = document.getElementById('sprite-color');
            const status = document.getElementById('color-status');
            
            sprite.style.left = '50px';
            status.textContent = '赤色に触れるまで繰り返します！';
        }
        
        // 答えの表示
        function showUntilAnswer1() {
            const answer = document.getElementById('until-answer1');
            answer.style.display = 'block';
        }
        
        function showUntilAnswer2() {
            const answer = document.getElementById('until-answer2');
            answer.style.display = 'block';
        }
        
        // マウスアニメーション
        function playMouseAnimation() {
            const sprite = document.getElementById('sprite-mouse');
            const mousePointer = document.getElementById('mouse-pointer');
            const status = document.getElementById('mouse-status');
            const bubble = document.getElementById('speech-bubble-mouse');
            
            let stepCount = 0;
            let spriteX = 50;
            let spriteY = 50;
            const mouseX = 300;
            const mouseY = 100;
            
            function executeMouseLoop() {
                stepCount++;
                status.textContent = `⏰ ${stepCount}回目: (マウスポインター v)へ向ける...`;
                
                setTimeout(() => {
                    // マウスポインターの方向を計算
                    const deltaX = mouseX - spriteX;
                    const deltaY = mouseY - spriteY;
                    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                    
                    if (distance <= 20) {
                        // マウスに触れた
                        status.textContent = '✅ マウスポインターに触れました！';
                        setTimeout(() => {
                            bubble.textContent = 'こんにちは！';
                            bubble.style.display = 'block';
                            bubble.style.left = (spriteX + 30) + 'px';
                            bubble.style.top = (spriteY - 30) + 'px';
                        }, 500);
                    } else {
                        // 3歩動かす
                        const moveX = (deltaX / distance) * 15;
                        const moveY = (deltaY / distance) * 15;
                        
                        spriteX += moveX;
                        spriteY += moveY;
                        
                        sprite.style.left = spriteX + 'px';
                        sprite.style.top = spriteY + 'px';
                        
                        status.textContent = `⏰ ${stepCount}回目: 3歩動かす...`;
                        
                        setTimeout(() => {
                            status.textContent = '⏰ 0.1秒待つ...';
                        }, 500);
                        
                        setTimeout(() => {
                            status.textContent = '❓ (マウスポインター v)に触れた...まだです';
                        }, 600);
                        
                        setTimeout(executeMouseLoop, 1000);
                    }
                }, 500);
            }
            
            executeMouseLoop();
        }
        
        function resetMouseAnimation() {
            const sprite = document.getElementById('sprite-mouse');
            const bubble = document.getElementById('speech-bubble-mouse');
            const status = document.getElementById('mouse-status');
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            bubble.style.display = 'none';
            status.textContent = 'マウスポインターに触れるまで動き続けます！';
        }
        
        // 座標とステージの機能
        let currentCoordinatesStep = 1;
        
        function changeCoordinatesStep(direction) {
            currentCoordinatesStep += direction;
            if (currentCoordinatesStep < 1) currentCoordinatesStep = 1;
            if (currentCoordinatesStep > 4) currentCoordinatesStep = 4;
            updateCoordinatesStep();
            setTimeout(renderBlocks, 200);
        }
        
        function updateCoordinatesStep() {
            document.querySelectorAll('#coordinates .step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            document.getElementById('coordinates-step' + currentCoordinatesStep).classList.add('step-active');
            document.getElementById('step-title-coordinates').textContent = `ステップ ${currentCoordinatesStep} / 4`;
            document.getElementById('progress-coordinates').style.width = (currentCoordinatesStep / 4 * 100) + '%';
            document.getElementById('prevBtn-coordinates').disabled = currentCoordinatesStep === 1;
            document.getElementById('nextBtn-coordinates').disabled = currentCoordinatesStep === 4;
            document.getElementById('nextBtn-coordinates').textContent = currentCoordinatesStep === 4 ? '完了' : '次へ';
        }
        
        function playCoordinatesAnimation() {
            const sprite = document.getElementById('sprite-coordinates');
            const status = document.getElementById('coordinates-status');
            const bubble = document.getElementById('speech-bubble-coordinates');
            const canvas = document.getElementById('coordinates-canvas');
            const ctx = canvas.getContext('2d');
            
            // キャンバスをクリア（全部消すブロックの効果）
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            
            let step = 0;
            const positions = [
                {x: 200, y: 60, text: '全部消す→ペンを置く→中央(0,0)からスタート'},
                {x: 300, y: 60, text: 'X座標を100に→右へ移動'},
                {x: 300, y: 10, text: 'Y座標を100に→上へ移動'},
                {x: 200, y: 10, text: 'X座標を0に→左へ移動'},
                {x: 200, y: 60, text: 'Y座標を0に→下へ移動、四角形完成！'}
            ];
            
            function executeStep() {
                if (step < positions.length) {
                    status.textContent = positions[step].text;
                    
                    // スプライトを移動
                    sprite.style.left = positions[step].x + 'px';
                    sprite.style.top = positions[step].y + 'px';
                    
                    // 線を描画（ペンを置くブロックの効果）
                    if (step > 0) {
                        const prevPos = positions[step - 1];
                        const currentPos = positions[step];
                        
                        ctx.beginPath();
                        ctx.moveTo(prevPos.x + 12, prevPos.y + 12); // スプライトの中心
                        ctx.lineTo(currentPos.x + 12, currentPos.y + 12);
                        ctx.stroke();
                    }
                    
                    if (step === positions.length - 1) {
                        setTimeout(() => {
                            bubble.textContent = '四角形完成！ペンで線が描けました！';
                            bubble.style.display = 'block';
                            bubble.style.left = (positions[step].x + 30) + 'px';
                            bubble.style.top = (positions[step].y - 30) + 'px';
                        }, 500);
                    }
                    
                    step++;
                    if (step < positions.length) {
                        setTimeout(executeStep, 1500);
                    }
                }
            }
            
            executeStep();
        }
        
        function resetCoordinatesAnimation() {
            const sprite = document.getElementById('sprite-coordinates');
            const status = document.getElementById('coordinates-status');
            const bubble = document.getElementById('speech-bubble-coordinates');
            const canvas = document.getElementById('coordinates-canvas');
            const ctx = canvas.getContext('2d');
            
            // キャンバスをクリア
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            sprite.style.left = '200px';
            sprite.style.top = '60px';
            bubble.style.display = 'none';
            status.textContent = '座標を使って四角形を描きます！';
        }
        
        function playTriangleAnimation() {
            const sprite = document.getElementById('sprite-triangle');
            const status = document.getElementById('triangle-status');
            const bubble = document.getElementById('speech-bubble-triangle');
            const canvas = document.getElementById('triangle-canvas');
            const ctx = canvas.getContext('2d');
            
            // キャンバスをクリア（全部消すブロックの効果）
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            
            let step = 0;
            const positions = [
                {x: 200, y: 20, text: '全部消す→ペンを置く→上の頂点(0,100)へ移動'},
                {x: 120, y: 100, text: '左下(-80,-50)へ移動'},
                {x: 280, y: 100, text: '右下(80,-50)へ移動'},
                {x: 200, y: 20, text: '上の頂点に戻って三角形完成！'}
            ];
            
            function executeStep() {
                if (step < positions.length) {
                    status.textContent = positions[step].text;
                    
                    // スプライトを移動
                    sprite.style.left = positions[step].x + 'px';
                    sprite.style.top = positions[step].y + 'px';
                    
                    // 線を描画（ペンを置くブロックの効果）
                    if (step > 0) {
                        const prevPos = positions[step - 1];
                        const currentPos = positions[step];
                        
                        ctx.beginPath();
                        ctx.moveTo(prevPos.x + 12, prevPos.y + 12);
                        ctx.lineTo(currentPos.x + 12, currentPos.y + 12);
                        ctx.stroke();
                    }
                    
                    if (step === positions.length - 1) {
                        setTimeout(() => {
                            bubble.textContent = '三角形完成！ペンで線が描けました！';
                            bubble.style.display = 'block';
                            bubble.style.left = (positions[step].x + 30) + 'px';
                            bubble.style.top = (positions[step].y - 30) + 'px';
                        }, 500);
                    }
                    
                    step++;
                    if (step < positions.length) {
                        setTimeout(executeStep, 1500);
                    }
                }
            }
            
            executeStep();
        }
        
        function resetTriangleAnimation() {
            const sprite = document.getElementById('sprite-triangle');
            const status = document.getElementById('triangle-status');
            const bubble = document.getElementById('speech-bubble-triangle');
            const canvas = document.getElementById('triangle-canvas');
            const ctx = canvas.getContext('2d');
            
            // キャンバスをクリア
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            sprite.style.left = '200px';
            sprite.style.top = '60px';
            bubble.style.display = 'none';
            status.textContent = '三角形の頂点を座標で指定します';
        }
        
        function playStarAnimation() {
            const sprite = document.getElementById('sprite-star');
            const status = document.getElementById('star-status');
            const bubble = document.getElementById('speech-bubble-star');
            const canvas = document.getElementById('star-canvas');
            const ctx = canvas.getContext('2d');
            
            // キャンバスをクリア（全部消すブロックの効果）
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            
            let step = 0;
            const positions = [
                {x: 200, y: 10, text: '上の頂点(0,120)へ'},
                {x: 270, y: 50, text: '右上(70,40)へ'},
                {x: 245, y: 120, text: '右下(45,-80)へ'},
                {x: 155, y: 120, text: '左下(-45,-80)へ'},
                {x: 130, y: 50, text: '左上(-70,40)へ'},
                {x: 200, y: 10, text: '上に戻って五角形完成！'}
            ];
            
            function executeStep() {
                if (step < positions.length) {
                    status.textContent = positions[step].text;
                    sprite.style.left = positions[step].x + 'px';
                    sprite.style.top = positions[step].y + 'px';
                    
                    // 線を描画（ペンを置くブロックの効果）
                    if (step > 0) {
                        const prevPos = positions[step - 1];
                        const currentPos = positions[step];
                        
                        ctx.beginPath();
                        ctx.moveTo(prevPos.x + 12, prevPos.y + 12);
                        ctx.lineTo(currentPos.x + 12, currentPos.y + 12);
                        ctx.stroke();
                    }
                    
                    if (step === positions.length - 1) {
                        setTimeout(() => {
                            bubble.textContent = '五角形完成！';
                            bubble.style.display = 'block';
                            bubble.style.left = (positions[step].x + 30) + 'px';
                            bubble.style.top = (positions[step].y - 30) + 'px';
                        }, 500);
                    }
                    
                    step++;
                    if (step < positions.length) {
                        setTimeout(executeStep, 1500);
                    }
                }
            }
            
            executeStep();
        }
        
        function resetStarAnimation() {
            const sprite = document.getElementById('sprite-star');
            const status = document.getElementById('star-status');
            const bubble = document.getElementById('speech-bubble-star');
            const canvas = document.getElementById('star-canvas');
            const ctx = canvas.getContext('2d');
            
            // キャンバスをクリア
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            sprite.style.left = '200px';
            sprite.style.top = '60px';
            bubble.style.display = 'none';
            status.textContent = '五角形の頂点を座標で移動します';
        }
        
        function showCoordinatesAnswer1() {
            document.getElementById('coordinates-answer1').style.display = 'block';
        }
        
        function showCoordinatesAnswer2() {
            document.getElementById('coordinates-answer2').style.display = 'block';
        }
        
        // Variables section functions
        function showVariablesMenu() {
            hideAllViews();
            document.getElementById('variables-menu').style.display = 'block';
        }
        
        // Health System functions
        function showHealthSystem() {
            hideAllViews();
            document.getElementById('health-system').style.display = 'block';
            currentStep = 1;
            updateHealthStep();
            setTimeout(renderBlocks, 100);
        }
        
        function changeHealthStep(direction) {
            currentStep += direction;
            if (currentStep < 1) currentStep = 1;
            if (currentStep > 4) currentStep = 4;
            updateHealthStep();
            setTimeout(renderBlocks, 100);
        }
        
        function updateHealthStep() {
            // Hide all steps
            document.querySelectorAll('#health-system .step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            
            // Show current step
            document.getElementById('health-step' + currentStep).classList.add('step-active');
            
            // Update title and progress
            document.getElementById('health-step-title').textContent = `ステップ ${currentStep} / 4`;
            document.getElementById('health-progress').style.width = (currentStep / 4 * 100) + '%';
            
            // Update buttons
            document.getElementById('healthPrevBtn').disabled = currentStep === 1;
            document.getElementById('healthNextBtn').disabled = currentStep === 4;
            document.getElementById('healthNextBtn').textContent = currentStep === 4 ? '完了' : '次へ';
        }
        
        // Score System functions
        function showScoreSystem() {
            hideAllViews();
            document.getElementById('score-system').style.display = 'block';
            currentStep = 1;
            updateScoreStep();
            setTimeout(renderBlocks, 100);
        }
        
        function changeScoreStep(direction) {
            currentStep += direction;
            if (currentStep < 1) currentStep = 1;
            if (currentStep > 3) currentStep = 3;
            updateScoreStep();
            setTimeout(renderBlocks, 100);
        }
        
        function updateScoreStep() {
            // Hide all steps
            document.querySelectorAll('#score-system .step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            
            // Show current step
            document.getElementById('score-step' + currentStep).classList.add('step-active');
            
            // Update title and progress
            document.getElementById('score-step-title').textContent = `ステップ ${currentStep} / 3`;
            document.getElementById('score-progress').style.width = (currentStep / 3 * 100) + '%';
            
            // Update buttons
            document.getElementById('scorePrevBtn').disabled = currentStep === 1;
            document.getElementById('scoreNextBtn').disabled = currentStep === 3;
            document.getElementById('scoreNextBtn').textContent = currentStep === 3 ? '完了' : '次へ';
        }
        
        // String Variables functions
        function showStringVariables() {
            hideAllViews();
            document.getElementById('string-variables').style.display = 'block';
            currentStep = 1;
            updateStringStep();
            setTimeout(renderBlocks, 100);
        }
        
        function changeStringStep(direction) {
            currentStep += direction;
            if (currentStep < 1) currentStep = 1;
            if (currentStep > 3) currentStep = 3;
            updateStringStep();
            setTimeout(renderBlocks, 100);
        }
        
        function updateStringStep() {
            // Hide all steps
            document.querySelectorAll('#string-variables .step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            
            // Show current step
            document.getElementById('string-step' + currentStep).classList.add('step-active');
            
            // Update title and progress
            document.getElementById('string-step-title').textContent = `ステップ ${currentStep} / 3`;
            document.getElementById('string-progress').style.width = (currentStep / 3 * 100) + '%';
            
            // Update buttons
            document.getElementById('stringPrevBtn').disabled = currentStep === 1;
            document.getElementById('stringNextBtn').disabled = currentStep === 3;
            document.getElementById('stringNextBtn').textContent = currentStep === 3 ? '完了' : '次へ';
        }
        
        function playHealthAnimation() {
            const status = document.getElementById('health-status');
            const healthDisplay = document.getElementById('health-display');
            let health = 100;
            
            status.textContent = 'キャラクターの体力を表示します！';
            healthDisplay.textContent = `❤️ 体力: ${health}`;
            
            setTimeout(() => {
                health = 80;
                status.textContent = 'ダメージを受けました！体力が減ります';
                healthDisplay.textContent = `❤️ 体力: ${health}`;
                healthDisplay.style.color = '#FF6600';
            }, 2000);
            
            setTimeout(() => {
                health = 60;
                status.textContent = 'さらにダメージ！体力がどんどん減っています';
                healthDisplay.textContent = `❤️ 体力: ${health}`;
                healthDisplay.style.color = '#f44336';
            }, 4000);
            
            setTimeout(() => {
                health = 100;
                status.textContent = '回復アイテムで体力が全回復しました！';
                healthDisplay.textContent = `❤️ 体力: ${health}`;
                healthDisplay.style.color = '#4CAF50';
            }, 6000);
        }
        
        function resetHealthAnimation() {
            const status = document.getElementById('health-status');
            const healthDisplay = document.getElementById('health-display');
            
            status.textContent = '体力システムのアニメーション';
            healthDisplay.textContent = '❤️ 体力: 100';
            healthDisplay.style.color = '#4CAF50';
        }
        
        function playScoreAnimation() {
            const status = document.getElementById('score-status');
            const scoreDisplay = document.getElementById('score-display');
            let score = 0;
            
            status.textContent = 'ゲームスコアを計算します！';
            scoreDisplay.textContent = `🏆 スコア: ${score}`;
            
            setTimeout(() => {
                score += 10;
                status.textContent = 'アイテムを1個取りました！ +10点';
                scoreDisplay.textContent = `🏆 スコア: ${score}`;
            }, 2000);
            
            setTimeout(() => {
                score += 10;
                status.textContent = 'アイテムを2個目！ +10点';
                scoreDisplay.textContent = `🏆 スコア: ${score}`;
            }, 4000);
            
            setTimeout(() => {
                score += 50;
                status.textContent = 'ボーナスアイテム！ +50点';
                scoreDisplay.textContent = `🏆 スコア: ${score}`;
                scoreDisplay.style.color = '#FF6600';
            }, 6000);
            
            setTimeout(() => {
                status.textContent = `最終スコア: ${score}点！よくできました！`;
                scoreDisplay.style.color = '#7C3F9E';
            }, 8000);
        }
        
        function resetScoreAnimation() {
            const status = document.getElementById('score-status');
            const scoreDisplay = document.getElementById('score-display');
            
            status.textContent = 'スコア計算のアニメーション';
            scoreDisplay.textContent = '🏆 スコア: 0';
            scoreDisplay.style.color = '#2c3e50';
        }
        
        function playNameAnimation() {
            const status = document.getElementById('name-status');
            const nameDisplay = document.getElementById('name-display');
            const messages = [
                { name: '', message: '名前を入力してください' },
                { name: 'たろう', message: 'こんにちは、たろうさん！' },
                { name: 'はなこ', message: 'はなこさん、元気ですか？' },
                { name: 'みらい', message: 'みらいさん、よろしくお願いします！' }
            ];
            
            let step = 0;
            function nextStep() {
                if (step < messages.length) {
                    status.textContent = messages[step].message;
                    nameDisplay.textContent = `👤 名前: ${messages[step].name}`;
                    step++;
                    if (step < messages.length) {
                        setTimeout(nextStep, 2500);
                    }
                }
            }
            
            nextStep();
        }
        
        function resetNameAnimation() {
            const status = document.getElementById('name-status');
            const nameDisplay = document.getElementById('name-display');
            
            status.textContent = '文字列変数のアニメーション';
            nameDisplay.textContent = '👤 名前: ';
        }
        
        function showHealthAnswer1() {
            document.getElementById('health-answer1').style.display = 'block';
        }
        
        function showScoreAnswer1() {
            document.getElementById('score-answer1').style.display = 'block';
        }
        
        function showStringAnswer1() {
            document.getElementById('string-answer1').style.display = 'block';
        }
        
        // Conditional branching functions
        function showConditionalMenu() {
            hideAllViews();
            document.getElementById('conditional-menu').style.display = 'block';
        }
        
        // If-Then section functions
        function showIfThen() {
            hideAllViews();
            document.getElementById('if-then-section').style.display = 'block';
            currentIfStep = 1;
            updateIfStep();
            setTimeout(renderBlocks, 100);
        }
        
        function changeIfStep(direction) {
            currentIfStep += direction;
            if (currentIfStep < 1) currentIfStep = 1;
            if (currentIfStep > 4) currentIfStep = 4;
            updateIfStep();
            setTimeout(renderBlocks, 100);
        }
        
        function updateIfStep() {
            // Hide all steps
            document.querySelectorAll('#if-then-section .step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            
            // Show current step
            document.getElementById('if-step' + currentIfStep).classList.add('step-active');
            
            // Update title and progress
            document.getElementById('if-step-title').textContent = `ステップ ${currentIfStep} / 4`;
            document.getElementById('if-progress').style.width = (currentIfStep / 4 * 100) + '%';
            
            // Update buttons
            document.getElementById('ifPrevBtn').disabled = currentIfStep === 1;
            document.getElementById('ifNextBtn').disabled = currentIfStep === 4;
            document.getElementById('ifNextBtn').textContent = currentIfStep === 4 ? '完了' : '次へ';
        }
        
        // If-Else section functions
        function showIfElse() {
            hideAllViews();
            document.getElementById('if-else-section').style.display = 'block';
            currentIfElseStep = 1;
            updateIfElseStep();
            setTimeout(renderBlocks, 100);
        }
        
        function changeIfElseStep(direction) {
            currentIfElseStep += direction;
            if (currentIfElseStep < 1) currentIfElseStep = 1;
            if (currentIfElseStep > 4) currentIfElseStep = 4;
            updateIfElseStep();
            setTimeout(renderBlocks, 100);
        }
        
        function updateIfElseStep() {
            // Hide all steps
            document.querySelectorAll('#if-else-section .step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            
            // Show current step
            document.getElementById('ifelse-step' + currentIfElseStep).classList.add('step-active');
            
            // Update title and progress
            document.getElementById('ifelse-step-title').textContent = `ステップ ${currentIfElseStep} / 4`;
            document.getElementById('ifelse-progress').style.width = (currentIfElseStep / 4 * 100) + '%';
            
            // Update buttons
            document.getElementById('ifElsePrevBtn').disabled = currentIfElseStep === 1;
            document.getElementById('ifElseNextBtn').disabled = currentIfElseStep === 4;
            document.getElementById('ifElseNextBtn').textContent = currentIfElseStep === 4 ? '完了' : '次へ';
        }
        
        // Animation functions for conditional demonstrations
        function playIfAnimation() {
            const display = document.getElementById('if-display');
            const status = document.getElementById('if-status');
            const number = Math.floor(Math.random() * 10) + 1; // 1-10の乱数
            
            status.textContent = '条件分岐のデモを開始します...';
            
            setTimeout(() => {
                display.textContent = `🎲 数字: ${number}`;
                status.textContent = `変数「数」に${number}が入りました`;
            }, 1000);
            
            setTimeout(() => {
                if (number > 5) {
                    status.textContent = `${number} > 5 なので「すごい！」と言います`;
                } else {
                    status.textContent = `${number} ≤ 5 なので何もしません`;
                }
            }, 3000);
            
            setTimeout(() => {
                status.textContent = '条件分岐のデモ完了！';
            }, 5000);
        }
        
        function resetIfAnimation() {
            const display = document.getElementById('if-display');
            const status = document.getElementById('if-status');
            
            display.textContent = '🎲 数字: ?';
            status.textContent = '条件分岐のアニメーション';
        }
        
        function playIfElseAnimation() {
            const display = document.getElementById('ifelse-display');
            const status = document.getElementById('ifelse-status');
            const number = Math.floor(Math.random() * 10) + 1; // 1-10の乱数
            
            status.textContent = 'if-else分岐のデモを開始します...';
            
            setTimeout(() => {
                display.textContent = `🎲 数字: ${number}`;
                status.textContent = `変数「数」に${number}が入りました`;
            }, 1000);
            
            setTimeout(() => {
                if (number > 5) {
                    status.textContent = `${number} > 5 なので「大きいですね！」と言います`;
                } else {
                    status.textContent = `${number} ≤ 5 なので「小さいですね！」と言います`;
                }
            }, 3000);
            
            setTimeout(() => {
                status.textContent = 'if-else分岐のデモ完了！';
            }, 5000);
        }
        
        function resetIfElseAnimation() {
            const display = document.getElementById('ifelse-display');
            const status = document.getElementById('ifelse-status');
            
            display.textContent = '🎲 数字: ?';
            status.textContent = 'if-else分岐のアニメーション';
        }
        
        // Utility function to hide all views
        function hideAllViews() {
            console.log('=== hideAllViews called - V2.0 ===');
            // Hide all main sections - only hide elements that actually exist
            const elements = [
                'home-view',
                'variables-menu', 
                'health-system',
                'score-system',
                'string-variables',
                'conditional-menu',
                'if-then-section',
                'if-else-section',
                'loop',
                // Clone sections
                'clones-menu',
                'basic-clone-section',
                'clone-movement-section',
                'clone-deletion-section',
                'clone-applications-section',
                // New sections
                'sounds-menu',
                'messages-menu',
                'backgrounds-menu',
                'lists-menu',
                'pen-menu'
            ];
            
            elements.forEach(id => {
                try {
                    const element = document.getElementById(id);
                    if (element) {
                        element.style.display = 'none';
                    }
                } catch (error) {
                    console.error('Error hiding element:', id, error);
                }
            });
            console.log('=== hideAllViews completed - V2.0 ===');
        }
        
        // Clone functionality functions
        function showClonesMenu() {
            console.log('showClonesMenu called');
            hideAllViews();
            console.log('All views hidden');
            const clonesMenu = document.getElementById('clones-menu');
            if (clonesMenu) {
                clonesMenu.style.display = 'block';
                console.log('clones-menu display set to block');
            } else {
                console.error('clones-menu element not found');
            }
        }
        
        function showBasicClone() {
            console.log('showBasicClone called');
            hideAllViews();
            const basicCloneSection = document.getElementById('basic-clone-section');
            if (basicCloneSection) {
                basicCloneSection.style.display = 'block';
                console.log('basic-clone-section display set to block');
            } else {
                console.error('basic-clone-section element not found');
            }
            currentCloneBasicStep = 1;
            updateCloneBasicStep();
        }
        
        function showCloneMovement() {
            hideAllViews();
            document.getElementById('clone-movement-section').style.display = 'block';
            currentCloneMovementStep = 1;
            updateCloneMovementStep();
            setTimeout(renderBlocks, 100);
        }
        
        function showCloneDeletion() {
            hideAllViews();
            document.getElementById('clone-deletion-section').style.display = 'block';
            currentCloneDeletionStep = 1;
            updateCloneDeletionStep();
            setTimeout(renderBlocks, 100);
        }
        
        function showCloneApplications() {
            hideAllViews();
            document.getElementById('clone-applications-section').style.display = 'block';
            currentCloneApplicationsStep = 1;
            updateCloneApplicationsStep();
            setTimeout(renderBlocks, 100);
        }
        
        // Basic clone section navigation
        let currentCloneBasicStep = 1;
        
        function changeCloneBasicStep(direction) {
            currentCloneBasicStep += direction;
            if (currentCloneBasicStep < 1) currentCloneBasicStep = 1;
            if (currentCloneBasicStep > 4) currentCloneBasicStep = 4;
            updateCloneBasicStep();
            setTimeout(renderBlocks, 100);
        }
        
        function updateCloneBasicStep() {
            // Hide all steps
            document.querySelectorAll('#basic-clone-section .step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            
            // Show current step
            document.getElementById('clone-basic-step' + currentCloneBasicStep).classList.add('step-active');
            
            // Update title and progress
            document.getElementById('clone-basic-step-title').textContent = `ステップ ${currentCloneBasicStep} / 4`;
            document.getElementById('clone-basic-progress').style.width = (currentCloneBasicStep / 4 * 100) + '%';
            
            // Update buttons
            document.getElementById('cloneBasicPrevBtn').disabled = currentCloneBasicStep === 1;
            document.getElementById('cloneBasicNextBtn').disabled = currentCloneBasicStep === 4;
            document.getElementById('cloneBasicNextBtn').textContent = currentCloneBasicStep === 4 ? '完了' : '次へ';
        }
        
        // Clone movement section navigation
        let currentCloneMovementStep = 1;
        
        function changeCloneMovementStep(direction) {
            currentCloneMovementStep += direction;
            if (currentCloneMovementStep < 1) currentCloneMovementStep = 1;
            if (currentCloneMovementStep > 4) currentCloneMovementStep = 4;
            updateCloneMovementStep();
            setTimeout(renderBlocks, 100);
        }
        
        function updateCloneMovementStep() {
            // Hide all steps
            document.querySelectorAll('#clone-movement-section .step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            
            // Show current step
            document.getElementById('clone-movement-step' + currentCloneMovementStep).classList.add('step-active');
            
            // Update title and progress
            document.getElementById('clone-movement-step-title').textContent = `ステップ ${currentCloneMovementStep} / 4`;
            document.getElementById('clone-movement-progress').style.width = (currentCloneMovementStep / 4 * 100) + '%';
            
            // Update buttons
            document.getElementById('cloneMovementPrevBtn').disabled = currentCloneMovementStep === 1;
            document.getElementById('cloneMovementNextBtn').disabled = currentCloneMovementStep === 4;
            document.getElementById('cloneMovementNextBtn').textContent = currentCloneMovementStep === 4 ? '完了' : '次へ';
        }
        
        // Clone animation functions - 安全版
        let basicAnimationInProgress = false;

        function startBasicCloneAnimation() {
            if (basicAnimationInProgress) return;
            
            console.log('startBasicCloneAnimation called');
            basicAnimationInProgress = true;
            
            const sprite = document.getElementById('sprite-clone-basic');
            const bubble = document.getElementById('speech-bubble-clone-basic');
            const status = document.getElementById('clone-basic-status');
            const stage = sprite ? sprite.parentNode : null;
            
            console.log('Elements check:', {sprite, bubble, status, stage});
            
            if (!sprite || !bubble || !status || !stage) {
                console.error('Required elements not found for basic clone animation');
                status && (status.textContent = 'エラー: 要素が見つかりません');
                basicAnimationInProgress = false;
                return;
            }

            resetBasicCloneAnimation();
            status.textContent = '🧬 クローン作成開始...';
            
            // 即座にクローンを作成（setTimeoutを使わない）
            try {
                for (let i = 1; i <= 3; i++) {
                    console.log(`クローン${i}作成中`);
                    
                    const clone = sprite.cloneNode(true);
                    if (!clone) {
                        throw new Error(`Failed to create clone ${i}`);
                    }
                    
                    clone.id = `basic-clone-${i}`;
                    clone.style.left = (50 + i * 80) + 'px';
                    clone.style.top = (50 + i * 20) + 'px';
                    clone.style.background = `hsl(${i * 60}, 70%, 60%)`;
                    clone.style.display = 'flex';
                    clone.style.position = 'absolute';
                    
                    console.log(`作成したクローン:`, clone);
                    console.log(`親要素:`, sprite.parentNode);
                    
                    sprite.parentNode.appendChild(clone);
                    
                    // クローンが実際に追加されたか確認
                    const addedClone = document.getElementById(`basic-clone-${i}`);
                    console.log(`追加されたクローン確認:`, addedClone);
                    console.log(`クローンのスタイル:`, addedClone ? addedClone.style.cssText : 'not found');
                    
                    // 全クローンの数を確認
                    const allClones = document.querySelectorAll('[id^="basic-clone-"]');
                    console.log(`現在のクローン総数:`, allClones.length);
                }
                
                status.textContent = `🎉 3個のクローンが作成されました！`;
                
            } catch (error) {
                console.error(`Error creating clones:`, error);
                console.error('Error stack:', error.stack);
                status.textContent = `❌ エラー: クローンの作成に失敗しました - ${error.message}`;
                basicAnimationInProgress = false;
                return;
            }
            
            setTimeout(() => {
                status.textContent = '✅ 3個のクローンが作成完了！それぞれが独立して存在しています。';
                console.log('基本クローンアニメーション完了');
                basicAnimationInProgress = false;
            }, 4000);
        }


        // 古い関数名との互換性を保つ
        function playBasicCloneAnimation() {
            startBasicCloneAnimation();
        }
        
        // 詳細クローンアニメーション
        function playCloneDetailAnimation() {
            console.log('playCloneDetailAnimation called');
            const sprite = document.getElementById('sprite-clone-detail');
            const bubble = document.getElementById('speech-bubble-clone-detail');
            const status = document.getElementById('clone-detail-status');
            
            if (!sprite || !bubble || !status) {
                console.error('Detail animation elements not found');
                return;
            }
            
            resetCloneDetailAnimation();
            
            status.textContent = '📋 ステップ1: 元のスプライトがクローンを作る準備をします';
            
            setTimeout(() => {
                bubble.textContent = '今からクローンを作ります！';
                bubble.style.display = 'block';
                bubble.style.left = '120px';
                bubble.style.top = '20px';
                status.textContent = '📋 ステップ2: 「クローンを作る」ブロックを実行中...';
            }, 1500);
            
            setTimeout(() => {
                bubble.style.display = 'none';
                const clone = sprite.cloneNode(true);
                clone.id = 'detail-clone-1';
                clone.style.left = '200px';
                clone.style.top = '50px';
                clone.style.background = '#4CAF50';
                sprite.parentNode.appendChild(clone);
                
                status.textContent = '📋 ステップ3: 新しいクローンが作成されました！';
            }, 3000);
            
            setTimeout(() => {
                bubble.textContent = 'クローンされました！';
                bubble.style.display = 'block';
                bubble.style.left = '270px';
                bubble.style.top = '20px';
                status.textContent = '📋 ステップ4: クローンが「クローンされたとき」を実行中';
            }, 4000);
            
            setTimeout(() => {
                bubble.style.display = 'none';
                status.textContent = '✅ クローン作成完了！元とクローンが独立して存在しています';
            }, 6000);
        }
        
        function resetCloneDetailAnimation() {
            console.log('resetCloneDetailAnimation called');
            const sprite = document.getElementById('sprite-clone-detail');
            const bubble = document.getElementById('speech-bubble-clone-detail');
            const status = document.getElementById('clone-detail-status');
            
            if (sprite && bubble && status) {
                const clones = document.querySelectorAll('[id^="detail-clone-"]');
                clones.forEach(clone => clone.remove());
                
                sprite.style.left = '50px';
                sprite.style.top = '50px';
                sprite.style.background = '#ff6b6b';
                bubble.style.display = 'none';
                status.textContent = 'クローンの詳しい動作を見てみよう';
            }
        }
        
        // 練習問題1のアニメーション
        function playClonePractice1Animation() {
            console.log('playClonePractice1Animation called');
            const sprite = document.getElementById('sprite-clone-practice1');
            const bubble = document.getElementById('speech-bubble-clone-practice1');
            const status = document.getElementById('clone-practice1-status');
            
            if (!sprite || !bubble || !status) {
                console.error('Practice1 animation elements not found');
                return;
            }
            
            resetClonePractice1Animation();
            
            status.textContent = '🌈 5個の色違いクローンを作成します';
            
            // 5個のクローンを順番に作成
            for (let i = 1; i <= 5; i++) {
                setTimeout(() => {
                    const clone = sprite.cloneNode(true);
                    clone.id = `practice1-clone-${i}`;
                    clone.style.left = (50 + i * 80) + 'px';
                    clone.style.top = '100px';
                    clone.style.filter = `hue-rotate(${i * 60}deg)`;
                    sprite.parentNode.appendChild(clone);
                    
                    status.textContent = `🎉 色違いクローン${i}個目が作成されました！`;
                    
                    // クローンがあいさつ
                    setTimeout(() => {
                        bubble.textContent = `私は色違いです！`;
                        bubble.style.display = 'block';
                        bubble.style.left = (120 + i * 80) + 'px';
                        bubble.style.top = '70px';
                        
                        setTimeout(() => {
                            bubble.style.display = 'none';
                        }, 1000);
                    }, 300);
                }, i * 1200);
            }
            
            setTimeout(() => {
                status.textContent = '✅ 5個の色違いクローンが完成しました！';
            }, 6500);
        }
        
        function resetClonePractice1Animation() {
            console.log('resetClonePractice1Animation called');
            const sprite = document.getElementById('sprite-clone-practice1');
            const bubble = document.getElementById('speech-bubble-clone-practice1');
            const status = document.getElementById('clone-practice1-status');
            
            if (sprite && bubble && status) {
                const clones = document.querySelectorAll('[id^="practice1-clone-"]');
                clones.forEach(clone => clone.remove());
                
                sprite.style.left = '50px';
                sprite.style.top = '100px';
                sprite.style.filter = 'none';
                bubble.style.display = 'none';
                status.textContent = 'カラフルなクローンが作られます';
            }
        }
        
        // 答え表示関数
        function showClonePractice1Answer() {
            document.getElementById('clone-practice1-answer').style.display = 'block';
        }
        
        function resetBasicCloneAnimation() {
            console.log('resetBasicCloneAnimation called');
            basicAnimationInProgress = false;
            
            const sprite = document.getElementById('sprite-clone-basic');
            const bubble = document.getElementById('speech-bubble-clone-basic');
            const status = document.getElementById('clone-basic-status');
            
            console.log('reset elements:', {sprite, bubble, status});
            
            if (!sprite || !bubble || !status) {
                console.error('Required elements not found for reset basic clone animation');
                return;
            }
            
            try {
                // Remove all existing clones safely
                const clones = document.querySelectorAll('[id^="basic-clone-"]');
                console.log('Removing clones:', clones.length);
                clones.forEach((clone, index) => {
                    try {
                        clone.remove();
                        console.log(`Removed clone ${index + 1}`);
                    } catch (removeError) {
                        console.error(`Error removing clone ${index + 1}:`, removeError);
                    }
                });
                
                // Reset sprite safely
                sprite.style.left = '50px';
                sprite.style.top = '50px';
                sprite.style.background = '#ff6b6b';
                sprite.style.transform = 'scale(1)';
                sprite.style.filter = 'none';
                
                // Reset bubble
                bubble.style.display = 'none';
                
                // Reset status
                status.textContent = 'クローンが作られる様子を見てみよう！';
                
                console.log('Basic clone animation reset completed');
                
            } catch (error) {
                console.error('Reset error:', error);
                status.textContent = 'リセット中にエラーが発生しました';
            }
        }
        
        function playCloneMovementAnimation() {
            console.log('playCloneMovementAnimation called');
            const sprite = document.getElementById('sprite-clone-movement');
            const status = document.getElementById('clone-movement-status');
            
            console.log('sprite:', sprite);
            console.log('status:', status);
            
            if (!sprite || !status) {
                console.error('Required elements not found for clone movement animation');
                return;
            }
            
            resetCloneMovementAnimation();
            
            status.textContent = '🏃 動くクローン作成開始...';
            
            // Create 3 moving clones
            for (let i = 1; i <= 3; i++) {
                setTimeout(() => {
                    const clone = sprite.cloneNode(true);
                    clone.id = `moving-clone-${i}`;
                    clone.style.left = '100px';
                    clone.style.top = '100px';
                    clone.style.filter = `hue-rotate(${i * 120}deg)`;
                    sprite.parentNode.appendChild(clone);
                    
                    status.textContent = `🎉 動くクローン${i}個目が作られました！`;
                    
                    // Give each clone a different direction
                    const directions = [45, 135, 225];
                    const direction = directions[i - 1];
                    
                    // Animate the clone movement
                    animateClone(clone, direction, i);
                    
                }, i * 800);
            }
            
            setTimeout(() => {
                status.textContent = '✅ 3個のクローンがそれぞれ違う方向に動いています！';
            }, 3000);
        }
        
        function animateClone(clone, direction, id) {
            const radians = (direction * Math.PI) / 180;
            const speed = 2;
            let x = parseInt(clone.style.left);
            let y = parseInt(clone.style.top);
            
            function moveClone() {
                if (!document.getElementById(`moving-clone-${id}`)) return;
                
                x += Math.cos(radians) * speed;
                y += Math.sin(radians) * speed;
                
                // Bounce off edges
                if (x <= 0 || x >= 300) {
                    x = Math.max(0, Math.min(300, x));
                }
                if (y <= 0 || y >= 200) {
                    y = Math.max(0, Math.min(200, y));
                }
                
                clone.style.left = x + 'px';
                clone.style.top = y + 'px';
                
                setTimeout(moveClone, 50);
            }
            
            moveClone();
        }
        
        function resetCloneMovementAnimation() {
            const sprite = document.getElementById('sprite-clone-movement');
            const status = document.getElementById('clone-movement-status');
            
            // Remove all existing moving clones
            const clones = document.querySelectorAll('[id^="moving-clone-"]');
            clones.forEach(clone => clone.remove());
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.filter = 'none';
            status.textContent = 'クローンが動く様子を見てみよう！';
        }
        
        function playCloneStarsAnimation() {
            console.log('playCloneStarsAnimation called');
            const sprite = document.getElementById('sprite-clone-stars');
            const status = document.getElementById('clone-stars-status');
            
            console.log('sprite:', sprite);
            console.log('status:', status);
            
            if (!sprite || !status) {
                console.error('Required elements not found for clone stars animation');
                return;
            }
            
            resetCloneStarsAnimation();
            
            status.textContent = '⭐ キラキラ星クローン作成中...';
            
            // Create 5 twinkling star clones
            for (let i = 1; i <= 5; i++) {
                setTimeout(() => {
                    const clone = sprite.cloneNode(true);
                    clone.id = `star-clone-${i}`;
                    clone.style.left = Math.random() * 250 + 'px';
                    clone.style.top = Math.random() * 150 + 'px';
                    clone.style.filter = `hue-rotate(${Math.random() * 360}deg)`;
                    sprite.parentNode.appendChild(clone);
                    
                    // Animate twinkling
                    animateStarTwinkle(clone, i);
                    
                }, i * 300);
            }
            
            setTimeout(() => {
                status.textContent = '✨ 星がキラキラと輝いています！';
            }, 2000);
        }
        
        function animateStarTwinkle(star, id) {
            let growing = true;
            let scale = 1;
            
            function twinkle() {
                if (!document.getElementById(`star-clone-${id}`)) return;
                
                if (growing) {
                    scale += 0.05;
                    if (scale >= 1.5) growing = false;
                } else {
                    scale -= 0.05;
                    if (scale <= 0.5) growing = true;
                }
                
                star.style.transform = `scale(${scale})`;
                setTimeout(twinkle, 100);
            }
            
            twinkle();
        }
        
        function resetCloneStarsAnimation() {
            const sprite = document.getElementById('sprite-clone-stars');
            const status = document.getElementById('clone-stars-status');
            
            // Remove all existing star clones
            const clones = document.querySelectorAll('[id^="star-clone-"]');
            clones.forEach(clone => clone.remove());
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.filter = 'none';
            sprite.style.transform = 'scale(1)';
            status.textContent = '星がキラキラと輝きます';
        }
        
        function playCloneFormationAnimation() {
            console.log('playCloneFormationAnimation called');
            const sprite = document.getElementById('sprite-clone-formation');
            const status = document.getElementById('clone-formation-status');
            
            console.log('sprite:', sprite);
            console.log('status:', status);
            
            if (!sprite || !status) {
                console.error('Required elements not found for clone formation animation');
                return;
            }
            
            resetCloneFormationAnimation();
            
            status.textContent = '🌀 フォーメーション移動開始...';
            
            // Create 5 clones in formation
            for (let i = 1; i <= 5; i++) {
                setTimeout(() => {
                    const clone = sprite.cloneNode(true);
                    clone.id = `formation-clone-${i}`;
                    
                    const angle = (i - 1) * 72; // 360/5 = 72 degrees apart
                    const radius = 80;
                    const centerX = 150;
                    const centerY = 100;
                    
                    const x = centerX + Math.cos(angle * Math.PI / 180) * radius;
                    const y = centerY + Math.sin(angle * Math.PI / 180) * radius;
                    
                    clone.style.left = x + 'px';
                    clone.style.top = y + 'px';
                    clone.style.filter = `hue-rotate(${i * 72}deg)`;
                    sprite.parentNode.appendChild(clone);
                    
                    // Start rotation animation
                    animateFormationRotation(clone, angle, i);
                    
                }, i * 200);
            }
            
            setTimeout(() => {
                status.textContent = '🎉 5つのクローンが円形フォーメーションで回転しています！';
            }, 1500);
        }
        
        function animateFormationRotation(clone, startAngle, id) {
            let currentAngle = startAngle;
            const radius = 80;
            const centerX = 150;
            const centerY = 100;
            
            function rotate() {
                if (!document.getElementById(`formation-clone-${id}`)) return;
                
                currentAngle += 2; // Rotate 2 degrees per frame
                
                const x = centerX + Math.cos(currentAngle * Math.PI / 180) * radius;
                const y = centerY + Math.sin(currentAngle * Math.PI / 180) * radius;
                
                clone.style.left = x + 'px';
                clone.style.top = y + 'px';
                
                setTimeout(rotate, 50);
            }
            
            rotate();
        }
        
        function resetCloneFormationAnimation() {
            const sprite = document.getElementById('sprite-clone-formation');
            const status = document.getElementById('clone-formation-status');
            
            // Remove all existing formation clones
            const clones = document.querySelectorAll('[id^="formation-clone-"]');
            clones.forEach(clone => clone.remove());
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.filter = 'none';
            status.textContent = 'みんなで一緒に回転します';
        }
        
        // Answer display functions
        function showCloneMovementAnswer1() {
            document.getElementById('clone-movement-answer1').style.display = 'block';
            document.getElementById('cloneMovementAnswerBtn1').disabled = true;
            document.getElementById('cloneMovementAnswerBtn1').textContent = '✅ 答えを表示中';
        }
        
        function showCloneMovementAnswer2() {
            document.getElementById('clone-movement-answer2').style.display = 'block';
            document.getElementById('cloneMovementAnswerBtn2').disabled = true;
            document.getElementById('cloneMovementAnswerBtn2').textContent = '✅ 答えを表示中';
        }
        
        // Clone deletion section navigation
        let currentCloneDeletionStep = 1;
        
        function changeCloneDeletionStep(direction) {
            currentCloneDeletionStep += direction;
            if (currentCloneDeletionStep < 1) currentCloneDeletionStep = 1;
            if (currentCloneDeletionStep > 4) currentCloneDeletionStep = 4;
            updateCloneDeletionStep();
            setTimeout(renderBlocks, 100);
        }
        
        function updateCloneDeletionStep() {
            // Hide all steps
            document.querySelectorAll('#clone-deletion-section .step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            
            // Show current step
            document.getElementById('clone-deletion-step' + currentCloneDeletionStep).classList.add('step-active');
            
            // Update title and progress
            document.getElementById('clone-deletion-step-title').textContent = `ステップ ${currentCloneDeletionStep} / 4`;
            document.getElementById('clone-deletion-progress').style.width = (currentCloneDeletionStep / 4 * 100) + '%';
            
            // Update buttons
            document.getElementById('cloneDeletionPrevBtn').disabled = currentCloneDeletionStep === 1;
            document.getElementById('cloneDeletionNextBtn').disabled = currentCloneDeletionStep === 4;
            document.getElementById('cloneDeletionNextBtn').textContent = currentCloneDeletionStep === 4 ? '完了' : '次へ';
        }
        
        // Clone deletion animations
        function playCloneDeletionAnimation() {
            console.log('playCloneDeletionAnimation called');
            const sprite = document.getElementById('sprite-clone-deletion');
            const status = document.getElementById('clone-deletion-status');
            
            console.log('sprite:', sprite);
            console.log('status:', status);
            
            if (!sprite || !status) {
                console.error('Required elements not found for clone deletion animation');
                return;
            }
            
            resetCloneDeletionAnimation();
            
            status.textContent = '🗑️ クローン削除デモ開始...';
            
            // Create 5 clones that will be deleted
            for (let i = 1; i <= 5; i++) {
                setTimeout(() => {
                    const clone = sprite.cloneNode(true);
                    clone.id = `deletion-clone-${i}`;
                    clone.style.left = (50 + i * 60) + 'px';
                    clone.style.top = (50 + (i % 2) * 40) + 'px';
                    clone.style.filter = `hue-rotate(${i * 72}deg)`;
                    sprite.parentNode.appendChild(clone);
                    
                    status.textContent = `🎉 クローン${i}個目が作られました`;
                    
                    // Schedule deletion after 3 seconds
                    setTimeout(() => {
                        if (document.getElementById(`deletion-clone-${i}`)) {
                            status.textContent = `🗑️ クローン${i}を削除中...`;
                            
                            // Fade out effect
                            let opacity = 1;
                            const fadeInterval = setInterval(() => {
                                opacity -= 0.1;
                                clone.style.opacity = opacity;
                                
                                if (opacity <= 0) {
                                    clearInterval(fadeInterval);
                                    clone.remove();
                                    status.textContent = `✅ クローン${i}が削除されました`;
                                }
                            }, 100);
                        }
                    }, 3000 + i * 500);
                    
                }, i * 800);
            }
            
            setTimeout(() => {
                status.textContent = '✅ すべてのクローンが時間制限で削除されました！';
            }, 8000);
        }
        
        function resetCloneDeletionAnimation() {
            const sprite = document.getElementById('sprite-clone-deletion');
            const status = document.getElementById('clone-deletion-status');
            
            // Remove all existing deletion clones
            const clones = document.querySelectorAll('[id^="deletion-clone-"]');
            clones.forEach(clone => clone.remove());
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.filter = 'none';
            sprite.style.opacity = '1';
            status.textContent = 'クローンが削除される様子を見てみよう！';
        }
        
        function playCloneTimerAnimation() {
            console.log('playCloneTimerAnimation called');
            const sprite = document.getElementById('sprite-clone-timer');
            const bubble = document.getElementById('speech-bubble-clone-timer');
            const status = document.getElementById('clone-timer-status');
            
            console.log('sprite:', sprite);
            console.log('bubble:', bubble);
            console.log('status:', status);
            
            if (!sprite || !bubble || !status) {
                console.error('Required elements not found for clone timer animation');
                return;
            }
            
            resetCloneTimerAnimation();
            
            status.textContent = '⏰ 時間制限クローン作成中...';
            
            // Create 3 timer clones
            for (let i = 1; i <= 3; i++) {
                setTimeout(() => {
                    const clone = sprite.cloneNode(true);
                    clone.id = `timer-clone-${i}`;
                    clone.style.left = (80 + i * 100) + 'px';
                    clone.style.top = (60 + i * 20) + 'px';
                    clone.style.filter = `hue-rotate(${i * 120}deg)`;
                    sprite.parentNode.appendChild(clone);
                    
                    status.textContent = `🚀 時間制限クローン${i}が作られました`;
                    
                    // Start countdown and deletion
                    setTimeout(() => {
                        animateCloneTimer(clone, i);
                    }, 1000);
                    
                }, i * 1000);
            }
        }
        
        function animateCloneTimer(clone, id) {
            const bubble = document.getElementById('speech-bubble-clone-timer');
            const status = document.getElementById('clone-timer-status');
            
            let timeLeft = 5;
            
            const countdown = setInterval(() => {
                if (!document.getElementById(`timer-clone-${id}`)) {
                    clearInterval(countdown);
                    return;
                }
                
                status.textContent = `⏰ クローン${id}: あと${timeLeft}秒で削除`;
                
                // Gradually fade the clone
                const opacity = timeLeft / 5;
                clone.style.opacity = opacity;
                
                timeLeft--;
                
                if (timeLeft < 0) {
                    clearInterval(countdown);
                    
                    // Show goodbye message
                    bubble.textContent = 'さようなら！';
                    bubble.style.display = 'block';
                    bubble.style.left = clone.style.left;
                    bubble.style.top = (parseInt(clone.style.top) - 30) + 'px';
                    
                    setTimeout(() => {
                        clone.style.opacity = '0';
                        bubble.style.display = 'none';
                        
                        setTimeout(() => {
                            clone.remove();
                            status.textContent = `✅ クローン${id}が時間制限で削除されました`;
                        }, 500);
                    }, 1000);
                }
            }, 1000);
        }
        
        function resetCloneTimerAnimation() {
            const sprite = document.getElementById('sprite-clone-timer');
            const bubble = document.getElementById('speech-bubble-clone-timer');
            const status = document.getElementById('clone-timer-status');
            
            // Remove all existing timer clones
            const clones = document.querySelectorAll('[id^="timer-clone-"]');
            clones.forEach(clone => clone.remove());
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.filter = 'none';
            sprite.style.opacity = '1';
            bubble.style.display = 'none';
            status.textContent = '時間が経つとクローンが消えます';
        }
        
        function playCloneClickAnimation() {
            console.log('playCloneClickAnimation called');
            const sprite = document.getElementById('sprite-clone-click');
            const bubble = document.getElementById('speech-bubble-clone-click');
            const status = document.getElementById('clone-click-status');
            
            console.log('sprite:', sprite);
            console.log('bubble:', bubble);
            console.log('status:', status);
            
            if (!sprite || !bubble || !status) {
                console.error('Required elements not found for clone click animation');
                return;
            }
            
            resetCloneClickAnimation();
            
            status.textContent = '🎯 クリック削除ゲーム開始！';
            
            // Create 5 clickable target clones
            for (let i = 1; i <= 5; i++) {
                setTimeout(() => {
                    const clone = sprite.cloneNode(true);
                    clone.id = `click-clone-${i}`;
                    clone.style.left = (Math.random() * 200 + 50) + 'px';
                    clone.style.top = (Math.random() * 100 + 50) + 'px';
                    clone.style.filter = `hue-rotate(${i * 72}deg)`;
                    clone.style.cursor = 'pointer';
                    sprite.parentNode.appendChild(clone);
                    
                    // Add click event to delete clone
                    clone.addEventListener('click', function() {
                        bubble.textContent = 'ヒット！';
                        bubble.style.display = 'block';
                        bubble.style.left = clone.style.left;
                        bubble.style.top = (parseInt(clone.style.top) - 30) + 'px';
                        
                        // Spin and shrink effect
                        let rotation = 0;
                        let scale = 1;
                        const deleteEffect = setInterval(() => {
                            rotation += 45;
                            scale -= 0.1;
                            clone.style.transform = `rotate(${rotation}deg) scale(${scale})`;
                            
                            if (scale <= 0) {
                                clearInterval(deleteEffect);
                                clone.remove();
                                bubble.style.display = 'none';
                                
                                const remaining = document.querySelectorAll('[id^="click-clone-"]').length;
                                if (remaining === 0) {
                                    status.textContent = '🎉 すべてのターゲットを削除しました！クリア！';
                                } else {
                                    status.textContent = `✅ ターゲット削除！残り${remaining}個`;
                                }
                            }
                        }, 100);
                    });
                    
                    status.textContent = `🎯 ターゲット${i}を配置しました`;
                    
                }, i * 400);
            }
            
            setTimeout(() => {
                status.textContent = '🎯 ターゲットをクリックして削除しよう！';
            }, 2500);
        }
        
        function resetCloneClickAnimation() {
            const sprite = document.getElementById('sprite-clone-click');
            const bubble = document.getElementById('speech-bubble-clone-click');
            const status = document.getElementById('clone-click-status');
            
            // Remove all existing click clones
            const clones = document.querySelectorAll('[id^="click-clone-"]');
            clones.forEach(clone => clone.remove());
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.filter = 'none';
            sprite.style.transform = 'scale(1)';
            bubble.style.display = 'none';
            status.textContent = '的をクリックして削除しよう';
        }
        
        // Clone deletion answer functions
        function showCloneDeletionAnswer1() {
            document.getElementById('clone-deletion-answer1').style.display = 'block';
            document.getElementById('cloneDeletionAnswerBtn1').disabled = true;
            document.getElementById('cloneDeletionAnswerBtn1').textContent = '✅ 答えを表示中';
        }
        
        function showCloneDeletionAnswer2() {
            document.getElementById('clone-deletion-answer2').style.display = 'block';
            document.getElementById('cloneDeletionAnswerBtn2').disabled = true;
            document.getElementById('cloneDeletionAnswerBtn2').textContent = '✅ 答えを表示中';
        }
        
        // Clone applications section navigation
        let currentCloneApplicationsStep = 1;
        
        function changeCloneApplicationsStep(direction) {
            currentCloneApplicationsStep += direction;
            if (currentCloneApplicationsStep < 1) currentCloneApplicationsStep = 1;
            if (currentCloneApplicationsStep > 4) currentCloneApplicationsStep = 4;
            updateCloneApplicationsStep();
            setTimeout(renderBlocks, 100);
        }
        
        function updateCloneApplicationsStep() {
            // Hide all steps
            document.querySelectorAll('#clone-applications-section .step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            
            // Show current step
            document.getElementById('clone-applications-step' + currentCloneApplicationsStep).classList.add('step-active');
            
            // Update title and progress
            document.getElementById('clone-applications-step-title').textContent = `ステップ ${currentCloneApplicationsStep} / 4`;
            document.getElementById('clone-applications-progress').style.width = (currentCloneApplicationsStep / 4 * 100) + '%';
            
            // Update buttons
            document.getElementById('cloneApplicationsPrevBtn').disabled = currentCloneApplicationsStep === 1;
            document.getElementById('cloneApplicationsNextBtn').disabled = currentCloneApplicationsStep === 4;
            document.getElementById('cloneApplicationsNextBtn').textContent = currentCloneApplicationsStep === 4 ? '完了' : '次へ';
        }
        
        // Clone applications animations
        // 星空アニメーション - 安全版
        let starfieldAnimationInProgress = false;

        function startStarfieldAnimation() {
            if (starfieldAnimationInProgress) return;
            
            console.log('startStarfieldAnimation called');
            starfieldAnimationInProgress = true;
            
            const sprite = document.getElementById('sprite-starfield');
            const status = document.getElementById('starfield-status');
            const stage = sprite ? sprite.parentNode : null;
            
            console.log('Starfield elements:', {sprite, status, stage});
            
            if (!sprite || !status || !stage) {
                console.error('Required elements not found for starfield animation');
                status && (status.textContent = 'エラー: 要素が見つかりません');
                starfieldAnimationInProgress = false;
                return;
            }

            resetStarfieldAnimation();
            status.textContent = '✨ 美しい星空を作成中...';
            
            // Create 10 stars sequentially
            createStarSequence(1, sprite, status, stage);
        }

        function createStarSequence(starNumber, sprite, status, stage) {
            if (starNumber > 10) {
                status.textContent = '🌟 美しい星空が完成しました！';
                starfieldAnimationInProgress = false;
                return;
            }

            try {
                console.log(`Creating star ${starNumber}`);
                
                const star = sprite.cloneNode(true);
                star.id = `starfield-star-${starNumber}`;
                star.style.left = (Math.random() * 350) + 'px';
                star.style.top = (Math.random() * 200) + 'px';
                star.style.background = `hsl(${Math.random() * 60 + 40}, 80%, 70%)`;
                star.style.transform = 'scale(0)';
                star.style.position = 'absolute';
                star.style.display = 'flex';
                
                stage.appendChild(star);
                
                // Animation effect
                setTimeout(() => {
                    star.style.transform = `scale(${0.5 + Math.random() * 0.8})`;
                }, 100);
                
                status.textContent = `⭐ 星${starNumber}個目を配置...`;
                
                // Create next star
                setTimeout(() => {
                    createStarSequence(starNumber + 1, sprite, status, stage);
                }, 200);
                
            } catch (error) {
                console.error(`Error creating star ${starNumber}:`, error);
                status.textContent = `エラー: 星${starNumber}の作成に失敗しました`;
                starfieldAnimationInProgress = false;
            }
        }

        // 古い関数名との互換性を保つ
        function playStarfieldAnimation() {
            startStarfieldAnimation();
        }
        
        function resetStarfieldAnimation() {
            console.log('resetStarfieldAnimation called');
            starfieldAnimationInProgress = false;
            
            const sprite = document.getElementById('sprite-starfield');
            const status = document.getElementById('starfield-status');
            
            if (!sprite || !status) {
                console.error('Required elements not found for starfield reset');
                return;
            }
            
            try {
                // Remove all existing starfield stars
                const stars = document.querySelectorAll('[id^="starfield-star-"]');
                console.log('Removing stars:', stars.length);
                stars.forEach((star, index) => {
                    try {
                        star.remove();
                        console.log(`Removed star ${index + 1}`);
                    } catch (removeError) {
                        console.error(`Error removing star ${index + 1}:`, removeError);
                    }
                });
                
                // Reset sprite
                sprite.style.left = '150px';
                sprite.style.top = '120px';
                sprite.style.background = '#ff6b6b';
                sprite.style.transform = 'scale(1)';
                sprite.style.filter = 'none';
                sprite.textContent = '⭐';
                
                status.textContent = '美しい星空を作ってみよう！';
                
                console.log('Starfield animation reset completed');
                
            } catch (error) {
                console.error('Starfield reset error:', error);
                status.textContent = 'リセット中にエラーが発生しました';
            }
        }
        
        function playFireworksAnimation() {
            console.log('playFireworksAnimation called');
            const sprite = document.getElementById('sprite-fireworks');
            const status = document.getElementById('fireworks-status');
            
            console.log('sprite:', sprite);
            console.log('status:', status);
            
            if (!sprite || !status) {
                console.error('Required elements not found for fireworks animation');
                return;
            }
            
            resetFireworksAnimation();
            
            status.textContent = '🎆 花火打ち上げ開始...';
            
            // Launch 3 fireworks with delay
            for (let firework = 1; firework <= 3; firework++) {
                setTimeout(() => {
                    const fireworkX = Math.random() * 200 + 50;
                    const fireworkY = Math.random() * 100 + 80;
                    
                    status.textContent = `🚀 花火${firework}発射！`;
                    
                    // Create firework burst
                    for (let spark = 1; spark <= 12; spark++) {
                        setTimeout(() => {
                            const sparkClone = sprite.cloneNode(true);
                            sparkClone.id = `firework-${firework}-spark-${spark}`;
                            sparkClone.style.left = fireworkX + 'px';
                            sparkClone.style.top = fireworkY + 'px';
                            sparkClone.style.filter = `hue-rotate(${firework * 120 + spark * 30}deg)`;
                            sprite.parentNode.appendChild(sparkClone);
                            
                            // Animate spark explosion
                            const angle = (spark - 1) * 30; // 30 degrees apart
                            animateFireworkSpark(sparkClone, angle, firework, spark);
                            
                        }, spark * 50);
                    }
                    
                    setTimeout(() => {
                        status.textContent = `🎆 花火${firework}爆発完了！`;
                    }, 1000);
                    
                }, firework * 2000);
            }
            
            setTimeout(() => {
                status.textContent = '🎊 花火ショー完了！素晴らしい！';
            }, 7000);
        }
        
        function animateFireworkSpark(spark, angle, fireworkId, sparkId) {
            const radians = angle * Math.PI / 180;
            const speed = 3;
            let distance = 0;
            const maxDistance = 60;
            let opacity = 1;
            
            const sparkAnimation = setInterval(() => {
                if (!document.getElementById(`firework-${fireworkId}-spark-${sparkId}`)) {
                    clearInterval(sparkAnimation);
                    return;
                }
                
                distance += speed;
                opacity -= 0.02;
                
                const x = parseInt(spark.style.left) + Math.cos(radians) * distance;
                const y = parseInt(spark.style.top) + Math.sin(radians) * distance;
                
                spark.style.left = x + 'px';
                spark.style.top = y + 'px';
                spark.style.opacity = opacity;
                
                if (distance >= maxDistance || opacity <= 0) {
                    clearInterval(sparkAnimation);
                    spark.remove();
                }
            }, 50);
        }
        
        function resetFireworksAnimation() {
            const sprite = document.getElementById('sprite-fireworks');
            const status = document.getElementById('fireworks-status');
            
            // Remove all existing firework sparks
            const sparks = document.querySelectorAll('[id^="firework-"]');
            sparks.forEach(spark => spark.remove());
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.filter = 'none';
            sprite.style.opacity = '1';
            status.textContent = '花火が爆発する瞬間を見よう！';
        }
        
        function playRainAnimation() {
            console.log('playRainAnimation called');
            const sprite = document.getElementById('sprite-rain');
            const status = document.getElementById('rain-status');
            
            console.log('sprite:', sprite);
            console.log('status:', status);
            
            if (!sprite || !status) {
                console.error('Required elements not found for rain animation');
                return;
            }
            
            resetRainAnimation();
            
            status.textContent = '🌧️ 雨が降り始めました...';
            
            let rainDropCount = 0;
            const rainInterval = setInterval(() => {
                if (rainDropCount >= 15) {
                    clearInterval(rainInterval);
                    status.textContent = '☔ 雨がたくさん降っています！';
                    return;
                }
                
                const rainDrop = sprite.cloneNode(true);
                rainDrop.id = `rain-drop-${rainDropCount}`;
                rainDrop.style.left = (Math.random() * 280 + 10) + 'px';
                rainDrop.style.top = '10px';
                rainDrop.style.filter = `hue-rotate(${Math.random() * 60 + 180}deg)`;
                sprite.parentNode.appendChild(rainDrop);
                
                // Animate rain drop falling
                animateRainDrop(rainDrop, rainDropCount);
                
                rainDropCount++;
            }, 300);
        }
        
        function animateRainDrop(rainDrop, id) {
            let y = 10;
            const fallSpeed = 4;
            
            const fallAnimation = setInterval(() => {
                if (!document.getElementById(`rain-drop-${id}`)) {
                    clearInterval(fallAnimation);
                    return;
                }
                
                y += fallSpeed;
                rainDrop.style.top = y + 'px';
                
                // Remove when hitting ground
                if (y >= 190) {
                    clearInterval(fallAnimation);
                    rainDrop.remove();
                }
            }, 50);
        }
        
        function resetRainAnimation() {
            const sprite = document.getElementById('sprite-rain');
            const status = document.getElementById('rain-status');
            
            // Remove all existing rain drops
            const drops = document.querySelectorAll('[id^="rain-drop-"]');
            drops.forEach(drop => drop.remove());
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.filter = 'none';
            status.textContent = '雨が降る様子を見てみよう';
        }
        
        function playBulletAnimation() {
            console.log('playBulletAnimation called');
            const sprite = document.getElementById('sprite-bullet');
            const status = document.getElementById('bullet-status');
            
            console.log('sprite:', sprite);
            console.log('status:', status);
            
            if (!sprite || !status) {
                console.error('Required elements not found for bullet animation');
                return;
            }
            
            resetBulletAnimation();
            
            status.textContent = '🚀 弾丸発射システム起動！';
            
            // Simulate automatic bullet firing
            let bulletCount = 0;
            const bulletInterval = setInterval(() => {
                if (bulletCount >= 8) {
                    clearInterval(bulletInterval);
                    status.textContent = '✅ 弾丸システムデモ完了！';
                    return;
                }
                
                const bullet = sprite.cloneNode(true);
                bullet.id = `bullet-${bulletCount}`;
                bullet.style.left = '150px'; // Center position
                bullet.style.top = '150px'; // Starting position
                bullet.style.filter = `hue-rotate(${bulletCount * 45}deg)`;
                sprite.parentNode.appendChild(bullet);
                
                // Animate bullet flying upward
                animateBulletFlight(bullet, bulletCount);
                
                bulletCount++;
                status.textContent = `🎯 弾丸${bulletCount}発射！`;
            }, 400);
        }
        
        function animateBulletFlight(bullet, id) {
            let y = 150;
            const speed = 8;
            
            const flightAnimation = setInterval(() => {
                if (!document.getElementById(`bullet-${id}`)) {
                    clearInterval(flightAnimation);
                    return;
                }
                
                y -= speed;
                bullet.style.top = y + 'px';
                
                // Remove when reaching top
                if (y <= -20) {
                    clearInterval(flightAnimation);
                    bullet.remove();
                }
            }, 50);
        }
        
        function resetBulletAnimation() {
            const sprite = document.getElementById('sprite-bullet');
            const status = document.getElementById('bullet-status');
            
            // Remove all existing bullets
            const bullets = document.querySelectorAll('[id^="bullet-"]');
            bullets.forEach(bullet => bullet.remove());
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.filter = 'none';
            status.textContent = 'スペースキーで弾丸を撃とう';
        }
        
        // Clone applications answer functions
        function showCloneApplicationsAnswer1() {
            document.getElementById('clone-applications-answer1').style.display = 'block';
            document.getElementById('cloneApplicationsAnswerBtn1').disabled = true;
            document.getElementById('cloneApplicationsAnswerBtn1').textContent = '✅ 答えを表示中';
        }
        
        function showCloneApplicationsAnswer2() {
            document.getElementById('clone-applications-answer2').style.display = 'block';
            document.getElementById('cloneApplicationsAnswerBtn2').disabled = true;
            document.getElementById('cloneApplicationsAnswerBtn2').textContent = '✅ 答えを表示中';
        }
        
        // Force override any cached functions
        window.hideAllViews = function() {
            console.log('=== FORCE OVERRIDE hideAllViews called - V2.0 ===');
            const elements = [
                'home-view',
                'variables-menu', 
                'health-system',
                'score-system',
                'string-variables',
                'conditional-menu',
                'if-then-section',
                'if-else-section',
                'loop',
                'clones-menu',
                'basic-clone-section',
                'clone-movement-section',
                'clone-deletion-section',
                'clone-applications-section'
            ];
            
            elements.forEach(id => {
                try {
                    const element = document.getElementById(id);
                    if (element) {
                        element.style.display = 'none';
                    }
                } catch (error) {
                    console.error('Error hiding element:', id, error);
                }
            });
            console.log('=== FORCE OVERRIDE hideAllViews completed - V2.0 ===');
        };

        // Force override showClonesMenu
        window.showClonesMenu = function() {
            console.log('=== FORCE OVERRIDE showClonesMenu called - V2.0 ===');
            window.hideAllViews();
            const clonesMenu = document.getElementById('clones-menu');
            if (clonesMenu) {
                clonesMenu.style.display = 'block';
                console.log('clones-menu display set to block');
            } else {
                console.error('clones-menu element not found');
            }
        };

        // Start loading when page loads
        window.addEventListener('load', function() {
            console.log('=== NEW VERSION LOADED - V2.0 ===');
            initializeBlocks();
            
            // Debug: Check if clone elements exist
            console.log('Page loaded, checking elements...');
            const clonesMenu = document.getElementById('clones-menu');
            console.log('clones-menu element:', clonesMenu);
            console.log('clones-menu display:', clonesMenu ? clonesMenu.style.display : 'element not found');
        });
    </script>
    
    <!-- FORCE OVERRIDE SCRIPT TO FIX CACHE ISSUES -->
    <script>
        console.log('=== EMERGENCY OVERRIDE SCRIPT LOADED ===');
        
        // Force override the problematic functions
        window.hideAllViews = function() {
            console.log('=== EMERGENCY OVERRIDE hideAllViews called ===');
            const elements = [
                'home-view',
                'variables-menu', 
                'health-system',
                'score-system',
                'string-variables',
                'conditional-menu',
                'if-then-section',
                'if-else-section',
                'loop',
                'clones-menu',
                'basic-clone-section',
                'clone-movement-section',
                'clone-deletion-section',
                'clone-applications-section'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                }
            });
            console.log('=== EMERGENCY OVERRIDE hideAllViews completed ===');
        };
        
        window.showClonesMenu = function() {
            console.log('=== EMERGENCY OVERRIDE showClonesMenu called ===');
            window.hideAllViews();
            const clonesMenu = document.getElementById('clones-menu');
            if (clonesMenu) {
                clonesMenu.style.display = 'block';
                console.log('clones-menu display set to block');
            } else {
                console.error('clones-menu element not found');
            }
        };
        
        // Override all animation functions with error handling
        window.playBasicCloneAnimation = function() {
            console.log('=== EMERGENCY OVERRIDE playBasicCloneAnimation called ===');
            const sprite = document.getElementById('sprite-clone-basic');
            const bubble = document.getElementById('speech-bubble-clone-basic');
            const status = document.getElementById('clone-basic-status');
            
            if (!sprite || !bubble || !status) {
                console.error('Required elements not found for basic clone animation');
                alert('アニメーション要素が見つかりません。ページをリロードしてください。');
                return;
            }
            
            // Reset first
            const clones = document.querySelectorAll('[id^="clone-"]');
            clones.forEach(clone => clone.remove());
            
            sprite.style.left = '50px';
            sprite.style.top = '50px';
            sprite.style.filter = 'none';
            bubble.style.display = 'none';
            status.textContent = 'クローンが作られる様子を見てみよう！';
            
            // Start animation
            status.textContent = '🧬 クローン作成開始...';
            
            // Create 3 clones with delay
            for (let i = 1; i <= 3; i++) {
                setTimeout(() => {
                    const clone = sprite.cloneNode(true);
                    clone.id = `clone-${i}`;
                    clone.style.left = (50 + i * 80) + 'px';
                    clone.style.top = (50 + i * 20) + 'px';
                    clone.style.filter = `hue-rotate(${i * 60}deg)`;
                    sprite.parentNode.appendChild(clone);
                    
                    status.textContent = `🎉 クローン${i}個目が作られました！`;
                    
                    // Make clone say hello
                    setTimeout(() => {
                        if (document.getElementById(`clone-${i}`)) {
                            bubble.textContent = `こんにちは！クローン${i}です`;
                            bubble.style.display = 'block';
                            bubble.style.left = (150 + i * 80) + 'px';
                            bubble.style.top = (20 + i * 20) + 'px';
                        }
                    }, 500);
                    
                    setTimeout(() => {
                        bubble.style.display = 'none';
                    }, 1500);
                    
                }, i * 1000);
            }
            
            setTimeout(() => {
                status.textContent = '✅ 3個のクローンが作成完了！それぞれが独立して存在しています。';
            }, 4000);
        };
        
        // Costumes section functions - 見た目の変更機能
        let currentCostumesStep = 1;

        function updateCostumesStep() {
            // Hide all steps
            document.querySelectorAll('#costumes-section .step-container').forEach(step => {
                step.classList.remove('step-active');
            });
            
            // Show current step
            document.getElementById('costumes-step' + currentCostumesStep).classList.add('step-active');
            
            // Update title and progress
            document.getElementById('costumes-step-title').textContent = `ステップ ${currentCostumesStep} / 4`;
            document.getElementById('costumes-progress').style.width = (currentCostumesStep / 4 * 100) + '%';
            
            // Update buttons
            document.getElementById('costumesPrevBtn').disabled = currentCostumesStep === 1;
            document.getElementById('costumesNextBtn').disabled = currentCostumesStep === 4;
            document.getElementById('costumesNextBtn').textContent = currentCostumesStep === 4 ? '完了' : '次へ';
        }

        function changeCostumesStep(direction) {
            currentCostumesStep += direction;
            if (currentCostumesStep < 1) currentCostumesStep = 1;
            if (currentCostumesStep > 4) currentCostumesStep = 4;
            updateCostumesStep();
            setTimeout(renderBlocks, 100);
        }

        function playCostumesAnimation() {
            const sprite = document.getElementById('sprite-costumes');
            const bubble = document.getElementById('speech-bubble-costumes');
            const status = document.getElementById('costumes-status');
            
            if (!sprite || !bubble || !status) {
                console.error('Costumes animation elements not found');
                return;
            }
            
            resetCostumesAnimation();
            
            setTimeout(() => {
                status.textContent = '💬 変身します！';
                bubble.textContent = '変身します！';
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
            }, 500);
            
            setTimeout(() => {
                bubble.style.display = 'none';
                status.textContent = '🎭 コスチューム変更中...';
                sprite.textContent = '🦄'; // 猫からユニコーンに変身
            }, 1500);
            
            setTimeout(() => {
                status.textContent = '🌈 色の効果を追加中...';
                sprite.style.filter = 'hue-rotate(60deg)';
            }, 3000);
            
            setTimeout(() => {
                status.textContent = '✨ さらに色を変えています...';
                sprite.style.filter = 'hue-rotate(120deg)';
            }, 4000);
            
            setTimeout(() => {
                bubble.textContent = '変身完了！';
                bubble.style.display = 'block';
                bubble.style.left = '100px';
                bubble.style.top = '20px';
                status.textContent = '🎉 見た目の変更が完了しました！';
            }, 5000);
            
            setTimeout(() => {
                bubble.style.display = 'none';
            }, 7000);
        }

        function resetCostumesAnimation() {
            const sprite = document.getElementById('sprite-costumes');
            const bubble = document.getElementById('speech-bubble-costumes');
            const status = document.getElementById('costumes-status');
            
            if (sprite && bubble && status) {
                sprite.textContent = '😸';
                sprite.style.filter = 'none';
                bubble.style.display = 'none';
                status.textContent = 'コスチュームと色の効果のデモを見よう！';
            }
        }

        function playEffectsAnimation() {
            const sprite = document.getElementById('sprite-effects');
            const status = document.getElementById('effects-status');
            
            if (!sprite || !status) {
                console.error('Effects animation elements not found');
                return;
            }
            
            resetEffectsAnimation();
            
            let colorValue = 0;
            const interval = setInterval(() => {
                colorValue += 30;
                sprite.style.filter = `hue-rotate(${colorValue}deg)`;
                status.textContent = `🌈 色の効果: ${colorValue}`;
                
                if (colorValue >= 180) {
                    clearInterval(interval);
                    status.textContent = '✅ 色の効果のアニメーション完了！';
                }
            }, 500);
        }

        function resetEffectsAnimation() {
            const sprite = document.getElementById('sprite-effects');
            const status = document.getElementById('effects-status');
            
            if (sprite && status) {
                sprite.style.filter = 'none';
                status.textContent = '色の効果が段階的に変わります';
            }
        }

        function playRainbowAnimation() {
            const sprite = document.getElementById('sprite-rainbow');
            const status = document.getElementById('rainbow-status');
            
            if (!sprite || !status) {
                console.error('Rainbow animation elements not found');
                return;
            }
            
            resetRainbowAnimation();
            
            let step = 0;
            const steps = 6;
            const colors = [0, 60, 120, 180, 240, 300];
            
            const rainbowInterval = setInterval(() => {
                sprite.style.filter = `hue-rotate(${colors[step]}deg)`;
                status.textContent = `🌈 ステップ ${step + 1}/${steps}: 色 ${colors[step]}度`;
                
                step++;
                if (step >= steps) {
                    clearInterval(rainbowInterval);
                    setTimeout(() => {
                        sprite.style.filter = 'none';
                        status.textContent = '🎉 レインボー効果完了！元の色に戻しました。';
                    }, 1000);
                }
            }, 800);
        }

        function resetRainbowAnimation() {
            const sprite = document.getElementById('sprite-rainbow');
            const status = document.getElementById('rainbow-status');
            
            if (sprite && status) {
                sprite.style.filter = 'none';
                status.textContent = '6回繰り返して虹色に変化します';
            }
        }

        function showCostumesAnswer() {
            document.getElementById('costumes-answer').style.display = 'block';
            document.querySelector('.answer-btn').disabled = true;
            document.querySelector('.answer-btn').textContent = '✅ 答えを表示中';
        }

        // hideAllViews を更新して costumes-section を含める
        const originalHideAllViews = hideAllViews;
        hideAllViews = function() {
            originalHideAllViews();
            const costumesSection = document.getElementById('costumes-section');
            if (costumesSection) {
                costumesSection.style.display = 'none';
            }
        };

        // 新機能のメニュー表示関数
        function showSoundsMenu() {
            hideAllViews();
            document.getElementById('sounds-menu').style.display = 'block';
            updateProgress('sounds-menu', 0);
        }

        function showMessagesMenu() {
            hideAllViews();
            document.getElementById('messages-menu').style.display = 'block';
            updateProgress('messages-menu', 0);
        }

        function showBackgroundsMenu() {
            hideAllViews();
            document.getElementById('backgrounds-menu').style.display = 'block';
            updateProgress('backgrounds-menu', 0);
        }

        function showListsMenu() {
            hideAllViews();
            document.getElementById('lists-menu').style.display = 'block';
            updateProgress('lists-menu', 0);
        }

        function showPenMenu() {
            hideAllViews();
            document.getElementById('pen-menu').style.display = 'block';
            updateProgress('pen-menu', 0);
        }

        // 音楽機能の個別レッスン関数
        function showBasicSounds() {
            alert('🔊 基本的な音\n\n・「音を鳴らす」ブロックの使い方\n・効果音の選び方\n・音の長さの調整\n\n（実装準備中）');
        }

        function showMusicInstruments() {
            alert('🎺 楽器の音\n\n・楽器の種類を選ぶ\n・音階を変える\n・楽器の組み合わせ\n\n（実装準備中）');
        }

        function showSoundEffects() {
            alert('🎭 効果音\n\n・ゲーム用効果音\n・動作に合わせた音\n・オリジナル効果音\n\n（実装準備中）');
        }

        function showMusicControl() {
            alert('🎛️ 音楽の制御\n\n・テンポの調整\n・音量の変更\n・音楽の停止・再開\n\n（実装準備中）');
        }

        // メッセージ機能の個別レッスン関数
        function showBasicMessages() {
            alert('📨 メッセージの送受信\n\n・メッセージを送るブロック\n・メッセージを受け取るブロック\n・メッセージの名前を決める\n\n（実装準備中）');
        }

        function showSpritesCommunication() {
            alert('🤝 スプライト間の通信\n\n・複数のスプライトで連携\n・順番に動かす\n・同時に動かす\n\n（実装準備中）');
        }

        // 背景機能の個別レッスン関数
        function showBackgroundBasics() {
            alert('🖼️ 背景の基本\n\n・背景を変えるブロック\n・背景の種類を選ぶ\n・背景の効果\n\n（実装準備中）');
        }

        function showBackgroundSwitching() {
            alert('🔄 背景の切り替え\n\n・場面に応じた背景変更\n・背景が変わった時の処理\n・背景を使った演出\n\n（実装準備中）');
        }

        // リスト機能の個別レッスン関数
        function showListBasics() {
            alert('📝 リストの基本\n\n・リストを作る\n・リストを表示する\n・リストの仕組み\n\n（実装準備中）');
        }

        function showListOperations() {
            alert('➕ リストの操作\n\n・リストに追加する\n・リストから削除する\n・リストを空にする\n\n（実装準備中）');
        }

        function showListAccess() {
            alert('🔍 リストの内容を使う\n\n・リストの項目を取り出す\n・リストの長さを調べる\n・リストの中身を検索\n\n（実装準備中）');
        }

        function showListApplications() {
            alert('🎯 リストの活用\n\n・ゲームでの活用例\n・データ管理の方法\n・実践的な使い方\n\n（実装準備中）');
        }

        // ペン機能の個別レッスン関数
        function showPenBasics() {
            alert('🖊️ ペンの基本\n\n・ペンを下ろす/上げる\n・線を描く\n・ペンの設定\n\n（実装準備中）');
        }

        function showPenColors() {
            alert('🌈 色と太さ\n\n・ペンの色を変える\n・ペンの太さを変える\n・グラデーション効果\n\n（実装準備中）');
        }

        function showShapeDrawing() {
            alert('🔺 図形を描く\n\n・三角形や四角形\n・円を描く\n・複雑な図形\n\n（実装準備中）');
        }

        function showArtCreation() {
            alert('🎨 アート作品\n\n・自由な絵を描く\n・パターンを作る\n・芸術的な表現\n\n（実装準備中）');
        }
        
        // グローバルエラーハンドラーを追加して白画面を防ぐ
        window.addEventListener('error', function(event) {
            console.error('=== GLOBAL ERROR CAUGHT ===');
            console.error('Error message:', event.message);
            console.error('Error filename:', event.filename);
            console.error('Error line:', event.lineno);
            console.error('Error column:', event.colno);
            console.error('Error object:', event.error);
            
            // 白画面を防ぐ
            event.preventDefault();
            return true;
        });
        
        window.addEventListener('unhandledrejection', function(event) {
            console.error('=== UNHANDLED PROMISE REJECTION ===');
            console.error('Reason:', event.reason);
            event.preventDefault();
        });
        
        console.log('=== EMERGENCY OVERRIDE SCRIPT COMPLETED ===');
    </script>
</body>
</html>