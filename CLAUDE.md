# CLAUDE.md

このファイルは、このリポジトリでコードを操作する際のClaude Code (claude.ai/code) へのガイダンスを提供します。

## プロジェクト概要

これは子供向けScratch学習ウェブサイトのSingle Page Application (SPA)プロジェクトです。HTML、CSS、JavaScriptを使用して構築されており、シンプルなWeb技術スタックで実装されています。目標は、Scratchプログラミング概念を子供たちに分かりやすく教える教育用Webサイトを提供することです。

## 開発ルール

### HTMLファイル修正ルール
- **既存のHTMLファイルを直接修正する**
- **新しいHTMLファイルを作成しない**
- **類似のHTMLファイルを作成せず、既存ファイルを編集する**
- ファイル数の増加を避け、どのファイルが使用されているか分からなくなることを防ぐ

## 開発・実行方法

### 基本実行（Webサーバー不要）
```bash
# ファイルをブラウザで直接開く
open index.html  # macOS
start index.html # Windows
xdg-open index.html # Linux

# または、ブラウザのファイル→開くでindex.htmlを選択
```

### 開発時のWebサーバー（オプション）
```bash
# 開発時にWebサーバーを使用する場合（任意）
python -m http.server 8000  # Python 3
npx http-server .           # Node.js

# Visual Studio Code Live Serverエクステンション使用も可能
```

### ファイル確認
```bash
# プロジェクト構造の確認
ls -la

# HTMLファイルの構文チェック
# ブラウザの開発者ツールで確認
```

## プロジェクト構造

- `index.html` - メインアプリケーションファイル（SPA）
- `docs/` - プロジェクト仕様書とドキュメント
  - `SPA構造仕様書.md` - アプリケーション構造の詳細仕様
  - `HTMLファイル使用状況調査.md` - ファイル管理状況
  - `プロジェクト概要と開発ガイド.md` - プロジェクト概要とGitHub Pages対応情報

## 技術スタック

### フロントエンド
- **HTML5**: セマンティックマークアップ
- **CSS3**: 
  - Flexbox/Gridレイアウト
  - カスタムアニメーション
  - レスポンシブデザイン
- **JavaScript (ES6+)**:
  - DOM操作によるSPA実装
  - セクション切り替え機能
  - 動的コンテンツ生成

### デザイン
- Material Design風のコンポーネント
- Scratchオリジナルの色使い（紫、オレンジテーマ）
- 子供向けの分かりやすいUI/UX

## 実装済み機能

### SPA構造とナビゲーション
- **ホームページ**: レッスン選択のメインダッシュボード
- **セクション切り替え**: JavaScriptによるシームレスな画面遷移
- **プログレッシブステップ**: 段階的な学習進行システム

### 学習セクション
- **プログラムの流れ**: 順次実行の概念（6ステップ）
- **ループ**: 繰り返し処理の理解（6ステップ）
- **座標システム**: ステージ位置と座標（4ステップ）
- **条件分岐**: if-then、if-else論理
- **変数システム**: HP、スコア計算
- **コスチューム**: スプライトの見た目変更（4ステップ）
- **クローン機能**: オブジェクトの複製システム

### Scratchブロック表現
- **視覚的ブロック**: CSS/HTMLによるScratchライクなブロック表現
- **カテゴリ別色分け**:
  - Motion（青色 #4C97FF）
  - Looks（紫色 #9966FF）
  - Control（オレンジ色 #FFAB19）
  - Events（黄色 #FFD500）
- **インタラクティブ要素**: クリック、ホバー効果

### ユーザビリティ
- **子供向けデザイン**: 大きなボタン、分かりやすいアイコン
- **日本語対応**: 完全な日本語インターフェース
- **レスポンシブ**: デスクトップ、タブレット対応

## 開発ノート

- **純粋なWeb技術**: フレームワーク依存なしのシンプル構成
- **教育特化**: プログラミング初心者（子供）向けに最適化
- **メンテナンス性**: 単一HTMLファイル（index.html）でのSPA管理
- **拡張性**: 新しいレッスンやセクションの追加が容易
- **デプロイ**: GitHub Pagesで直接ホスティング可能（設定不要）
- **Scratchブロック**: Scratchblocks.js ライブラリ（CDN）で本格的なブロック表現

## 重要な技術情報

### SPA構成
- **メインファイル**: `index.html` のみ（約400KB）
- **画面切り替え**: JavaScript による表示/非表示切り替え
- **外部依存**: Scratchblocks.js（CDN経由）

### GitHub Pages対応
- **設定**: Settings → Pages → Deploy from branch (main)
- **URL**: `https://ユーザー名.github.io/リポジトリ名/`
- **更新**: git push のみで自動デプロイ

## 自動テスト・バグ検出システム

### Playwrightによる自動テスト
このプロジェクトには**Playwright**による包括的な自動テストが実装されています。

#### テストコマンド
```bash
npm run test:full      # 全体ナビゲーションテスト
npm run test:conditional  # 条件分岐のみテスト
npm run test:all       # 全テスト実行
```

#### 自動検出項目
- **画面遷移**: 全セクションの表示/非表示
- **ホームボタン**: 各セクションの戻るボタン存在確認
- **ステップ進行**: 次へ/前へボタンの動作
- **JavaScriptエラー**: コンソールエラー・実行時エラー
- **要素の存在**: 重要なUI要素の表示確認

### 重要なワークフロー

#### ユーザーから「自動テスト」「バグ検出」「テスト実行」を求められた場合

1. **即座にPlaywrightテストを実行**
   ```bash
   npm run test:full
   ```

2. **検出されたバグを既知のバグ一覧.mdに更新**
   - 新しいバグを追加
   - 修正済みバグを✅マーク
   - 検出日時を更新
   - 優先度を設定

3. **バグレポートの構成**
   - 🔴 最高優先度: ナビゲーション問題、致命的エラー
   - 🟡 高優先度: 機能障害、JavaScriptエラー  
   - 🟢 低優先度: UI微調整、軽微な問題

4. **修正提案も含める**
   - 具体的なコード例
   - 該当ファイルと行番号
   - 修正の影響範囲

#### テスト結果の解釈
- **✅ 成功**: 機能が正常動作
- **❌ バグ発見**: 問題が検出された
- **⚠️ 要確認**: 期待と異なる動作

#### 自動テストの利点
- **網羅性**: 手動では見落としがちな問題も検出
- **再現性**: 同じ条件で何度でもテスト可能
- **効率性**: 数秒で全サイトをチェック
- **客観性**: 人的ミスのない正確な結果

### テストファイル構成
- `tests/conditional-test.spec.js` - 条件分岐特化テスト
- `tests/full-navigation-test.spec.js` - 全体包括テスト
- `playwright.config.js` - Playwright設定
- `既知のバグ一覧.md` - バグレポート

**注意**: ユーザーがバグ報告や動作不良を報告した場合も、まず自動テストを実行してシステム全体の状況を把握することを推奨します。

### テスト更新・拡張ルール

#### 機能追加・変更時の必須確認

**新機能追加、既存機能変更、ボタン追加、画面遷移変更を行った場合は、必ずユーザーに以下を確認する**:

> 「新しい機能/変更を追加したので、自動テストにも反映しますか？」

#### テスト更新が必要なケース

1. **新しい画面・セクション追加**
   - 新しいメニューカード追加
   - 新しいサブセクション作成
   - 新しい学習コンテンツ追加

2. **ナビゲーション変更**
   - 新しいボタン追加
   - onclick関数の変更
   - 画面遷移フローの変更

3. **UI要素の変更**
   - IDやクラス名の変更
   - ボタンテキストの変更
   - セクション構造の変更

4. **JavaScript関数の追加・変更**
   - 新しいshow関数の追加
   - 既存関数の動作変更
   - エラーハンドリングの追加

#### テスト更新の具体的対応

**ユーザーが「はい」と答えた場合**:

1. **新機能のテストケース追加**
   ```javascript
   // 新しいテストを full-navigation-test.spec.js に追加
   test('新機能テスト', async ({ page }) => {
     // 新機能の動作確認
   });
   ```

2. **既存テストの更新**
   - セレクタの更新
   - 新しい要素の確認追加
   - テストフローの調整

3. **テスト実行で動作確認**
   ```bash
   npm run test:full
   ```

#### テスト更新を提案するタイミング

- ✅ **機能実装完了直後**
- ✅ **ボタンやリンク追加後**
- ✅ **画面遷移変更後**
- ✅ **新しいセクション作成後**
- ✅ **ID/クラス名変更後**

#### 更新しないリスク

- 🚫 新機能のバグが検出されない
- 🚫 既存テストが失敗する可能性
- 🚫 自動テストの信頼性低下
- 🚫 見落としによる品質低下

**重要**: テスト更新は**機能追加と同じく重要**です。新機能が正しく動作することを自動で確認できるようにテストも進化させましょう。

### Git版本管理ルール

#### 変更時の積極的コミット提案

**コード変更、機能追加、バグ修正、テスト更新を行った場合は、必ずユーザーにGitコミットを提案する**:

> 「変更を保存するために、Gitコミットを作成しますか？」

#### コミット提案が必要なケース

1. **機能実装・追加**
   - 新しいセクション追加
   - 新しいボタン・機能実装
   - UI改善・変更

2. **バグ修正**
   - 発見されたバグの修正
   - エラーハンドリング追加
   - 動作不良の解決

3. **テスト関連**
   - 新しいテストケース追加
   - 既存テストの更新
   - テスト設定変更

4. **ドキュメント更新**
   - CLAUDE.md の更新
   - 既知のバグ一覧.md の更新
   - 仕様書の追加・変更

5. **設定・構成変更**
   - package.json の更新
   - Playwright設定変更
   - プロジェクト構造変更

#### コミット提案のタイミング

- ✅ **機能実装完了直後**
- ✅ **バグ修正完了直後**
- ✅ **テスト追加・更新完了直後**
- ✅ **ドキュメント更新完了直後**
- ✅ **複数の小さな変更が蓄積した時**

#### 推奨コミットメッセージ形式

```bash
# 機能追加
git commit -m "feat: 新しい学習セクション「関数」を追加

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>"

# バグ修正
git commit -m "fix: if-thenセクションにホームボタンを追加

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>"

# テスト追加
git commit -m "test: 新機能の自動テストケースを追加

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

#### コミットの利点

- 📝 **変更履歴の保持**: いつ何を変更したか記録
- 🔄 **ロールバック可能**: 問題があれば前の状態に戻せる
- 👥 **協業支援**: チーム開発時の変更共有
- 🚀 **GitHub Pages自動デプロイ**: push時に自動更新
- 📊 **進捗可視化**: 開発進捗の追跡

#### コミットしないリスク

- 🚫 **変更の紛失**: システムトラブル時の作業ロス
- 🚫 **履歴の欠落**: 何をいつ変更したか不明
- 🚫 **デプロイ困難**: GitHub Pagesに反映されない
- 🚫 **協業阻害**: 他の開発者との連携困難

**重要**: 小さな変更でも積極的にコミットすることで、**安全で追跡可能な開発**を維持できます。変更が完了したら即座にコミット提案を行いましょう。