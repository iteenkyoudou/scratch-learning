<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€å°é™ã‚¯ãƒ­ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .stage { width: 400px; height: 200px; border: 2px solid #333; margin: 20px 0; position: relative; background: #f8f8f8; }
        .sprite { width: 40px; height: 40px; background: red; border-radius: 50%; position: absolute; display: flex; align-items: center; justify-content: center; font-size: 20px; color: white; font-weight: bold; }
        .btn { background: #007bff; color: white; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; border-radius: 5px; }
        .status { border: 1px solid #007bff; padding: 10px; margin: 10px 0; background: #f0f8ff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§¬ æœ€å°é™ã‚¯ãƒ­ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="stage" id="stage">
            <div class="sprite" id="sprite" style="left: 50px; top: 50px;">ğŸ˜¸</div>
        </div>
        
        <div class="status" id="status">æº–å‚™å®Œäº†</div>
        
        <button class="btn" onclick="test1()">ãƒ†ã‚¹ãƒˆ1: 1å€‹ã‚¯ãƒ­ãƒ¼ãƒ³</button>
        <button class="btn" onclick="test2()">ãƒ†ã‚¹ãƒˆ2: 3å€‹ã‚¯ãƒ­ãƒ¼ãƒ³</button>
        <button class="btn" onclick="clearAll()">ã‚¯ãƒªã‚¢</button>
    </div>

    <script>
        console.log('æœ€å°é™ãƒ†ã‚¹ãƒˆé–‹å§‹');

        function test1() {
            console.log('=== ãƒ†ã‚¹ãƒˆ1é–‹å§‹ ===');
            
            try {
                const sprite = document.getElementById('sprite');
                const stage = document.getElementById('stage');
                const status = document.getElementById('status');
                
                console.log('è¦ç´ ç¢ºèª:', {sprite, stage, status});
                
                if (!sprite || !stage || !status) {
                    throw new Error('è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                // æ—¢å­˜ã®ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ã‚¯ãƒªã‚¢
                clearAll();
                
                // 1å€‹ã®ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ä½œæˆ
                const clone = sprite.cloneNode(true);
                clone.id = 'test-clone-1';
                clone.style.left = '150px';
                clone.style.top = '100px';
                clone.style.background = 'blue';
                
                console.log('ã‚¯ãƒ­ãƒ¼ãƒ³ä½œæˆ:', clone);
                
                stage.appendChild(clone);
                
                console.log('ã‚¯ãƒ­ãƒ¼ãƒ³è¿½åŠ å®Œäº†');
                
                status.textContent = 'âœ… 1å€‹ã®ã‚¯ãƒ­ãƒ¼ãƒ³ãŒä½œæˆã•ã‚Œã¾ã—ãŸ';
                
                // ã‚¯ãƒ­ãƒ¼ãƒ³ãŒå®Ÿéš›ã«è¿½åŠ ã•ã‚ŒãŸã‹ç¢ºèª
                const addedClone = document.getElementById('test-clone-1');
                console.log('è¿½åŠ ç¢ºèª:', addedClone);
                
                if (!addedClone) {
                    throw new Error('ã‚¯ãƒ­ãƒ¼ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                console.log('=== ãƒ†ã‚¹ãƒˆ1æˆåŠŸ ===');
                
            } catch (error) {
                console.error('ãƒ†ã‚¹ãƒˆ1ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('status').textContent = 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message;
            }
        }

        function test2() {
            console.log('=== ãƒ†ã‚¹ãƒˆ2é–‹å§‹ ===');
            
            try {
                const sprite = document.getElementById('sprite');
                const stage = document.getElementById('stage');
                const status = document.getElementById('status');
                
                if (!sprite || !stage || !status) {
                    throw new Error('è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                // æ—¢å­˜ã®ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ã‚¯ãƒªã‚¢
                clearAll();
                
                // 3å€‹ã®ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ä½œæˆ
                for (let i = 1; i <= 3; i++) {
                    console.log(`ã‚¯ãƒ­ãƒ¼ãƒ³${i}ä½œæˆä¸­`);
                    
                    const clone = sprite.cloneNode(true);
                    clone.id = `test-clone-${i}`;
                    clone.style.left = (50 + i * 80) + 'px';
                    clone.style.top = (50 + i * 20) + 'px';
                    clone.style.background = `hsl(${i * 120}, 70%, 60%)`;
                    
                    stage.appendChild(clone);
                    
                    console.log(`ã‚¯ãƒ­ãƒ¼ãƒ³${i}è¿½åŠ å®Œäº†`);
                }
                
                status.textContent = 'âœ… 3å€‹ã®ã‚¯ãƒ­ãƒ¼ãƒ³ãŒä½œæˆã•ã‚Œã¾ã—ãŸ';
                
                console.log('=== ãƒ†ã‚¹ãƒˆ2æˆåŠŸ ===');
                
            } catch (error) {
                console.error('ãƒ†ã‚¹ãƒˆ2ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('status').textContent = 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message;
            }
        }

        function clearAll() {
            console.log('=== ã‚¯ãƒªã‚¢é–‹å§‹ ===');
            
            try {
                const clones = document.querySelectorAll('[id^="test-clone-"]');
                console.log('å‰Šé™¤å¯¾è±¡:', clones.length);
                
                clones.forEach((clone, index) => {
                    console.log(`ã‚¯ãƒ­ãƒ¼ãƒ³${index + 1}å‰Šé™¤`);
                    clone.remove();
                });
                
                document.getElementById('status').textContent = 'ã‚¯ãƒªã‚¢å®Œäº†';
                
                console.log('=== ã‚¯ãƒªã‚¢æˆåŠŸ ===');
                
            } catch (error) {
                console.error('ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('status').textContent = 'âŒ ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼: ' + error.message;
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
        window.addEventListener('error', function(event) {
            console.error('ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼:', event.error);
            const status = document.getElementById('status');
            if (status) {
                status.textContent = 'âŒ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼: ' + event.error.message;
            }
            // ç™½ç”»é¢ã‚’é˜²ã
            event.preventDefault();
            return true;
        });

        window.addEventListener('load', function() {
            console.log('ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰å®Œäº†');
        });
    </script>
</body>
</html>